<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>第 12 章 图形 | Cookbook for R 中文版</title>
  <meta name="description" content="第 12 章 图形 | Cookbook for R 中文版本">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="第 12 章 图形 | Cookbook for R 中文版" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="第 12 章 图形 | Cookbook for R 中文版本" />
  <meta name="github-repo" content="openbiox/Cookbook-for-R-Chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 12 章 图形 | Cookbook for R 中文版" />
  
  <meta name="twitter:description" content="第 12 章 图形 | Cookbook for R 中文版本" />
  

<meta name="author" content="Winston Chang（著）| 王诗翔等（译）">


<meta name="date" content="2019-04-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="section-11.html">
<link rel="next" href="section-13.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Cook book for R 中文版</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>欢迎</a></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="section-1.html"><a href="section-1.html"><i class="fa fa-check"></i><b>1</b> 基础</a><ul>
<li class="chapter" data-level="1.1" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>1.1</b> 安装和使用R包</a><ul>
<li class="chapter" data-level="1.1.1" data-path="section-1.html"><a href="section-1.html#section-1.1.1"><i class="fa fa-check"></i><b>1.1.1</b> 问题</a></li>
<li class="chapter" data-level="1.1.2" data-path="section-1.html"><a href="section-1.html#section-1.1.2"><i class="fa fa-check"></i><b>1.1.2</b> 方案</a></li>
<li class="chapter" data-level="1.1.3" data-path="section-1.html"><a href="section-1.html#section-1.1.3"><i class="fa fa-check"></i><b>1.1.3</b> 其他</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="section-1.html"><a href="section-1.html#section-1.2"><i class="fa fa-check"></i><b>1.2</b> 数据结构的索引</a><ul>
<li class="chapter" data-level="1.2.1" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>1.2.1</b> 问题</a></li>
<li class="chapter" data-level="1.2.2" data-path="section-1.html"><a href="section-1.html#section-1.2.2"><i class="fa fa-check"></i><b>1.2.2</b> 解决</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="section-1.html"><a href="section-1.html#section-1.3"><i class="fa fa-check"></i><b>1.3</b> 获取数据结构的子集</a><ul>
<li class="chapter" data-level="1.3.1" data-path="section-1.html"><a href="section-1.html#-2"><i class="fa fa-check"></i><b>1.3.1</b> 问题</a></li>
<li class="chapter" data-level="1.3.2" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>1.3.2</b> 方案</a></li>
<li class="chapter" data-level="1.3.3" data-path="section-1.html"><a href="section-1.html#section-1.3.3"><i class="fa fa-check"></i><b>1.3.3</b> 数据框</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="section-1.html"><a href="section-1.html#section-1.4"><i class="fa fa-check"></i><b>1.4</b> 创建填满值的向量</a><ul>
<li class="chapter" data-level="1.4.1" data-path="section-1.html"><a href="section-1.html#-3"><i class="fa fa-check"></i><b>1.4.1</b> 问题</a></li>
<li class="chapter" data-level="1.4.2" data-path="section-1.html"><a href="section-1.html#-2"><i class="fa fa-check"></i><b>1.4.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="section-1.html"><a href="section-1.html#section-1.5"><i class="fa fa-check"></i><b>1.5</b> 获取变量信息</a><ul>
<li class="chapter" data-level="1.5.1" data-path="section-1.html"><a href="section-1.html#-4"><i class="fa fa-check"></i><b>1.5.1</b> 问题</a></li>
<li class="chapter" data-level="1.5.2" data-path="section-1.html"><a href="section-1.html#-3"><i class="fa fa-check"></i><b>1.5.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="section-1.html"><a href="section-1.html#null-na-nan"><i class="fa fa-check"></i><b>1.6</b> NULL-NA-NaN的处理</a><ul>
<li class="chapter" data-level="1.6.1" data-path="section-1.html"><a href="section-1.html#-5"><i class="fa fa-check"></i><b>1.6.1</b> 问题</a></li>
<li class="chapter" data-level="1.6.2" data-path="section-1.html"><a href="section-1.html#-4"><i class="fa fa-check"></i><b>1.6.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-2.html"><a href="section-2.html"><i class="fa fa-check"></i><b>2</b> 数字</a><ul>
<li class="chapter" data-level="2.1" data-path="section-2.html"><a href="section-2.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> 生成随机数</a><ul>
<li class="chapter" data-level="2.1.1" data-path="section-2.html"><a href="section-2.html#-6"><i class="fa fa-check"></i><b>2.1.1</b> 问题</a></li>
<li class="chapter" data-level="2.1.2" data-path="section-1.html"><a href="section-1.html#-5"><i class="fa fa-check"></i><b>2.1.2</b> 方案</a></li>
<li class="chapter" data-level="2.1.3" data-path="section-1.html"><a href="section-1.html#-3"><i class="fa fa-check"></i><b>2.1.3</b> 注意</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="section-2.html"><a href="section-2.html#section-2.2"><i class="fa fa-check"></i><b>2.2</b> 生成可重复的随机序列</a><ul>
<li class="chapter" data-level="2.2.1" data-path="section-2.html"><a href="section-2.html#-7"><i class="fa fa-check"></i><b>2.2.1</b> 问题</a></li>
<li class="chapter" data-level="2.2.2" data-path="section-2.html"><a href="section-2.html#-6"><i class="fa fa-check"></i><b>2.2.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="section-2.html"><a href="section-2.html#section-2.3"><i class="fa fa-check"></i><b>2.3</b> 保持随机数生成器的状态</a><ul>
<li class="chapter" data-level="2.3.1" data-path="section-2.html"><a href="section-2.html#-8"><i class="fa fa-check"></i><b>2.3.1</b> 问题</a></li>
<li class="chapter" data-level="2.3.2" data-path="section-2.html"><a href="section-2.html#-7"><i class="fa fa-check"></i><b>2.3.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="section-2.html"><a href="section-2.html#section-2.4"><i class="fa fa-check"></i><b>2.4</b> 对数值取整</a><ul>
<li class="chapter" data-level="2.4.1" data-path="section-2.html"><a href="section-2.html#-9"><i class="fa fa-check"></i><b>2.4.1</b> 问题</a></li>
<li class="chapter" data-level="2.4.2" data-path="section-2.html"><a href="section-2.html#-8"><i class="fa fa-check"></i><b>2.4.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="section-2.html"><a href="section-2.html#section-2.5"><i class="fa fa-check"></i><b>2.5</b> 比较浮点数</a><ul>
<li class="chapter" data-level="2.5.1" data-path="section-2.html"><a href="section-2.html#-10"><i class="fa fa-check"></i><b>2.5.1</b> 问题</a></li>
<li class="chapter" data-level="2.5.2" data-path="section-2.html"><a href="section-2.html#-9"><i class="fa fa-check"></i><b>2.5.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="section-3.html"><a href="section-3.html"><i class="fa fa-check"></i><b>3</b> 字符串</a><ul>
<li class="chapter" data-level="3.1" data-path="section-3.html"><a href="section-3.html#grepsubgsub"><i class="fa fa-check"></i><b>3.1</b> 使用grep,sub,gsub进行搜索和替换</a><ul>
<li class="chapter" data-level="3.1.1" data-path="section-3.html"><a href="section-3.html#-11"><i class="fa fa-check"></i><b>3.1.1</b> 问题</a></li>
<li class="chapter" data-level="3.1.2" data-path="section-2.html"><a href="section-2.html#-10"><i class="fa fa-check"></i><b>3.1.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="section-3.html"><a href="section-3.html#section-3.2"><i class="fa fa-check"></i><b>3.2</b> 通过变量创建字符串</a><ul>
<li class="chapter" data-level="3.2.1" data-path="section-3.html"><a href="section-3.html#-12"><i class="fa fa-check"></i><b>3.2.1</b> 问题</a></li>
<li class="chapter" data-level="3.2.2" data-path="section-3.html"><a href="section-3.html#-11"><i class="fa fa-check"></i><b>3.2.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>4</b> 公式</a><ul>
<li class="chapter" data-level="4.1" data-path="section-4.html"><a href="section-4.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 通过字符串创建公式</a><ul>
<li class="chapter" data-level="4.1.1" data-path="section-4.html"><a href="section-4.html#-13"><i class="fa fa-check"></i><b>4.1.1</b> 问题</a></li>
<li class="chapter" data-level="4.1.2" data-path="section-3.html"><a href="section-3.html#-12"><i class="fa fa-check"></i><b>4.1.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="section-4.html"><a href="section-4.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 从公式中提取组分</a><ul>
<li class="chapter" data-level="4.2.1" data-path="section-4.html"><a href="section-4.html#-14"><i class="fa fa-check"></i><b>4.2.1</b> 问题</a></li>
<li class="chapter" data-level="4.2.2" data-path="section-4.html"><a href="section-4.html#-13"><i class="fa fa-check"></i><b>4.2.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-5.html"><a href="section-5.html"><i class="fa fa-check"></i><b>5</b> 数据的导入与导出</a><ul>
<li class="chapter" data-level="5.1" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>5.1</b> R载入文件中的数据</a><ul>
<li class="chapter" data-level="5.1.1" data-path="section-5.html"><a href="section-5.html#-15"><i class="fa fa-check"></i><b>5.1.1</b> 问题</a></li>
<li class="chapter" data-level="5.1.2" data-path="section-4.html"><a href="section-4.html#-14"><i class="fa fa-check"></i><b>5.1.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>5.2</b> 键盘和剪贴板把数据载入并保存到R</a><ul>
<li class="chapter" data-level="5.2.1" data-path="section-5.html"><a href="section-5.html#-16"><i class="fa fa-check"></i><b>5.2.1</b> 问题</a></li>
<li class="chapter" data-level="5.2.2" data-path="section-5.html"><a href="section-5.html#-15"><i class="fa fa-check"></i><b>5.2.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>5.3</b> 运行R脚本</a><ul>
<li class="chapter" data-level="5.3.1" data-path="section-5.html"><a href="section-5.html#-17"><i class="fa fa-check"></i><b>5.3.1</b> 问题</a></li>
<li class="chapter" data-level="5.3.2" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>5.3.2</b> 解决</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>5.4</b> 用R把数据写入文件</a><ul>
<li class="chapter" data-level="5.4.1" data-path="section-5.html"><a href="section-5.html#-18"><i class="fa fa-check"></i><b>5.4.1</b> 问题</a></li>
<li class="chapter" data-level="5.4.2" data-path="section-5.html"><a href="section-5.html#-16"><i class="fa fa-check"></i><b>5.4.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>5.5</b> 用R写入文本，分析输出到文件</a><ul>
<li class="chapter" data-level="5.5.1" data-path="section-5.html"><a href="section-5.html#-19"><i class="fa fa-check"></i><b>5.5.1</b> 问题</a></li>
<li class="chapter" data-level="5.5.2" data-path="section-5.html"><a href="section-5.html#-17"><i class="fa fa-check"></i><b>5.5.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-6.html"><a href="section-6.html"><i class="fa fa-check"></i><b>6</b> 操作数据</a><ul>
<li class="chapter" data-level="6.1" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>6.1</b> R中的排序问题</a><ul>
<li class="chapter" data-level="6.1.1" data-path="section-6.html"><a href="section-6.html#-20"><i class="fa fa-check"></i><b>6.1.1</b> 问题</a></li>
<li class="chapter" data-level="6.1.2" data-path="section-1.html"><a href="section-1.html#-2"><i class="fa fa-check"></i><b>6.1.2</b> 解决</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>6.2</b> 用R生成随机的顺序</a><ul>
<li class="chapter" data-level="6.2.1" data-path="section-6.html"><a href="section-6.html#-21"><i class="fa fa-check"></i><b>6.2.1</b> 问题</a></li>
<li class="chapter" data-level="6.2.2" data-path="section-5.html"><a href="section-5.html#-18"><i class="fa fa-check"></i><b>6.2.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="section-6.html"><a href="section-6.html#section-6.3"><i class="fa fa-check"></i><b>6.3</b> 转换向量类型——数值向量，字符串向量和因子向量</a><ul>
<li class="chapter" data-level="6.3.1" data-path="section-6.html"><a href="section-6.html#-22"><i class="fa fa-check"></i><b>6.3.1</b> 问题</a></li>
<li class="chapter" data-level="6.3.2" data-path="section-5.html"><a href="section-5.html#-19"><i class="fa fa-check"></i><b>6.3.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="section-1.html"><a href="section-1.html#r"><i class="fa fa-check"></i><b>6.4</b> 用R查找并移除重复的记录</a><ul>
<li class="chapter" data-level="6.4.1" data-path="section-6.html"><a href="section-6.html#-23"><i class="fa fa-check"></i><b>6.4.1</b> 问题</a></li>
<li class="chapter" data-level="6.4.2" data-path="section-6.html"><a href="section-6.html#-20"><i class="fa fa-check"></i><b>6.4.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="section-6.html"><a href="section-6.html#na"><i class="fa fa-check"></i><b>6.5</b> NA存在的情况下，向量或因子间的比较</a><ul>
<li class="chapter" data-level="6.5.1" data-path="section-6.html"><a href="section-6.html#-24"><i class="fa fa-check"></i><b>6.5.1</b> 问题</a></li>
<li class="chapter" data-level="6.5.2" data-path="section-6.html"><a href="section-6.html#-21"><i class="fa fa-check"></i><b>6.5.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="section-6.html"><a href="section-6.html#section-6.6"><i class="fa fa-check"></i><b>6.6</b> 数据重新编码</a><ul>
<li class="chapter" data-level="6.6.1" data-path="section-6.html"><a href="section-6.html#-25"><i class="fa fa-check"></i><b>6.6.1</b> 问题</a></li>
<li class="chapter" data-level="6.6.2" data-path="section-6.html"><a href="section-6.html#-22"><i class="fa fa-check"></i><b>6.6.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="section-6.html"><a href="section-6.html#xy"><i class="fa fa-check"></i><b>6.7</b> 将向量中所有值为x的对象改变值y</a><ul>
<li class="chapter" data-level="6.7.1" data-path="section-6.html"><a href="section-6.html#-26"><i class="fa fa-check"></i><b>6.7.1</b> 问题</a></li>
<li class="chapter" data-level="6.7.2" data-path="section-6.html"><a href="section-6.html#-23"><i class="fa fa-check"></i><b>6.7.2</b> 方案</a></li>
<li class="chapter" data-level="6.7.3" data-path="section-6.html"><a href="section-6.html#section-6.7.3"><i class="fa fa-check"></i><b>6.7.3</b> 另见</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="section-6.html"><a href="section-6.html#section-6.8"><i class="fa fa-check"></i><b>6.8</b> 重命名因子水平</a><ul>
<li class="chapter" data-level="6.8.1" data-path="section-6.html"><a href="section-6.html#-27"><i class="fa fa-check"></i><b>6.8.1</b> 问题</a></li>
<li class="chapter" data-level="6.8.2" data-path="section-6.html"><a href="section-6.html#-24"><i class="fa fa-check"></i><b>6.8.2</b> 方案</a></li>
<li class="chapter" data-level="6.8.3" data-path="section-6.html"><a href="section-6.html#section-6.8.3"><i class="fa fa-check"></i><b>6.8.3</b> 更多参考</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="section-6.html"><a href="section-6.html#section-6.9"><i class="fa fa-check"></i><b>6.9</b> 重计算因子水平</a><ul>
<li class="chapter" data-level="6.9.1" data-path="section-6.html"><a href="section-6.html#-28"><i class="fa fa-check"></i><b>6.9.1</b> 问题</a></li>
<li class="chapter" data-level="6.9.2" data-path="section-6.html"><a href="section-6.html#-25"><i class="fa fa-check"></i><b>6.9.2</b> 方案</a></li>
<li class="chapter" data-level="6.9.3" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>6.9.3</b> 另见</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="section-6.html"><a href="section-6.html#section-6.10"><i class="fa fa-check"></i><b>6.10</b> 改变因子水平次序</a><ul>
<li class="chapter" data-level="6.10.1" data-path="section-6.html"><a href="section-6.html#-29"><i class="fa fa-check"></i><b>6.10.1</b> 问题</a></li>
<li class="chapter" data-level="6.10.2" data-path="section-6.html"><a href="section-6.html#-26"><i class="fa fa-check"></i><b>6.10.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>7</b> 创建错误次序的因子</a></li>
<li class="chapter" data-level="8" data-path="-medium-.html"><a href="-medium-.html"><i class="fa fa-check"></i><b>8</b> 使得 medium 排最前面</a></li>
<li class="chapter" data-level="9" data-path="-small-.html"><a href="-small-.html"><i class="fa fa-check"></i><b>9</b> 使得 small 排最前面</a></li>
<li class="chapter" data-level="10" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>10</b> 创建错误次序的因子</a><ul>
<li class="chapter" data-level="10.1" data-path="-1.html"><a href="-1.html"><i class="fa fa-check"></i><b>10.1</b> 重命名数据框的列</a><ul>
<li class="chapter" data-level="10.1.1" data-path="-1.html"><a href="-1.html#-30"><i class="fa fa-check"></i><b>10.1.1</b> 问题</a></li>
<li class="chapter" data-level="10.1.2" data-path="section-6.html"><a href="section-6.html#-27"><i class="fa fa-check"></i><b>10.1.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="-1.html"><a href="-1.html#section-10.2"><i class="fa fa-check"></i><b>10.2</b> 添加和移除数据框的列</a><ul>
<li class="chapter" data-level="10.2.1" data-path="-1.html"><a href="-1.html#-31"><i class="fa fa-check"></i><b>10.2.1</b> 问题</a></li>
<li class="chapter" data-level="10.2.2" data-path="section-6.html"><a href="section-6.html#-28"><i class="fa fa-check"></i><b>10.2.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="-1.html"><a href="-1.html#section-10.3"><i class="fa fa-check"></i><b>10.3</b> 对数据框的列重新排序</a><ul>
<li class="chapter" data-level="10.3.1" data-path="-1.html"><a href="-1.html#-32"><i class="fa fa-check"></i><b>10.3.1</b> 问题</a></li>
<li class="chapter" data-level="10.3.2" data-path="section-6.html"><a href="section-6.html#-29"><i class="fa fa-check"></i><b>10.3.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="-1.html"><a href="-1.html#section-10.4"><i class="fa fa-check"></i><b>10.4</b> 融合数据框</a><ul>
<li class="chapter" data-level="10.4.1" data-path="-1.html"><a href="-1.html#-33"><i class="fa fa-check"></i><b>10.4.1</b> 问题</a></li>
<li class="chapter" data-level="10.4.2" data-path="-1.html"><a href="-1.html#-30"><i class="fa fa-check"></i><b>10.4.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="-1.html"><a href="-1.html#section-10.5"><i class="fa fa-check"></i><b>10.5</b> 比较数据框</a><ul>
<li class="chapter" data-level="10.5.1" data-path="-1.html"><a href="-1.html#-34"><i class="fa fa-check"></i><b>10.5.1</b> 问题</a></li>
<li class="chapter" data-level="10.5.2" data-path="-1.html"><a href="-1.html#-31"><i class="fa fa-check"></i><b>10.5.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="-1.html"><a href="-1.html#section-10.6"><i class="fa fa-check"></i><b>10.6</b> 重计算数据框所有因子列的水平</a><ul>
<li class="chapter" data-level="10.6.1" data-path="-1.html"><a href="-1.html#-35"><i class="fa fa-check"></i><b>10.6.1</b> 问题</a></li>
<li class="chapter" data-level="10.6.2" data-path="-1.html"><a href="-1.html#-32"><i class="fa fa-check"></i><b>10.6.2</b> 方案</a></li>
<li class="chapter" data-level="10.6.3" data-path="section-1.html"><a href="section-1.html#-2"><i class="fa fa-check"></i><b>10.6.3</b> 另见</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="-1.html"><a href="-1.html#section-10.7"><i class="fa fa-check"></i><b>10.7</b> 长宽格式数据互换</a><ul>
<li class="chapter" data-level="10.7.1" data-path="-1.html"><a href="-1.html#-36"><i class="fa fa-check"></i><b>10.7.1</b> 问题</a></li>
<li class="chapter" data-level="10.7.2" data-path="-1.html"><a href="-1.html#-33"><i class="fa fa-check"></i><b>10.7.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="-1.html"><a href="-1.html#section-10.8"><i class="fa fa-check"></i><b>10.8</b> 归纳总结数据</a><ul>
<li class="chapter" data-level="10.8.1" data-path="-1.html"><a href="-1.html#-37"><i class="fa fa-check"></i><b>10.8.1</b> 问题</a></li>
<li class="chapter" data-level="10.8.2" data-path="-1.html"><a href="-1.html#-34"><i class="fa fa-check"></i><b>10.8.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="-1.html"><a href="-1.html#section-10.9"><i class="fa fa-check"></i><b>10.9</b> 数据框与列联表互换</a><ul>
<li class="chapter" data-level="10.9.1" data-path="-1.html"><a href="-1.html#-38"><i class="fa fa-check"></i><b>10.9.1</b> 问题</a></li>
<li class="chapter" data-level="10.9.2" data-path="-1.html"><a href="-1.html#-35"><i class="fa fa-check"></i><b>10.9.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.10" data-path="-1.html"><a href="-1.html#section-10.10"><i class="fa fa-check"></i><b>10.10</b> 计算移动平均数</a><ul>
<li class="chapter" data-level="10.10.1" data-path="-1.html"><a href="-1.html#-39"><i class="fa fa-check"></i><b>10.10.1</b> 问题</a></li>
<li class="chapter" data-level="10.10.2" data-path="-1.html"><a href="-1.html#section-10.10.2"><i class="fa fa-check"></i><b>10.10.2</b> 解决方案</a></li>
</ul></li>
<li class="chapter" data-level="10.11" data-path="-1.html"><a href="-1.html#section-10.11"><i class="fa fa-check"></i><b>10.11</b> 窗口平滑</a><ul>
<li class="chapter" data-level="10.11.1" data-path="-1.html"><a href="-1.html#-40"><i class="fa fa-check"></i><b>10.11.1</b> 问题</a></li>
<li class="chapter" data-level="10.11.2" data-path="-1.html"><a href="-1.html#-36"><i class="fa fa-check"></i><b>10.11.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="10.12" data-path="-1.html"><a href="-1.html#section-10.12"><i class="fa fa-check"></i><b>10.12</b> 寻找唯一值序列</a><ul>
<li class="chapter" data-level="10.12.1" data-path="-1.html"><a href="-1.html#-41"><i class="fa fa-check"></i><b>10.12.1</b> 问题</a></li>
<li class="chapter" data-level="10.12.2" data-path="-1.html"><a href="-1.html#-37"><i class="fa fa-check"></i><b>10.12.2</b> 方案</a></li>
<li class="chapter" data-level="10.12.3" data-path="-1.html"><a href="-1.html#section-10.12.3"><i class="fa fa-check"></i><b>10.12.3</b> 向量上运行</a></li>
</ul></li>
<li class="chapter" data-level="10.13" data-path="-1.html"><a href="-1.html#nana"><i class="fa fa-check"></i><b>10.13</b> 用最后的非NA值填充NA值</a><ul>
<li class="chapter" data-level="10.13.1" data-path="-1.html"><a href="-1.html#-42"><i class="fa fa-check"></i><b>10.13.1</b> 问题</a></li>
<li class="chapter" data-level="10.13.2" data-path="-1.html"><a href="-1.html#-38"><i class="fa fa-check"></i><b>10.13.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-11.html"><a href="section-11.html"><i class="fa fa-check"></i><b>11</b> 统计分析</a><ul>
<li class="chapter" data-level="11.1" data-path="section-11.html"><a href="section-11.html#section-11.1"><i class="fa fa-check"></i><b>11.1</b> 回归和相关分析</a><ul>
<li class="chapter" data-level="11.1.1" data-path="section-11.html"><a href="section-11.html#-43"><i class="fa fa-check"></i><b>11.1.1</b> 问题</a></li>
<li class="chapter" data-level="11.1.2" data-path="-1.html"><a href="-1.html#-39"><i class="fa fa-check"></i><b>11.1.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="section-11.html"><a href="section-11.html#t"><i class="fa fa-check"></i><b>11.2</b> t检验</a><ul>
<li class="chapter" data-level="11.2.1" data-path="section-11.html"><a href="section-11.html#-44"><i class="fa fa-check"></i><b>11.2.1</b> 问题</a></li>
<li class="chapter" data-level="11.2.2" data-path="-1.html"><a href="-1.html#-40"><i class="fa fa-check"></i><b>11.2.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="section-11.html"><a href="section-11.html#section-11.3"><i class="fa fa-check"></i><b>11.3</b> 频数检验</a><ul>
<li class="chapter" data-level="11.3.1" data-path="section-11.html"><a href="section-11.html#-45"><i class="fa fa-check"></i><b>11.3.1</b> 问题</a></li>
<li class="chapter" data-level="11.3.2" data-path="-1.html"><a href="-1.html#-41"><i class="fa fa-check"></i><b>11.3.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="section-11.html"><a href="section-11.html#anova"><i class="fa fa-check"></i><b>11.4</b> ANOVA</a><ul>
<li class="chapter" data-level="11.4.1" data-path="section-11.html"><a href="section-11.html#-46"><i class="fa fa-check"></i><b>11.4.1</b> 问题</a></li>
<li class="chapter" data-level="11.4.2" data-path="-1.html"><a href="-1.html#-42"><i class="fa fa-check"></i><b>11.4.2</b> 方案</a></li>
<li class="chapter" data-level="11.4.3" data-path="section-11.html"><a href="section-11.html#anovas"><i class="fa fa-check"></i><b>11.4.3</b> 有受试内变量的ANOVAs</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="section-11.html"><a href="section-11.html#section-11.5"><i class="fa fa-check"></i><b>11.5</b> 逻辑回归</a><ul>
<li class="chapter" data-level="11.5.1" data-path="section-11.html"><a href="section-11.html#-47"><i class="fa fa-check"></i><b>11.5.1</b> 问题</a></li>
<li class="chapter" data-level="11.5.2" data-path="section-11.html"><a href="section-11.html#-43"><i class="fa fa-check"></i><b>11.5.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="section-11.html"><a href="section-11.html#section-11.6"><i class="fa fa-check"></i><b>11.6</b> 变量同质性</a><ul>
<li class="chapter" data-level="11.6.1" data-path="section-11.html"><a href="section-11.html#-48"><i class="fa fa-check"></i><b>11.6.1</b> 问题</a></li>
<li class="chapter" data-level="11.6.2" data-path="section-11.html"><a href="section-11.html#-44"><i class="fa fa-check"></i><b>11.6.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-12.html"><a href="section-12.html"><i class="fa fa-check"></i><b>12</b> 图形</a><ul>
<li class="chapter" data-level="12.1" data-path="section-12.html"><a href="section-12.html#section-12.1"><i class="fa fa-check"></i><b>12.1</b> 条形图与线图</a><ul>
<li class="chapter" data-level="12.1.1" data-path="section-12.html"><a href="section-12.html#-49"><i class="fa fa-check"></i><b>12.1.1</b> 问题</a></li>
<li class="chapter" data-level="12.1.2" data-path="section-11.html"><a href="section-11.html#-45"><i class="fa fa-check"></i><b>12.1.2</b> 方案</a></li>
<li class="chapter" data-level="12.1.3" data-path="section-12.html"><a href="section-12.html#section-12.1.3"><i class="fa fa-check"></i><b>12.1.3</b> 有更多变量的图</a></li>
<li class="chapter" data-level="12.1.4" data-path="section-12.html"><a href="section-12.html#-x-axis"><i class="fa fa-check"></i><b>12.1.4</b> 使用数值 x-axis</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="section-12.html"><a href="section-12.html#section-12.2"><i class="fa fa-check"></i><b>12.2</b> 绘制均值和误差棒</a><ul>
<li class="chapter" data-level="12.2.1" data-path="section-12.html"><a href="section-12.html#-50"><i class="fa fa-check"></i><b>12.2.1</b> 问题</a></li>
<li class="chapter" data-level="12.2.2" data-path="section-11.html"><a href="section-11.html#-46"><i class="fa fa-check"></i><b>12.2.2</b> 方案</a></li>
<li class="chapter" data-level="12.2.3" data-path="section-1.html"><a href="section-1.html#-2"><i class="fa fa-check"></i><b>12.2.3</b> 线图</a></li>
<li class="chapter" data-level="12.2.4" data-path="section-12.html"><a href="section-12.html#section-12.2.4"><i class="fa fa-check"></i><b>12.2.4</b> 直方图</a></li>
<li class="chapter" data-level="12.2.5" data-path="section-12.html"><a href="section-12.html#section-12.2.5"><i class="fa fa-check"></i><b>12.2.5</b> 为组内变量添加误差棒</a></li>
<li class="chapter" data-level="12.2.6" data-path="section-12.html"><a href="section-12.html#section-12.2.6"><i class="fa fa-check"></i><b>12.2.6</b> 注意标准化的均值</a></li>
<li class="chapter" data-level="12.2.7" data-path="section-12.html"><a href="section-12.html#section-12.2.7"><i class="fa fa-check"></i><b>12.2.7</b> 助手函数</a></li>
<li class="chapter" data-level="12.2.8" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>12.2.8</b> 其他</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="section-12.html"><a href="section-12.html#ggplot-"><i class="fa fa-check"></i><b>12.3</b> ggplot | 绘制分布图</a><ul>
<li class="chapter" data-level="12.3.1" data-path="section-12.html"><a href="section-12.html#-51"><i class="fa fa-check"></i><b>12.3.1</b> 问题</a></li>
<li class="chapter" data-level="12.3.2" data-path="section-11.html"><a href="section-11.html#-47"><i class="fa fa-check"></i><b>12.3.2</b> 方案</a></li>
<li class="chapter" data-level="12.3.3" data-path="section-12.html"><a href="section-12.html#section-12.3.3"><i class="fa fa-check"></i><b>12.3.3</b> 直方图和概率密度图</a></li>
<li class="chapter" data-level="12.3.4" data-path="section-12.html"><a href="section-12.html#section-12.3.4"><i class="fa fa-check"></i><b>12.3.4</b> 多组数据的直方图和概率密度图</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="section-12.html"><a href="section-12.html#section-12.4"><i class="fa fa-check"></i><b>12.4</b> 箱型图</a></li>
<li class="chapter" data-level="12.5" data-path="section-12.html"><a href="section-12.html#ggplot"><i class="fa fa-check"></i><b>12.5</b> ggplot|散点图</a><ul>
<li class="chapter" data-level="12.5.1" data-path="section-12.html"><a href="section-12.html#-52"><i class="fa fa-check"></i><b>12.5.1</b> 问题</a></li>
<li class="chapter" data-level="12.5.2" data-path="section-11.html"><a href="section-11.html#-48"><i class="fa fa-check"></i><b>12.5.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="section-12.html"><a href="section-12.html#ggplot-"><i class="fa fa-check"></i><b>12.6</b> ggplot | 标题</a><ul>
<li class="chapter" data-level="12.6.1" data-path="section-12.html"><a href="section-12.html#-53"><i class="fa fa-check"></i><b>12.6.1</b> 问题</a></li>
<li class="chapter" data-level="12.6.2" data-path="section-12.html"><a href="section-12.html#-49"><i class="fa fa-check"></i><b>12.6.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="section-12.html"><a href="section-12.html#ggplot"><i class="fa fa-check"></i><b>12.7</b> ggplot|坐标轴</a><ul>
<li class="chapter" data-level="12.7.1" data-path="section-12.html"><a href="section-12.html#-54"><i class="fa fa-check"></i><b>12.7.1</b> 问题</a></li>
<li class="chapter" data-level="12.7.2" data-path="section-12.html"><a href="section-12.html#-50"><i class="fa fa-check"></i><b>12.7.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="section-12.html"><a href="section-12.html#-ggplot2"><i class="fa fa-check"></i><b>12.8</b> 图例 (ggplot2)</a><ul>
<li class="chapter" data-level="12.8.1" data-path="section-12.html"><a href="section-12.html#-55"><i class="fa fa-check"></i><b>12.8.1</b> 问题</a></li>
<li class="chapter" data-level="12.8.2" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>12.8.2</b> 解决方案</a></li>
<li class="chapter" data-level="12.8.3" data-path="section-12.html"><a href="section-12.html#section-12.8.3"><i class="fa fa-check"></i><b>12.8.3</b> 修改图例标题和标签的外观</a></li>
<li class="chapter" data-level="12.8.4" data-path="section-12.html"><a href="section-12.html#section-12.8.4"><i class="fa fa-check"></i><b>12.8.4</b> 修改图例框</a></li>
<li class="chapter" data-level="12.8.5" data-path="section-12.html"><a href="section-12.html#section-12.8.5"><i class="fa fa-check"></i><b>12.8.5</b> 改变图例位置</a></li>
<li class="chapter" data-level="12.8.6" data-path="section-12.html"><a href="section-12.html#section-12.8.6"><i class="fa fa-check"></i><b>12.8.6</b> 隐藏在图例中的斜线</a></li>
<li class="chapter" data-level="12.8.7" data-path="section-2.html"><a href="section-2.html#-9"><i class="fa fa-check"></i><b>12.8.7</b> 注意</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="section-12.html"><a href="section-12.html#-ggplot2"><i class="fa fa-check"></i><b>12.9</b> 线条 (ggplot2)</a><ul>
<li class="chapter" data-level="12.9.1" data-path="section-12.html"><a href="section-12.html#-56"><i class="fa fa-check"></i><b>12.9.1</b> 问题</a></li>
<li class="chapter" data-level="12.9.2" data-path="section-1.html"><a href="section-1.html#-2"><i class="fa fa-check"></i><b>12.9.2</b> 解决方案</a></li>
</ul></li>
<li class="chapter" data-level="12.10" data-path="section-12.html"><a href="section-12.html#ggplot-"><i class="fa fa-check"></i><b>12.10</b> ggplot | 分面</a><ul>
<li class="chapter" data-level="12.10.1" data-path="section-12.html"><a href="section-12.html#-57"><i class="fa fa-check"></i><b>12.10.1</b> 问题</a></li>
<li class="chapter" data-level="12.10.2" data-path="section-12.html"><a href="section-12.html#-51"><i class="fa fa-check"></i><b>12.10.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.11" data-path="section-12.html"><a href="section-12.html#ggplot-"><i class="fa fa-check"></i><b>12.11</b> ggplot |多图</a><ul>
<li class="chapter" data-level="12.11.1" data-path="section-12.html"><a href="section-12.html#-58"><i class="fa fa-check"></i><b>12.11.1</b> 问题</a></li>
<li class="chapter" data-level="12.11.2" data-path="section-12.html"><a href="section-12.html#-52"><i class="fa fa-check"></i><b>12.11.2</b> 方案</a></li>
<li class="chapter" data-level="12.11.3" data-path="section-12.html"><a href="section-12.html#multiplot-"><i class="fa fa-check"></i><b>12.11.3</b> multiplot 函数</a></li>
</ul></li>
<li class="chapter" data-level="12.12" data-path="section-12.html"><a href="section-12.html#ggplot2"><i class="fa fa-check"></i><b>12.12</b> 颜色（ggplot2)</a><ul>
<li class="chapter" data-level="12.12.1" data-path="section-12.html"><a href="section-12.html#-59"><i class="fa fa-check"></i><b>12.12.1</b> 问题</a></li>
<li class="chapter" data-level="12.12.2" data-path="section-1.html"><a href="section-1.html#-3"><i class="fa fa-check"></i><b>12.12.2</b> 解决方案</a></li>
</ul></li>
<li class="chapter" data-level="12.13" data-path="section-12.html"><a href="section-12.html#--pdf-png-tiff-svg"><i class="fa fa-check"></i><b>12.13</b> 图形混杂-输出到文件-PDF-PNG-TIFF-SVG</a><ul>
<li class="chapter" data-level="12.13.1" data-path="section-12.html"><a href="section-12.html#-60"><i class="fa fa-check"></i><b>12.13.1</b> 问题</a></li>
<li class="chapter" data-level="12.13.2" data-path="section-12.html"><a href="section-12.html#-53"><i class="fa fa-check"></i><b>12.13.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.14" data-path="section-11.html"><a href="section-11.html#-"><i class="fa fa-check"></i><b>12.14</b> 图形混杂-形状和线形</a><ul>
<li class="chapter" data-level="12.14.1" data-path="section-12.html"><a href="section-12.html#-61"><i class="fa fa-check"></i><b>12.14.1</b> 问题</a></li>
<li class="chapter" data-level="12.14.2" data-path="section-12.html"><a href="section-12.html#-54"><i class="fa fa-check"></i><b>12.14.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.15" data-path="section-11.html"><a href="section-11.html#-"><i class="fa fa-check"></i><b>12.15</b> 图形混杂-字体</a><ul>
<li class="chapter" data-level="12.15.1" data-path="section-12.html"><a href="section-12.html#-62"><i class="fa fa-check"></i><b>12.15.1</b> 问题</a></li>
<li class="chapter" data-level="12.15.2" data-path="section-12.html"><a href="section-12.html#-55"><i class="fa fa-check"></i><b>12.15.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.16" data-path="section-11.html"><a href="section-11.html#-"><i class="fa fa-check"></i><b>12.16</b> 图形混杂-抗混淆位图输出</a><ul>
<li class="chapter" data-level="12.16.1" data-path="section-12.html"><a href="section-12.html#-63"><i class="fa fa-check"></i><b>12.16.1</b> 问题</a></li>
<li class="chapter" data-level="12.16.2" data-path="section-12.html"><a href="section-12.html#-56"><i class="fa fa-check"></i><b>12.16.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.17" data-path="section-11.html"><a href="section-11.html#-"><i class="fa fa-check"></i><b>12.17</b> 标准绘图 | 散点图</a><ul>
<li class="chapter" data-level="12.17.1" data-path="section-12.html"><a href="section-12.html#-64"><i class="fa fa-check"></i><b>12.17.1</b> 问题</a></li>
<li class="chapter" data-level="12.17.2" data-path="section-12.html"><a href="section-12.html#-57"><i class="fa fa-check"></i><b>12.17.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.18" data-path="section-12.html"><a href="section-12.html#section-12.18"><i class="fa fa-check"></i><b>12.18</b> 标准绘图|箱线图</a><ul>
<li class="chapter" data-level="12.18.1" data-path="section-12.html"><a href="section-12.html#-65"><i class="fa fa-check"></i><b>12.18.1</b> 问题</a></li>
<li class="chapter" data-level="12.18.2" data-path="section-12.html"><a href="section-12.html#-58"><i class="fa fa-check"></i><b>12.18.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.19" data-path="section-12.html"><a href="section-12.html#qq"><i class="fa fa-check"></i><b>12.19</b> 标准绘图|QQ图</a><ul>
<li class="chapter" data-level="12.19.1" data-path="section-12.html"><a href="section-12.html#-66"><i class="fa fa-check"></i><b>12.19.1</b> 问题</a></li>
<li class="chapter" data-level="12.19.2" data-path="section-12.html"><a href="section-12.html#-59"><i class="fa fa-check"></i><b>12.19.2</b> 方案</a></li>
</ul></li>
<li class="chapter" data-level="12.20" data-path="section-11.html"><a href="section-11.html#-"><i class="fa fa-check"></i><b>12.20</b> 其他有趣图形-相关矩阵</a><ul>
<li class="chapter" data-level="12.20.1" data-path="section-12.html"><a href="section-12.html#-67"><i class="fa fa-check"></i><b>12.20.1</b> 问题</a></li>
<li class="chapter" data-level="12.20.2" data-path="section-12.html"><a href="section-12.html#-60"><i class="fa fa-check"></i><b>12.20.2</b> 方案</a></li>
<li class="chapter" data-level="12.20.3" data-path="section-1.html"><a href="section-1.html#-1"><i class="fa fa-check"></i><b>12.20.3</b> 提示</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="section-13.html"><a href="section-13.html"><i class="fa fa-check"></i><b>13</b> 脚本与函数</a><ul>
<li class="chapter" data-level="13.1" data-path="section-13.html"><a href="section-13.html#section-13.1"><i class="fa fa-check"></i><b>13.1</b> 创建和运行一个脚本</a><ul>
<li class="chapter" data-level="13.1.1" data-path="section-13.html"><a href="section-13.html#section-13.1.1"><i class="fa fa-check"></i><b>13.1.1</b> 参考文献：</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="section-13.html"><a href="section-13.html#section-13.2"><i class="fa fa-check"></i><b>13.2</b> 调试脚本或函数</a><ul>
<li class="chapter" data-level="13.2.1" data-path="section-13.html"><a href="section-13.html#-68"><i class="fa fa-check"></i><b>13.2.1</b> 问题</a></li>
<li class="chapter" data-level="13.2.2" data-path="section-12.html"><a href="section-12.html#-61"><i class="fa fa-check"></i><b>13.2.2</b> 方案</a></li>
<li class="chapter" data-level="13.2.3" data-path="section-13.html"><a href="section-13.html#section-13.2.3"><i class="fa fa-check"></i><b>13.2.3</b> <strong>有用的选择</strong></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="section-13.html"><a href="section-13.html#section-13.3"><i class="fa fa-check"></i><b>13.3</b> 测量经过的时间</a><ul>
<li class="chapter" data-level="13.3.1" data-path="section-13.html"><a href="section-13.html#-69"><i class="fa fa-check"></i><b>13.3.1</b> <strong>问题</strong></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="section-13.html"><a href="section-13.html#section-13.4"><i class="fa fa-check"></i><b>13.4</b> 获取包中的函数和对象列表</a><ul>
<li class="chapter" data-level="13.4.1" data-path="section-13.html"><a href="section-13.html#-70"><i class="fa fa-check"></i><b>13.4.1</b> 问题</a></li>
<li class="chapter" data-level="13.4.2" data-path="section-12.html"><a href="section-12.html#-62"><i class="fa fa-check"></i><b>13.4.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="section-14.html"><a href="section-14.html"><i class="fa fa-check"></i><b>14</b> 工具</a><ul>
<li class="chapter" data-level="14.1" data-path="section-14.html"><a href="section-14.html#section-14.1"><i class="fa fa-check"></i><b>14.1</b> 生成拉丁方</a><ul>
<li class="chapter" data-level="14.1.1" data-path="section-14.html"><a href="section-14.html#-71"><i class="fa fa-check"></i><b>14.1.1</b> 问题</a></li>
<li class="chapter" data-level="14.1.2" data-path="section-12.html"><a href="section-12.html#-63"><i class="fa fa-check"></i><b>14.1.2</b> 方案</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="sound.html"><a href="sound.html"><i class="fa fa-check"></i><b>A</b> 余音绕梁</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cookbook for R 中文版</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-12" class="section level1">
<h1><span class="header-section-number">第 12 章</span> 图形</h1>
<div id="section-12.1" class="section level2">
<h2><span class="header-section-number">12.1</span> 条形图与线图</h2>
<div id="-49" class="section level3">
<h3><span class="header-section-number">12.1.1</span> 问题</h3>
<p>你想要创建基本的条形图与线图</p>
</div>
<div id="-45" class="section level3">
<h3><span class="header-section-number">12.1.2</span> 方案</h3>
<p>想要使用ggplot2绘制图形，数据必须是一个数据框，而且必须是长格式。</p>
<div id="x-axis" class="section level4">
<h4><span class="header-section-number">12.1.2.1</span> 基本图形，离散x-axis</h4>
<p>使用条形图，条形的高度通常代表这种不同的东西：</p>
<ul>
<li>每一组事件的<strong>计数</strong>，通过<code>stat_bin</code>指定，ggplot2默认使用该选项</li>
<li>数据集中某一列的<strong>值</strong>，通过<code>stat_identity</code>指定</li>
</ul>
<table>
<thead>
<tr class="header">
<th>x axis</th>
<th>高度含义</th>
<th>Common name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>连续</strong></td>
<td><strong>计数</strong></td>
<td>直方图</td>
</tr>
<tr class="even">
<td><strong>离散</strong></td>
<td><strong>计数</strong></td>
<td>条形图</td>
</tr>
<tr class="odd">
<td><strong>连续</strong></td>
<td><strong>数值</strong></td>
<td>条形图</td>
</tr>
<tr class="even">
<td><strong>离散</strong></td>
<td><strong>数值</strong></td>
<td>条形图</td>
</tr>
</tbody>
</table>
<div id="section-12.1.2.1.1" class="section level5">
<h5><span class="header-section-number">12.1.2.1.1</span> 有值的条形图</h5>
<p>这里有一些样例数据 (抽自reshape2包的 <code>tips</code> 数据集):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">time =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>), <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>)),
  <span class="dt">total_bill =</span> <span class="kw">c</span>(<span class="fl">14.89</span>, <span class="fl">17.23</span>)
)
dat
<span class="co">#&gt;     time total_bill</span>
<span class="co">#&gt; 1  Lunch      14.89</span>
<span class="co">#&gt; 2 Dinner      17.23</span>

<span class="co"># Load the ggplot2 package</span>
<span class="kw">library</span>(ggplot2)</code></pre></div>
<p>在这些例子中，条形的高度代表数据框某一列的<strong>值</strong>，所以使用<code>stat=&quot;identity&quot;</code> 而不是默认的<code>stat=&quot;bin&quot;</code>。</p>
<p>这里使用的映射变量为：</p>
<ul>
<li><code>time</code>: x-axis 和有时填充颜色</li>
<li><code>total_bill</code>: y-axis</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 非常基本的条形图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)


<span class="co"># 按时间填充颜色</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>time)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)

## 这和上面是一样的结果
<span class="co"># ggplot(data=dat, aes(x=time, y=total_bill)) +</span>
<span class="co">#    geom_bar(aes(fill=time), stat=&quot;identity&quot;)</span>


<span class="co"># 添加黑色的边框线</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>time)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)


<span class="co"># 没有图例，因为这个信息是多余的</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>time)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3" /></p>
<p>一个理想的条形图可能是下面这样的：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 添加题目，缩小箱宽，填充颜色，改变轴标签</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>time)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;#DD8888&quot;</span>, <span class="dt">width=</span>.<span class="dv">8</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" />
<p class="caption">plot of chunk unnamed-chunk-4</p>
</div>
<p>参见 <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)">../Colors (ggplot2)</a> 获取更多关于颜色的信息。</p>
</div>
<div id="section-12.1.2.1.2" class="section level5">
<h5><span class="header-section-number">12.1.2.1.2</span> 计数的条形图</h5>
<p>在下面例子中，条形高度代表事件的计数。</p>
<p>我们直接使用<code>reshape2</code>的<code>tips</code>数据集。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
<span class="co"># 查看头几行</span>
<span class="kw">head</span>(tips)
<span class="co">#&gt;   total_bill  tip    sex smoker day   time size</span>
<span class="co">#&gt; 1      16.99 1.01 Female     No Sun Dinner    2</span>
<span class="co">#&gt; 2      10.34 1.66   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 3      21.01 3.50   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 4      23.68 3.31   Male     No Sun Dinner    2</span>
<span class="co">#&gt; 5      24.59 3.61 Female     No Sun Dinner    4</span>
<span class="co">#&gt; 6      25.29 4.71   Male     No Sun Dinner    4</span></code></pre></div>
<p>想要得到一个计数的条形图，不要映射变量到<code>y</code>，使用 <code>stat=&quot;bin&quot;</code> (默认就是这个) 而不是<code>stat=&quot;identity&quot;</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 计数的条形图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>tips, <span class="kw">aes</span>(<span class="dt">x=</span>day)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;count&quot;</span>)
## 和上面等同, 因为stat=&quot;bin&quot;是默认
<span class="co"># ggplot(data=tips, aes(x=day)) +</span>
<span class="co">#    geom_bar()</span></code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" />
<p class="caption">plot of chunk unnamed-chunk-6</p>
</div>
</div>
</div>
<div id="section-12.1.2.2" class="section level4">
<h4><span class="header-section-number">12.1.2.2</span> 线图</h4>
<p>对于线图，数据点必须分组从而R知道怎么连接这些点。如果只有一组的话，非常简单，设定<code>group=1</code>即可，如果是多组，需要设定分组变量。</p>
<p>下面是使用的映射变量</p>
<ul>
<li><code>time</code>: x-axis</li>
<li><code>total_bill</code>: y-axis</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本的线图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>()
## This would have the same result as above
<span class="co"># ggplot(data=dat, aes(x=time, y=total_bill)) +</span>
<span class="co">#     geom_line(aes(group=1))</span>

<span class="co"># 添加点</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()

<span class="co"># 改变线和点的颜色</span>
<span class="co"># 改变线的类型和点的类型，用更粗的线、更大的点</span>
<span class="co"># 用红色填充点</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">4</span>, <span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-7-3.png" alt="plot of chunk unnamed-chunk-7" /></p>
<p>理想的线图可能像下面这样：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设定y轴的范围</span>
<span class="co"># 改变轴标签</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" />
<p class="caption">plot of chunk unnamed-chunk-8</p>
</div>
</div>
</div>
<div id="section-12.1.3" class="section level3">
<h3><span class="header-section-number">12.1.3</span> 有更多变量的图</h3>
<p>下面这个数据将用于接下来的例子</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">sex =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Male&quot;</span>)),
    <span class="dt">time =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>,<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>), <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>)),
    <span class="dt">total_bill =</span> <span class="kw">c</span>(<span class="fl">13.53</span>, <span class="fl">16.81</span>, <span class="fl">16.24</span>, <span class="fl">17.42</span>)
)
dat1
<span class="co">#&gt;      sex   time total_bill</span>
<span class="co">#&gt; 1 Female  Lunch      13.53</span>
<span class="co">#&gt; 2 Female Dinner      16.81</span>
<span class="co">#&gt; 3   Male  Lunch      16.24</span>
<span class="co">#&gt; 4   Male Dinner      17.42</span></code></pre></div>
<div id="section-12.1.3.1" class="section level4">
<h4><span class="header-section-number">12.1.3.1</span> 条形图</h4>
<p>变量映射：</p>
<ul>
<li><code>time</code>: x-axis</li>
<li><code>sex</code>: color fill</li>
<li><code>total_bill</code>: y-axis.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 堆积条形图 -- 不常用</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)

<span class="co"># 条形图，x轴是time,颜色填充是sex </span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>())

<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)

<span class="co"># 改变颜色</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-2.png" alt="plot of chunk unnamed-chunk-10" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-3.png" alt="plot of chunk unnamed-chunk-10" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-10-4.png" alt="plot of chunk unnamed-chunk-10" /></p>
<p>改变映射是非常容易的</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 条形图，x轴是性别，颜色是时间</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>sex, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>time)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" />
<p class="caption">plot of chunk unnamed-chunk-11</p>
</div>
</div>
<div id="-1" class="section level4">
<h4><span class="header-section-number">12.1.3.2</span> 线图</h4>
<p>变量映射：</p>
<ul>
<li><code>time</code>: x-axis</li>
<li><code>sex</code>: line color</li>
<li><code>total_bill</code>: y-axis.</li>
</ul>
<p>想要绘制多条线，必须指定分组变量。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本的带点线图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()

<span class="co"># 将性别映射到颜色</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex, <span class="dt">colour=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()

<span class="co"># 映射性别到不同的点类型</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex, <span class="dt">shape=</span>sex)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()


<span class="co"># 使用更粗的线、更大的点</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex, <span class="dt">shape=</span>sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">size=</span><span class="fl">1.5</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">22</span>,<span class="dv">21</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-3.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-12-4.png" alt="plot of chunk unnamed-chunk-12" /></p>
<p>更改颜色和线型变量的映射非常容易：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>sex, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>time, <span class="dt">shape=</span>time, <span class="dt">color=</span>time)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" />
<p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
</div>
<div id="section-12.1.3.3" class="section level4">
<h4><span class="header-section-number">12.1.3.3</span> 完成的例子</h4>
<p>完成的例子可能像下面这样</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一个条形图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">fill=</span>sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,
             <span class="dt">position=</span><span class="kw">position_dodge</span>(),
             <span class="dt">size=</span>.<span class="dv">3</span>) <span class="op">+</span><span class="st">                        </span><span class="co"># 更粗的线</span>
<span class="st">    </span><span class="kw">scale_fill_hue</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>) <span class="op">+</span><span class="st">      </span><span class="co"># 设定图例标题</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 设定轴标签</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>) <span class="op">+</span><span class="st">     </span><span class="co"># 设定题目</span>
<span class="st">    </span><span class="kw">theme_bw</span>()


<span class="co"># 一个线图</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>dat1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex, <span class="dt">shape=</span>sex, <span class="dt">colour=</span>sex)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype=</span>sex), <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">     </span><span class="co"># 按性别设定线型</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st">         </span><span class="co"># 使用更大的点，并用颜色填充</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span><span class="st">                       </span><span class="co"># 将0包含仅y轴</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>,      <span class="co"># 设定图例标题</span>
                     <span class="dt">l=</span><span class="dv">30</span>)  <span class="op">+</span><span class="st">                  </span><span class="co"># 使用更深的颜色 (lightness=30)</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>,
                       <span class="dt">values=</span><span class="kw">c</span>(<span class="dv">22</span>,<span class="dv">21</span>)) <span class="op">+</span><span class="st">      </span><span class="co"># </span>
<span class="st">    </span><span class="kw">scale_linetype_discrete</span>(<span class="dt">name=</span><span class="st">&quot;Sex of payer&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 设定轴标签</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>) <span class="op">+</span><span class="st">     </span><span class="co"># 设定标题</span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(.<span class="dv">7</span>, .<span class="dv">4</span>))           <span class="co"># 图例的位置</span>
                                              </code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14" /></p>
<p>为了保证上图的图例一致，必须指定3次。至于为何如此，点击 <a href="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)#With_lines_and_points">这里</a>。</p>
</div>
</div>
<div id="-x-axis" class="section level3">
<h3><span class="header-section-number">12.1.4</span> 使用数值 x-axis</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datn &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">supp dose length</span>
<span class="st">  OJ  0.5  13.23</span>
<span class="st">  OJ  1.0  22.70</span>
<span class="st">  OJ  2.0  26.06</span>
<span class="st">  VC  0.5   7.98</span>
<span class="st">  VC  1.0  16.77</span>
<span class="st">  VC  2.0  26.14</span>
<span class="st">&#39;</span>)</code></pre></div>
<p>来自<code>ToothGrowth</code> 数据集。</p>
<div id="x-axis" class="section level4">
<h4><span class="header-section-number">12.1.4.1</span> 当x-axis作为连续变量时</h4>
<p>我们可以用它绘制一个线图</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>datn, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>length, <span class="dt">group=</span>supp, <span class="dt">colour=</span>supp)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" />
<p class="caption">plot of chunk unnamed-chunk-16</p>
</div>
</div>
<div id="x-axis" class="section level4">
<h4><span class="header-section-number">12.1.4.2</span> 当x-axis作为分类变量时</h4>
<p>首先，我们要将该变量转换为因子。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 拷贝数据框并将它转换为因子</span>
datn2 &lt;-<span class="st"> </span>datn
datn2<span class="op">$</span>dose &lt;-<span class="st"> </span><span class="kw">factor</span>(datn2<span class="op">$</span>dose)
<span class="kw">ggplot</span>(<span class="dt">data=</span>datn2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>length, <span class="dt">group=</span>supp, <span class="dt">colour=</span>supp)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()

<span class="co"># 使用原始的数据框，但使用factor函数在绘图时转换</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>datn, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(dose), <span class="dt">y=</span>length, <span class="dt">group=</span>supp, <span class="dt">colour=</span>supp)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-17-2.png" alt="plot of chunk unnamed-chunk-17" /></p>
<p>当连续值作为分类变量使用时，也可以绘制条形图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>datn2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>length, <span class="dt">fill=</span>supp)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>())

<span class="kw">ggplot</span>(<span class="dt">data=</span>datn, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">factor</span>(dose), <span class="dt">y=</span>length, <span class="dt">fill=</span>supp)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">position=</span><span class="kw">position_dodge</span>())</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" /><img src="http://www.cookbook-r.com/Graphs/Bar_and_line_graphs_(ggplot2)/figure/unnamed-chunk-18-2.png" alt="plot of chunk unnamed-chunk-18" /></p>
</div>
</div>
</div>
<div id="section-12.2" class="section level2">
<h2><span class="header-section-number">12.2</span> 绘制均值和误差棒</h2>
<div id="-50" class="section level3">
<h3><span class="header-section-number">12.2.1</span> 问题</h3>
<p>你想要为一个数据集绘制均值的误差棒。</p>
</div>
<div id="-46" class="section level3">
<h3><span class="header-section-number">12.2.2</span> 方案</h3>
<p>想要用ggplot2绘制图形，数据必须是数据框形式，而且是长格式（相对于宽格式）。 如果你的数据需要重构，请参考 <a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format">this page</a> 获取更多信息。</p>
<div id="section-12.2.2.1" class="section level4">
<h4><span class="header-section-number">12.2.2.1</span> 示例数据</h4>
<p>下面的示例将使用 <code>ToothGrowth</code> 数据集。注意 <code>dose</code> 在这里是一个数值列， 一些情况下我们将它转换为因子变量将会更加有用。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tg &lt;-<span class="st"> </span>ToothGrowth
<span class="kw">head</span>(tg)
<span class="co">#&gt;    len supp dose</span>
<span class="co">#&gt; 1  4.2   VC  0.5</span>
<span class="co">#&gt; 2 11.5   VC  0.5</span>
<span class="co">#&gt; 3  7.3   VC  0.5</span>
<span class="co">#&gt; 4  5.8   VC  0.5</span>
<span class="co">#&gt; 5  6.4   VC  0.5</span>
<span class="co">#&gt; 6 10.0   VC  0.5</span>

<span class="kw">library</span>(ggplot2)</code></pre></div>
<p>首先，我们必须对数据进行统计汇总。 这可以通过多种方式实现，参考<a href="http://www.cookbook-r.com/Manipulating_data/Summarizing_data">this page</a>. 在这个案例中，我们将使用 <code>summarySE()</code> 函数，该函数代码在本页面的最下方 ( <code>summarySE</code> 函数的代码在使用前必须已经键入)。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># summarySE 函数提供了标准差、标准误以及95%的置信区间</span>
tgc &lt;-<span class="st"> </span><span class="kw">summarySE</span>(tg, <span class="dt">measurevar=</span><span class="st">&quot;len&quot;</span>, <span class="dt">groupvars=</span><span class="kw">c</span>(<span class="st">&quot;supp&quot;</span>,<span class="st">&quot;dose&quot;</span>))
tgc
<span class="co">#&gt;   supp dose  N   len       sd        se       ci</span>
<span class="co">#&gt; 1   OJ  0.5 10 13.23 4.459709 1.4102837 3.190283</span>
<span class="co">#&gt; 2   OJ  1.0 10 22.70 3.910953 1.2367520 2.797727</span>
<span class="co">#&gt; 3   OJ  2.0 10 26.06 2.655058 0.8396031 1.899314</span>
<span class="co">#&gt; 4   VC  0.5 10  7.98 2.746634 0.8685620 1.964824</span>
<span class="co">#&gt; 5   VC  1.0 10 16.77 2.515309 0.7954104 1.799343</span>
<span class="co">#&gt; 6   VC  2.0 10 26.14 4.797731 1.5171757 3.432090</span></code></pre></div>
</div>
</div>
<div id="-2" class="section level3">
<h3><span class="header-section-number">12.2.3</span> 线图</h3>
<p>数据统计总结后，我们就可以开始绘制图形了。这里是一些带误差棒的线图和点图，误差棒代表标准差、标准误或者是95%的置信区间。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 均值的标准误</span>
<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">colour=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se), <span class="dt">width=</span>.<span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()


<span class="co"># 发现误差棒重叠（dose=2.0），我们使用 position_dodge 将它们进行水平移动</span>
pd &lt;-<span class="st"> </span><span class="kw">position_dodge</span>(<span class="fl">0.1</span>) <span class="co"># move them .05 to the left and right</span>

<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">colour=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se), <span class="dt">width=</span>.<span class="dv">1</span>, <span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">position=</span>pd)


<span class="co"># 使用95%置信区间替换标准误</span>
<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">colour=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>ci, <span class="dt">ymax=</span>len<span class="op">+</span>ci), <span class="dt">width=</span>.<span class="dv">1</span>, <span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">position=</span>pd)

<span class="co"># 黑色的误差棒 - 注意&#39;group=supp&#39;的映射 -- 没有它，误差棒将不会避开（就是会重叠）。</span>
<span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">colour=</span>supp, <span class="dt">group=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>ci, <span class="dt">ymax=</span>len<span class="op">+</span>ci), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">width=</span>.<span class="dv">1</span>, <span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">position=</span>pd, <span class="dt">size=</span><span class="dv">3</span>)</code></pre></div>
<p>plot of chunk unnamed-chunk-4</p>
<p>plot of chunk unnamed-chunk-4</p>
<p>plot of chunk unnamed-chunk-4</p>
<p>plot of chunk unnamed-chunk-4</p>
<p>一张完成的带误差棒（代表均值的标准误）的图形可能像下面显示的那样。最会画点，这样白色将会在线和误差棒的上面（这个需要理解图层概念，顺序不同展示的效果是不一样的）。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tgc, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">colour=</span>supp, <span class="dt">group=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">width=</span>.<span class="dv">1</span>, <span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">position=</span>pd) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">position=</span>pd, <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 21的填充的圆</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Dose (mg)&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Tooth length&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">name=</span><span class="st">&quot;Supplement type&quot;</span>,    <span class="co"># 图例标签使用暗色</span>
                     <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">&quot;OJ&quot;</span>, <span class="st">&quot;VC&quot;</span>),
                     <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Orange juice&quot;</span>, <span class="st">&quot;Ascorbic acid&quot;</span>),
                     <span class="dt">l=</span><span class="dv">40</span>) <span class="op">+</span><span class="st">                    </span><span class="co"># 使用暗色，亮度为40</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;The Effect of Vitamin C on</span><span class="ch">\n</span><span class="st">Tooth Growth in Guinea Pigs&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>) <span class="op">+</span><span class="st">                        </span><span class="co"># 扩展范围</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="dv">0</span><span class="op">:</span><span class="dv">20</span><span class="op">*</span><span class="dv">4</span>) <span class="op">+</span><span class="st">         </span><span class="co"># 每4个单位设置标记（y轴）</span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.justification=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),
          <span class="dt">legend.position=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))               <span class="co"># 右下方放置图例</span></code></pre></div>
<p>plot of chunk unnamed-chunk-5</p>
</div>
<div id="section-12.2.4" class="section level3">
<h3><span class="header-section-number">12.2.4</span> 直方图</h3>
<p>直方图绘制误差棒也非常相似。 注意 <code>tgc$dose</code> 必须是一个因子。如果它是一个数值向量，将会不起作用。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 将dose转换为因子变量</span>
tgc2 &lt;-<span class="st"> </span>tgc
tgc2<span class="op">$</span>dose &lt;-<span class="st"> </span><span class="kw">factor</span>(tgc2<span class="op">$</span>dose)

<span class="co"># 误差棒代表了均值的标准误</span>
<span class="kw">ggplot</span>(tgc2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">fill=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se),
                  <span class="dt">width=</span>.<span class="dv">2</span>,                    <span class="co"># 误差棒的宽度</span>
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>))


<span class="co"># 使用95%的置信区间替换标准误</span>
<span class="kw">ggplot</span>(tgc2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">fill=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>ci, <span class="dt">ymax=</span>len<span class="op">+</span>ci),
                  <span class="dt">width=</span>.<span class="dv">2</span>,                    <span class="co"># 误差棒的宽度</span>
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>))</code></pre></div>
<p>plot of chunk unnamed-chunk-6</p>
<p>plot of chunk unnamed-chunk-6</p>
<p>一张绘制完成的图片像下面这样：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(tgc2, <span class="kw">aes</span>(<span class="dt">x=</span>dose, <span class="dt">y=</span>len, <span class="dt">fill=</span>supp)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,
             <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="co"># 使用黑色边框,</span>
             <span class="dt">size=</span>.<span class="dv">3</span>) <span class="op">+</span><span class="st">      </span><span class="co"># 将线变细</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin=</span>len<span class="op">-</span>se, <span class="dt">ymax=</span>len<span class="op">+</span>se),
                  <span class="dt">size=</span>.<span class="dv">3</span>,    <span class="co"># 将线变细</span>
                  <span class="dt">width=</span>.<span class="dv">2</span>,
                  <span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&quot;Dose (mg)&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Tooth length&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_hue</span>(<span class="dt">name=</span><span class="st">&quot;Supplement type&quot;</span>, <span class="co"># Legend label, use darker colors</span>
                   <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">&quot;OJ&quot;</span>, <span class="st">&quot;VC&quot;</span>),
                   <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Orange juice&quot;</span>, <span class="st">&quot;Ascorbic acid&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;The Effect of Vitamin C on</span><span class="ch">\n</span><span class="st">Tooth Growth in Guinea Pigs&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="dv">0</span><span class="op">:</span><span class="dv">20</span><span class="op">*</span><span class="dv">4</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_bw</span>()</code></pre></div>
<p>plot of chunk unnamed-chunk-7</p>
</div>
<div id="section-12.2.5" class="section level3">
<h3><span class="header-section-number">12.2.5</span> 为组内变量添加误差棒</h3>
<p>当所有的变量都属于不同组别时，我们画标准误或者置信区间会显得非常简单直观。然而，当我们描绘的是组内变量（重复测量），那么添加标准误或者通常的置信区间可能会对不同条件下差异的推断产生误导作用。</p>
<p>下面的方法来自 <a href="http://tqmp.org/Content/vol04-2/p061/p061.html">Morey (2008)</a>，它是对 <a href="http://tqmp.org/Content/vol01-1/p042/p042.html">Cousineau (2005)</a>的矫正，而它所做的就是 提供比 <a href="http://www.springerlink.com/content/n2r2t04244246k68/">Loftus and Masson (1994)</a>更简单的方法。 你可以查看这些文章，以获得更多对组内变量误差棒问题的详细探讨和方案。</p>
<p>这里有一个组内变量的数据集 (from Morey 2008): pre/post-test。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfw &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st"> subject pretest posttest</span>
<span class="st">       1    59.4     64.5</span>
<span class="st">       2    46.4     52.4</span>
<span class="st">       3    46.0     49.7</span>
<span class="st">       4    49.0     48.7</span>
<span class="st">       5    32.5     37.4</span>
<span class="st">       6    45.2     49.5</span>
<span class="st">       7    60.3     59.9</span>
<span class="st">       8    54.3     54.1</span>
<span class="st">       9    45.4     49.6</span>
<span class="st">      10    38.9     48.5</span>
<span class="st"> &#39;</span>)

<span class="co"># 将物体的ID作为因子变量对待</span>
dfw<span class="op">$</span>subject &lt;-<span class="st"> </span><span class="kw">factor</span>(dfw<span class="op">$</span>subject)</code></pre></div>
<p>第一步是将该数据集转换为长格式。See <a href="http://www.cookbook-r.com/Manipulating_data/Converting_data_between_wide_and_long_format">this page</a> for more information about the conversion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 转换为长格式</span>
<span class="kw">library</span>(reshape2)
dfw_long &lt;-<span class="st"> </span><span class="kw">melt</span>(dfw,
                 <span class="dt">id.vars =</span> <span class="st">&quot;subject&quot;</span>,
                 <span class="dt">measure.vars =</span> <span class="kw">c</span>(<span class="st">&quot;pretest&quot;</span>,<span class="st">&quot;posttest&quot;</span>),
                 <span class="dt">variable.name =</span> <span class="st">&quot;condition&quot;</span>)

dfw_long
<span class="co">#&gt;    subject condition value</span>
<span class="co">#&gt; 1        1   pretest  59.4</span>
<span class="co">#&gt; 2        2   pretest  46.4</span>
<span class="co">#&gt; 3        3   pretest  46.0</span>
<span class="co">#&gt; 4        4   pretest  49.0</span>
<span class="co">#&gt; 5        5   pretest  32.5</span>
<span class="co">#&gt; 6        6   pretest  45.2</span>
<span class="co">#&gt; 7        7   pretest  60.3</span>
<span class="co">#&gt; 8        8   pretest  54.3</span>
<span class="co">#&gt; 9        9   pretest  45.4</span>
<span class="co">#&gt; 10      10   pretest  38.9</span>
<span class="co">#&gt; 11       1  posttest  64.5</span>
<span class="co">#&gt; 12       2  posttest  52.4</span>
<span class="co">#&gt; 13       3  posttest  49.7</span>
<span class="co">#&gt; 14       4  posttest  48.7</span>
<span class="co">#&gt; 15       5  posttest  37.4</span>
<span class="co">#&gt; 16       6  posttest  49.5</span>
<span class="co">#&gt; 17       7  posttest  59.9</span>
<span class="co">#&gt; 18       8  posttest  54.1</span>
<span class="co">#&gt; 19       9  posttest  49.6</span>
<span class="co">#&gt; 20      10  posttest  48.5</span></code></pre></div>
<p>使用 <code>summarySEwithin</code>函数瓦解数据 (defined at the [bottom](<a href="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/#Helper" class="uri">http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/#Helper</a> functions) of this page; both of the helper functions below must be entered before the function is called here).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfwc &lt;-<span class="st"> </span><span class="kw">summarySEwithin</span>(dfw_long, <span class="dt">measurevar=</span><span class="st">&quot;value&quot;</span>, <span class="dt">withinvars=</span><span class="st">&quot;condition&quot;</span>,
                        <span class="dt">idvar=</span><span class="st">&quot;subject&quot;</span>, <span class="dt">na.rm=</span><span class="ot">FALSE</span>, <span class="dt">conf.interval=</span>.<span class="dv">95</span>)

dfwc
<span class="co">#&gt;   condition  N value value_norm       sd        se       ci</span>
<span class="co">#&gt; 1  posttest 10 51.43      51.43 2.262361 0.7154214 1.618396</span>
<span class="co">#&gt; 2   pretest 10 47.74      47.74 2.262361 0.7154214 1.618396</span>

<span class="kw">library</span>(ggplot2)
<span class="co"># Make the graph with the 95% confidence interval</span>
<span class="kw">ggplot</span>(dfwc, <span class="kw">aes</span>(<span class="dt">x=</span>condition, <span class="dt">y=</span>value, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="dt">width=</span>.<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">ymin=</span>value<span class="op">-</span>ci, <span class="dt">ymax=</span>value<span class="op">+</span>ci)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylim</span>(<span class="dv">40</span>,<span class="dv">60</span>)</code></pre></div>
<p>plot of chunk unnamed-chunk-10</p>
<p><code>value</code>和<code>value_norm</code> 列代表了未标准化和标准化后的值。See the section below on normed means for more information.</p>
<div id="section-12.2.5.1" class="section level4">
<h4><span class="header-section-number">12.2.5.1</span> 理解组内变量的误差棒</h4>
<p>这部分解释组内的误差棒值是如何计算出来的。这些步骤仅作解释目的；它们对于绘制误差棒是<strong>非必需</strong>的。</p>
<p>下面独立数据的图形结果展示了组内变量<code>condition</code>存在连续一致的趋势，但使用常规的标准误（或者置信区间）则不能充分地展示这一点。Morey (2008) 和Cousineau (2005)的方法本质是标准化数据去移除组间的变化，计算出这个标准化数据的变异程度。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Use a consistent y range</span>
ymax &lt;-<span class="st"> </span><span class="kw">max</span>(dfw_long<span class="op">$</span>value)
ymin &lt;-<span class="st"> </span><span class="kw">min</span>(dfw_long<span class="op">$</span>value)

<span class="co"># Plot the individuals</span>
<span class="kw">ggplot</span>(dfw_long, <span class="kw">aes</span>(<span class="dt">x=</span>condition, <span class="dt">y=</span>value, <span class="dt">colour=</span>subject, <span class="dt">group=</span>subject)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ylim</span>(ymin,ymax)


<span class="co"># 创造标准化的版本</span>
dfwNorm.long &lt;-<span class="st"> </span><span class="kw">normDataWithin</span>(<span class="dt">data=</span>dfw_long, <span class="dt">idvar=</span><span class="st">&quot;subject&quot;</span>, <span class="dt">measurevar=</span><span class="st">&quot;value&quot;</span>)

<span class="co"># Plot the normed individuals</span>
<span class="kw">ggplot</span>(dfwNorm.long, <span class="kw">aes</span>(<span class="dt">x=</span>condition, <span class="dt">y=</span>value_norm, <span class="dt">colour=</span>subject, <span class="dt">group=</span>subject)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ylim</span>(ymin,ymax)</code></pre></div>
<p>plot of chunk unnamed-chunk-11</p>
<p>plot of chunk unnamed-chunk-11</p>
<p>针对正常（组间）方法和组内方法的误差棒差异在下面呈现。正常的方法计算出的误差棒用红色表示，组内方法的误差棒用黑色表示。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Instead of summarySEwithin, use summarySE, which treats condition as though it were a between-subjects variable</span>
dfwc_between &lt;-<span class="st"> </span><span class="kw">summarySE</span>(<span class="dt">data=</span>dfw_long, <span class="dt">measurevar=</span><span class="st">&quot;value&quot;</span>, <span class="dt">groupvars=</span><span class="st">&quot;condition&quot;</span>, <span class="dt">na.rm=</span><span class="ot">FALSE</span>, <span class="dt">conf.interval=</span>.<span class="dv">95</span>)
dfwc_between
<span class="co">#&gt;   condition  N value       sd       se       ci</span>
<span class="co">#&gt; 1   pretest 10 47.74 8.598992 2.719240 6.151348</span>
<span class="co">#&gt; 2  posttest 10 51.43 7.253972 2.293907 5.189179</span>

<span class="co"># 用红色显示组间的置信区间，用黑色展示组内的置信区间</span>
<span class="kw">ggplot</span>(dfwc_between, <span class="kw">aes</span>(<span class="dt">x=</span>condition, <span class="dt">y=</span>value, <span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="dt">width=</span>.<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">ymin=</span>value<span class="op">-</span>ci, <span class="dt">ymax=</span>value<span class="op">+</span>ci), <span class="dt">colour=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="dt">width=</span>.<span class="dv">1</span>, <span class="kw">aes</span>(<span class="dt">ymin=</span>value<span class="op">-</span>ci, <span class="dt">ymax=</span>value<span class="op">+</span>ci), <span class="dt">data=</span>dfwc) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>, <span class="dt">size=</span><span class="dv">3</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ylim</span>(ymin,ymax)</code></pre></div>
<p>plot of chunk unnamed-chunk-12</p>
</div>
<div id="section-12.2.5.2" class="section level4">
<h4><span class="header-section-number">12.2.5.2</span> 两个组内变量</h4>
<p>如果存在超过一个的组内变量，我们可以使用相同的函数<code>summarySEwithin</code>。下面的数据集来自<a href="http://books.google.com/books?id=zSi2AAAAIAAJ">Hays (1994)</a>，在 <a href="http://www.jstor.org/pss/40064075">Rouder and Morey (2005)</a>中用来绘制这类的组内误差棒。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st"> Subject RoundMono SquareMono RoundColor SquareColor</span>
<span class="st">       1        41         40         41          37</span>
<span class="st">       2        57         56         56          53</span>
<span class="st">       3        52         53         53          50</span>
<span class="st">       4        49         47         47          47</span>
<span class="st">       5        47         48         48          47</span>
<span class="st">       6        37         34         35          36</span>
<span class="st">       7        47         50         47          46</span>
<span class="st">       8        41         40         38          40</span>
<span class="st">       9        48         47         49          45</span>
<span class="st">      10        37         35         36          35</span>
<span class="st">      11        32         31         31          33</span>
<span class="st">      12        47         42         42          42</span>
<span class="st">&#39;</span>)</code></pre></div>
<p>数据集首先必须转换为长格式，列名显示了两个变量： shape (round/square) and color scheme (monochromatic/colored).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 转换为长格式</span>
<span class="kw">library</span>(reshape2)
data_long &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="dt">data=</span>data, <span class="dt">id.var=</span><span class="st">&quot;Subject&quot;</span>,
                  <span class="dt">measure.vars=</span><span class="kw">c</span>(<span class="st">&quot;RoundMono&quot;</span>, <span class="st">&quot;SquareMono&quot;</span>, <span class="st">&quot;RoundColor&quot;</span>, <span class="st">&quot;SquareColor&quot;</span>),
                  <span class="dt">variable.name=</span><span class="st">&quot;Condition&quot;</span>)
<span class="kw">names</span>(data_long)[<span class="kw">names</span>(data_long)<span class="op">==</span><span class="st">&quot;value&quot;</span>] &lt;-<span class="st"> &quot;Time&quot;</span>

<span class="co"># 拆分 Condition 列为 Shape and ColorScheme</span>
data_long<span class="op">$</span>Shape &lt;-<span class="st"> </span><span class="ot">NA</span>
data_long<span class="op">$</span>Shape[<span class="kw">grepl</span>(<span class="st">&quot;^Round&quot;</span>,  data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Round&quot;</span>
data_long<span class="op">$</span>Shape[<span class="kw">grepl</span>(<span class="st">&quot;^Square&quot;</span>, data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Square&quot;</span>
data_long<span class="op">$</span>Shape &lt;-<span class="st"> </span><span class="kw">factor</span>(data_long<span class="op">$</span>Shape)

data_long<span class="op">$</span>ColorScheme &lt;-<span class="st"> </span><span class="ot">NA</span>
data_long<span class="op">$</span>ColorScheme[<span class="kw">grepl</span>(<span class="st">&quot;Mono$&quot;</span>,  data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Monochromatic&quot;</span>
data_long<span class="op">$</span>ColorScheme[<span class="kw">grepl</span>(<span class="st">&quot;Color$&quot;</span>, data_long<span class="op">$</span>Condition)] &lt;-<span class="st"> &quot;Colored&quot;</span>
data_long<span class="op">$</span>ColorScheme &lt;-<span class="st"> </span><span class="kw">factor</span>(data_long<span class="op">$</span>ColorScheme, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Monochromatic&quot;</span>,<span class="st">&quot;Colored&quot;</span>))

<span class="co"># 现在移除 Condition column </span>
data_long<span class="op">$</span>Condition &lt;-<span class="st"> </span><span class="ot">NULL</span>

<span class="co"># 检查数据</span>
<span class="kw">head</span>(data_long)
<span class="co">#&gt;   Subject Time Shape   ColorScheme</span>
<span class="co">#&gt; 1       1   41 Round Monochromatic</span>
<span class="co">#&gt; 2       2   57 Round Monochromatic</span>
<span class="co">#&gt; 3       3   52 Round Monochromatic</span>
<span class="co">#&gt; 4       4   49 Round Monochromatic</span>
<span class="co">#&gt; 5       5   47 Round Monochromatic</span>
<span class="co">#&gt; 6       6   37 Round Monochromatic</span></code></pre></div>
<p>现在可以进行统计汇总和绘图了。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">datac &lt;-<span class="st"> </span><span class="kw">summarySEwithin</span>(data_long, <span class="dt">measurevar=</span><span class="st">&quot;Time&quot;</span>, <span class="dt">withinvars=</span><span class="kw">c</span>(<span class="st">&quot;Shape&quot;</span>,<span class="st">&quot;ColorScheme&quot;</span>), <span class="dt">idvar=</span><span class="st">&quot;Subject&quot;</span>)
datac
<span class="co">#&gt;    Shape   ColorScheme  N     Time Time_norm       sd        se        ci</span>
<span class="co">#&gt; 1  Round       Colored 12 43.58333  43.58333 1.212311 0.3499639 0.7702654</span>
<span class="co">#&gt; 2  Round Monochromatic 12 44.58333  44.58333 1.331438 0.3843531 0.8459554</span>
<span class="co">#&gt; 3 Square       Colored 12 42.58333  42.58333 1.461630 0.4219364 0.9286757</span>
<span class="co">#&gt; 4 Square Monochromatic 12 43.58333  43.58333 1.261312 0.3641095 0.8013997</span>

<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>(datac, <span class="kw">aes</span>(<span class="dt">x=</span>Shape, <span class="dt">y=</span>Time, <span class="dt">fill=</span>ColorScheme)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>), <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(.<span class="dv">9</span>), <span class="dt">width=</span>.<span class="dv">25</span>, <span class="kw">aes</span>(<span class="dt">ymin=</span>Time<span class="op">-</span>ci, <span class="dt">ymax=</span>Time<span class="op">+</span>ci)) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">40</span>,<span class="dv">46</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#CCCCCC&quot;</span>,<span class="st">&quot;#FFFFFF&quot;</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">100</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">38</span>) </code></pre></div>
<p>plot of chunk unnamed-chunk-15</p>
</div>
</div>
<div id="section-12.2.6" class="section level3">
<h3><span class="header-section-number">12.2.6</span> 注意标准化的均值</h3>
<p>函数 <code>summarySEWithin</code> 返回标准化和未标准化的均值。未标准化的均值只是简单地表示每组的均值。标准化的均值计算出来保证组间的均值是一样的。 These values can diverge when there are between-subject variables.</p>
<p>比如：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">id trial gender dv</span>
<span class="st"> A     0   male  2</span>
<span class="st"> A     1   male  4</span>
<span class="st"> B     0   male  6</span>
<span class="st"> B     1   male  8</span>
<span class="st"> C     0 female 22</span>
<span class="st"> C     1 female 24</span>
<span class="st"> D     0 female 26</span>
<span class="st"> D     1 female 28</span>
<span class="st">&#39;</span>)

<span class="co"># 标准化和未标准化的均值是不同的</span>
<span class="kw">summarySEwithin</span>(dat, <span class="dt">measurevar=</span><span class="st">&quot;dv&quot;</span>, <span class="dt">withinvars=</span><span class="st">&quot;trial&quot;</span>, <span class="dt">betweenvars=</span><span class="st">&quot;gender&quot;</span>,
                <span class="dt">idvar=</span><span class="st">&quot;id&quot;</span>)
<span class="co">#&gt; Automatically converting the following non-factors to factors: trial</span>
<span class="co">#&gt;   gender trial N dv dv_norm sd se ci</span>
<span class="co">#&gt; 1 female     0 2 24      14  0  0  0</span>
<span class="co">#&gt; 2 female     1 2 26      16  0  0  0</span>
<span class="co">#&gt; 3   male     0 2  4      14  0  0  0</span>
<span class="co">#&gt; 4   male     1 2  6      16  0  0  0</span></code></pre></div>
</div>
<div id="section-12.2.7" class="section level3">
<h3><span class="header-section-number">12.2.7</span> 助手函数</h3>
<p>如果你处理的仅仅是组间变量，那么<code>summarySE</code>是你代码中唯一需要使用的函数。如果你的数据里有组内变量，<strong>并且</strong>你想要矫正误差棒使得组间的变异被移除，就像 Loftus and Masson (1994)里的那样，那么<code>normDataWithin</code> 和 <code>summarySEwithin</code>这两个函数必须加入你的代码中，然后调用<code>summarySEwithin</code> 函数进行计算。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA&#39;s
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">data=</span><span class="ot">NULL</span>, measurevar, <span class="dt">groupvars=</span><span class="ot">NULL</span>, <span class="dt">na.rm=</span><span class="ot">FALSE</span>,
                      <span class="dt">conf.interval=</span>.<span class="dv">95</span>, <span class="dt">.drop=</span><span class="ot">TRUE</span>) {
    <span class="kw">library</span>(plyr)

    <span class="co"># New version of length which can handle NA&#39;s: if na.rm==T, don&#39;t count them</span>
    length2 &lt;-<span class="st"> </span><span class="cf">function</span> (x, <span class="dt">na.rm=</span><span class="ot">FALSE</span>) {
        <span class="cf">if</span> (na.rm) <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(x))
        <span class="cf">else</span>       <span class="kw">length</span>(x)
    }

    <span class="co"># This does the summary. For each group&#39;s data frame, return a vector with</span>
    <span class="co"># N, mean, and sd</span>
    datac &lt;-<span class="st"> </span><span class="kw">ddply</span>(data, groupvars, <span class="dt">.drop=</span>.drop,
      <span class="dt">.fun =</span> <span class="cf">function</span>(xx, col) {
        <span class="kw">c</span>(<span class="dt">N    =</span> <span class="kw">length2</span>(xx[[col]], <span class="dt">na.rm=</span>na.rm),
          <span class="dt">mean =</span> <span class="kw">mean</span>   (xx[[col]], <span class="dt">na.rm=</span>na.rm),
          <span class="dt">sd   =</span> <span class="kw">sd</span>     (xx[[col]], <span class="dt">na.rm=</span>na.rm)
        )
      },
      measurevar
    )

    <span class="co"># Rename the &quot;mean&quot; column    </span>
    datac &lt;-<span class="st"> </span><span class="kw">rename</span>(datac, <span class="kw">c</span>(<span class="st">&quot;mean&quot;</span> =<span class="st"> </span>measurevar))

    datac<span class="op">$</span>se &lt;-<span class="st"> </span>datac<span class="op">$</span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(datac<span class="op">$</span>N)  <span class="co"># Calculate standard error of the mean</span>

    <span class="co"># Confidence interval multiplier for standard error</span>
    <span class="co"># Calculate t-statistic for confidence interval: </span>
    <span class="co"># e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1</span>
    ciMult &lt;-<span class="st"> </span><span class="kw">qt</span>(conf.interval<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>.<span class="dv">5</span>, datac<span class="op">$</span>N<span class="op">-</span><span class="dv">1</span>)
    datac<span class="op">$</span>ci &lt;-<span class="st"> </span>datac<span class="op">$</span>se <span class="op">*</span><span class="st"> </span>ciMult

    <span class="kw">return</span>(datac)
}

## Norms the data within specified groups in a data frame; it normalizes each
## subject (identified by idvar) so that they have the same mean, within each group
## specified by betweenvars.
##   data: a data frame.
##   idvar: the name of a column that identifies each subject (or matched subjects)
##   measurevar: the name of a column that contains the variable to be summariezed
##   betweenvars: a vector containing names of columns that are between-subjects variables
##   na.rm: a boolean that indicates whether to ignore NA&#39;s
normDataWithin &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">data=</span><span class="ot">NULL</span>, idvar, measurevar, <span class="dt">betweenvars=</span><span class="ot">NULL</span>,
                           <span class="dt">na.rm=</span><span class="ot">FALSE</span>, <span class="dt">.drop=</span><span class="ot">TRUE</span>) {
    <span class="kw">library</span>(plyr)

    <span class="co"># Measure var on left, idvar + between vars on right of formula.</span>
    data.subjMean &lt;-<span class="st"> </span><span class="kw">ddply</span>(data, <span class="kw">c</span>(idvar, betweenvars), <span class="dt">.drop=</span>.drop,
     <span class="dt">.fun =</span> <span class="cf">function</span>(xx, col, na.rm) {
        <span class="kw">c</span>(<span class="dt">subjMean =</span> <span class="kw">mean</span>(xx[,col], <span class="dt">na.rm=</span>na.rm))
      },
      measurevar,
      na.rm
    )

    <span class="co"># Put the subject means with original data</span>
    data &lt;-<span class="st"> </span><span class="kw">merge</span>(data, data.subjMean)

    <span class="co"># Get the normalized data in a new column</span>
    measureNormedVar &lt;-<span class="st"> </span><span class="kw">paste</span>(measurevar, <span class="st">&quot;_norm&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)
    data[,measureNormedVar] &lt;-<span class="st"> </span>data[,measurevar] <span class="op">-</span><span class="st"> </span>data[,<span class="st">&quot;subjMean&quot;</span>] <span class="op">+</span>
<span class="st">                               </span><span class="kw">mean</span>(data[,measurevar], <span class="dt">na.rm=</span>na.rm)

    <span class="co"># Remove this subject mean column</span>
    data<span class="op">$</span>subjMean &lt;-<span class="st"> </span><span class="ot">NULL</span>

    <span class="kw">return</span>(data)
}

## Summarizes data, handling within-subjects variables by removing inter-subject variability.
## It will still work if there are no within-S variables.
## Gives count, un-normed mean, normed mean (with same between-group mean),
##   standard deviation, standard error of the mean, and confidence interval.
## If there are within-subject variables, calculate adjusted values using method from Morey (2008).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   betweenvars: a vector containing names of columns that are between-subjects variables
##   withinvars: a vector containing names of columns that are within-subjects variables
##   idvar: the name of a column that identifies each subject (or matched subjects)
##   na.rm: a boolean that indicates whether to ignore NA&#39;s
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySEwithin &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">data=</span><span class="ot">NULL</span>, measurevar, <span class="dt">betweenvars=</span><span class="ot">NULL</span>, <span class="dt">withinvars=</span><span class="ot">NULL</span>,
                            <span class="dt">idvar=</span><span class="ot">NULL</span>, <span class="dt">na.rm=</span><span class="ot">FALSE</span>, <span class="dt">conf.interval=</span>.<span class="dv">95</span>, <span class="dt">.drop=</span><span class="ot">TRUE</span>) {

  <span class="co"># Ensure that the betweenvars and withinvars are factors</span>
  factorvars &lt;-<span class="st"> </span><span class="kw">vapply</span>(data[, <span class="kw">c</span>(betweenvars, withinvars), <span class="dt">drop=</span><span class="ot">FALSE</span>],
    <span class="dt">FUN=</span>is.factor, <span class="dt">FUN.VALUE=</span><span class="kw">logical</span>(<span class="dv">1</span>))

  <span class="cf">if</span> (<span class="op">!</span><span class="kw">all</span>(factorvars)) {
    nonfactorvars &lt;-<span class="st"> </span><span class="kw">names</span>(factorvars)[<span class="op">!</span>factorvars]
    <span class="kw">message</span>(<span class="st">&quot;Automatically converting the following non-factors to factors: &quot;</span>,
            <span class="kw">paste</span>(nonfactorvars, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>))
    data[nonfactorvars] &lt;-<span class="st"> </span><span class="kw">lapply</span>(data[nonfactorvars], factor)
  }

  <span class="co"># Get the means from the un-normed data</span>
  datac &lt;-<span class="st"> </span><span class="kw">summarySE</span>(data, measurevar, <span class="dt">groupvars=</span><span class="kw">c</span>(betweenvars, withinvars),
                     <span class="dt">na.rm=</span>na.rm, <span class="dt">conf.interval=</span>conf.interval, <span class="dt">.drop=</span>.drop)

  <span class="co"># Drop all the unused columns (these will be calculated with normed data)</span>
  datac<span class="op">$</span>sd &lt;-<span class="st"> </span><span class="ot">NULL</span>
  datac<span class="op">$</span>se &lt;-<span class="st"> </span><span class="ot">NULL</span>
  datac<span class="op">$</span>ci &lt;-<span class="st"> </span><span class="ot">NULL</span>

  <span class="co"># Norm each subject&#39;s data</span>
  ndata &lt;-<span class="st"> </span><span class="kw">normDataWithin</span>(data, idvar, measurevar, betweenvars, na.rm, <span class="dt">.drop=</span>.drop)

  <span class="co"># This is the name of the new column</span>
  measurevar_n &lt;-<span class="st"> </span><span class="kw">paste</span>(measurevar, <span class="st">&quot;_norm&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)

  <span class="co"># Collapse the normed data - now we can treat between and within vars the same</span>
  ndatac &lt;-<span class="st"> </span><span class="kw">summarySE</span>(ndata, measurevar_n, <span class="dt">groupvars=</span><span class="kw">c</span>(betweenvars, withinvars),
                      <span class="dt">na.rm=</span>na.rm, <span class="dt">conf.interval=</span>conf.interval, <span class="dt">.drop=</span>.drop)

  <span class="co"># Apply correction from Morey (2008) to the standard error and confidence interval</span>
  <span class="co">#  Get the product of the number of conditions of within-S variables</span>
  nWithinGroups    &lt;-<span class="st"> </span><span class="kw">prod</span>(<span class="kw">vapply</span>(ndatac[,withinvars, <span class="dt">drop=</span><span class="ot">FALSE</span>], <span class="dt">FUN=</span>nlevels,
                           <span class="dt">FUN.VALUE=</span><span class="kw">numeric</span>(<span class="dv">1</span>)))
  correctionFactor &lt;-<span class="st"> </span><span class="kw">sqrt</span>( nWithinGroups <span class="op">/</span><span class="st"> </span>(nWithinGroups<span class="op">-</span><span class="dv">1</span>) )

  <span class="co"># Apply the correction factor</span>
  ndatac<span class="op">$</span>sd &lt;-<span class="st"> </span>ndatac<span class="op">$</span>sd <span class="op">*</span><span class="st"> </span>correctionFactor
  ndatac<span class="op">$</span>se &lt;-<span class="st"> </span>ndatac<span class="op">$</span>se <span class="op">*</span><span class="st"> </span>correctionFactor
  ndatac<span class="op">$</span>ci &lt;-<span class="st"> </span>ndatac<span class="op">$</span>ci <span class="op">*</span><span class="st"> </span>correctionFactor

  <span class="co"># Combine the un-normed means with the normed results</span>
  <span class="kw">merge</span>(datac, ndatac)
}</code></pre></div>
<hr />
<p>原文链接：&lt; <a href="http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/" class="uri">http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/</a>&gt;</p>
</div>
<div id="-1" class="section level3">
<h3><span class="header-section-number">12.2.8</span> 其他</h3>
<p>解决问题的方法不止作者提供的这一种，为了理解ggplot2是如何进行误差棒的计算和添加，我在stackoverflow上提交了一个关于<a href="https://stackoverflow.com/questions/46192556/errorbar-in-ggplot-is-using-sd-or-se-as-default">ggplot2使用SE还是SD作为默认误差棒的问题</a>。有人就提出了快速简易的解答。回答者的共同观点是必须先进行数据的统计计算。我之前在其他博客上看到的使用<code>stat_boxplot(geom=&quot;errorbar&quot;, width=.3)</code>直接计算误差棒可能就有问题（难以解释它算的是SD还是SE，我没有在帮助文档找到解释，我也不知道函数内部是如何计算的）。</p>
</div>
</div>
<div id="ggplot-" class="section level2">
<h2><span class="header-section-number">12.3</span> ggplot | 绘制分布图</h2>
<div id="-51" class="section level3">
<h3><span class="header-section-number">12.3.1</span> 问题</h3>
<p>你想要绘制一组数据的分布图。</p>
</div>
<div id="-47" class="section level3">
<h3><span class="header-section-number">12.3.2</span> 方案</h3>
<p>后面的例子中会使用以下这组简单的数据：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1234</span>)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>), <span class="dt">each=</span><span class="dv">200</span>)), 
                   <span class="dt">rating =</span> <span class="kw">c</span>(<span class="kw">rnorm</span>(<span class="dv">200</span>),<span class="kw">rnorm</span>(<span class="dv">200</span>, <span class="dt">mean=</span>.<span class="dv">8</span>)))
<span class="co"># 查看数据</span>
<span class="kw">head</span>(dat)
<span class="co">#&gt;   cond     rating</span>
<span class="co">#&gt; 1    A -1.2070657</span>
<span class="co">#&gt; 2    A  0.2774292</span>
<span class="co">#&gt; 3    A  1.0844412</span>
<span class="co">#&gt; 4    A -2.3456977</span>
<span class="co">#&gt; 5    A  0.4291247</span>
<span class="co">#&gt; 6    A  0.5060559</span>
<span class="kw">library</span>(ggplot2)</code></pre></div>
</div>
<div id="section-12.3.3" class="section level3">
<h3><span class="header-section-number">12.3.3</span> 直方图和概率密度图</h3>
<p><code>qplot</code> 函数能够用更简单的语法绘制出与 <code>ggplot</code> 相同的图像。然而，在实践过程中你会发现 <code>ggplot</code>是更好的选择，因为 <code>qplot</code> 中很多参数的选项都会让人感到困惑。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 以 rating 为横轴绘制直方图，组距设为 0.5
## 两种函数都可以绘制出相同的图:
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>)
<span class="co"># qplot(dat$rating, binwidth=.5)</span>
<span class="co"># 绘制黑色边线，白色填充的图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>)
<span class="co"># 密度曲线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()
<span class="co"># 直方图与核密度曲线重叠</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y=</span>..density..),      <span class="co"># 这里直方图以 density (密度)为y轴</span>
                   <span class="dt">binwidth=</span>.<span class="dv">5</span>,
                   <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span>.<span class="dv">2</span>, <span class="dt">fill=</span><span class="st">&quot;#FF6666&quot;</span>)  <span class="co"># 重合部分透明填充</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3" /></p>
<p>添加一条均值线</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span><span class="kw">mean</span>(rating, <span class="dt">na.rm=</span>T)),   <span class="co"># 忽略缺失值</span>
               <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" />
<p class="caption">plot of chunk unnamed-chunk-4</p>
</div>
</div>
<div id="section-12.3.4" class="section level3">
<h3><span class="header-section-number">12.3.4</span> 多组数据的直方图和概率密度图</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 重叠直方图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>, <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>) <span class="co"># identity 表示将每个对象直接显示在图中，条形会彼此重叠。</span>
<span class="co"># 间隔直方图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">position=</span><span class="st">&quot;dodge&quot;</span>) <span class="co"># dodge 表示将每组的条形依次并列放置。</span>
<span class="co"># 密度图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating, <span class="dt">colour=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>()
<span class="co"># 半透明填充的密度图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_density</span>(<span class="dt">alpha=</span>.<span class="dv">3</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-3.png" alt="plot of chunk unnamed-chunk-5" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-5-4.png" alt="plot of chunk unnamed-chunk-5" /></p>
<p>在给每组数据添加均值线前，需要将每组数据的平均值赋值到一个新的数据框。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 求均值</span>
<span class="kw">library</span>(plyr)
cdat &lt;-<span class="st"> </span><span class="kw">ddply</span>(dat, <span class="st">&quot;cond&quot;</span>, summarise, <span class="dt">rating.mean=</span><span class="kw">mean</span>(rating))
cdat
<span class="co">#&gt;   cond rating.mean</span>
<span class="co">#&gt; 1    A -0.05775928</span>
<span class="co">#&gt; 2    B  0.87324927</span>
<span class="co"># 给重叠直方图添加均值线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>, <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">data=</span>cdat, <span class="kw">aes</span>(<span class="dt">xintercept=</span>rating.mean,  <span class="dt">colour=</span>cond),
               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>)
<span class="co"># 给密度图添加均值线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating, <span class="dt">colour=</span>cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">data=</span>cdat, <span class="kw">aes</span>(<span class="dt">xintercept=</span>rating.mean,  <span class="dt">colour=</span>cond),
               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6" /></p>
<p>使用分面：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_grid</span>(cond <span class="op">~</span><span class="st"> </span>.)
<span class="co"># 使用之前的 cdat 添加均值线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span>.<span class="dv">5</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_grid</span>(cond <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_vline</span>(<span class="dt">data=</span>cdat, <span class="kw">aes</span>(<span class="dt">xintercept=</span>rating.mean),
               <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">colour=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" />
<p class="caption">plot of chunk unnamed-chunk-7</p>
</div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7" />
<p class="caption">plot of chunk unnamed-chunk-7</p>
</div>
<p>更多关于分面的细节可查看<a href="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)">Facets (ggplot2)</a></p>
</div>
</div>
<div id="section-12.4" class="section level2">
<h2><span class="header-section-number">12.4</span> 箱型图</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 绘制箱型图</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()
<span class="co"># 对分组填充颜色</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()
<span class="co"># 将上图中冗余的图例删除掉：</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>)
<span class="co"># 坐标轴翻转</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>rating, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-2.png" alt="plot of chunk unnamed-chunk-8" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-3.png" alt="plot of chunk unnamed-chunk-8" /> <img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-8-4.png" alt="plot of chunk unnamed-chunk-8" /></p>
<p>同时可以通过 <code>stat_summary</code> 来添加平均值。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 用菱形图标指征平均值，并调整参数使该图标变更大。</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>rating)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_summary</span>(<span class="dt">fun.y=</span>mean, <span class="dt">geom=</span><span class="st">&quot;point&quot;</span>, <span class="dt">shape=</span><span class="dv">5</span>, <span class="dt">size=</span><span class="dv">4</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Plotting_distributions_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" />
<p class="caption">plot of chunk unnamed-chunk-9</p>
</div>
</div>
<div id="ggplot" class="section level2">
<h2><span class="header-section-number">12.5</span> ggplot|散点图</h2>
<div id="-52" class="section level3">
<h3><span class="header-section-number">12.5.1</span> 问题</h3>
<p>你想要绘制一幅散点图。</p>
</div>
<div id="-48" class="section level3">
<h3><span class="header-section-number">12.5.2</span> 方案</h3>
<p>假设这是你的数据：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">955</span>)
<span class="co">#创建一些噪声数据</span>
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="dt">each=</span><span class="dv">10</span>),
                  <span class="dt">xvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>),
                  <span class="dt">yvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>))
<span class="kw">head</span>(dat)
<span class="co">#&gt;   cond      xvar         yvar</span>
<span class="co">#&gt; 1    A -4.252354  3.473157275</span>
<span class="co">#&gt; 2    A  1.702318  0.005939612</span>
<span class="co">#&gt; 3    A  4.323054 -0.094252427</span>
<span class="co">#&gt; 4    A  1.780628  2.072808278</span>
<span class="co">#&gt; 5    A 11.537348  1.215440358</span>
<span class="co">#&gt; 6    A  6.672130  3.608111411</span>

<span class="kw">library</span>(ggplot2)</code></pre></div>
<div id="section-12.5.2.1" class="section level4">
<h4><span class="header-section-number">12.5.2.1</span> 带回归线的基本散点图</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)      <span class="co"># 使用空心圆</span>

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">    </span><span class="co"># 使用空心圆</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm)   <span class="co"># 添加回归线</span>
                             <span class="co"># (默认包含95%置信区间)</span>

<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">    </span><span class="co"># 使用空心圆</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm,   <span class="co"># 添加回归线</span>
                <span class="dt">se=</span><span class="ot">FALSE</span>)    <span class="co"># 不加置信区域</span>


<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span><span class="st">    </span><span class="co"># 使用空心圆</span>
<span class="st">    </span><span class="kw">geom_smooth</span>()            <span class="co"># 添加带置信区间的平滑拟合曲线</span>
<span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39;</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3" /></p>
</div>
<div id="section-12.5.2.2" class="section level4">
<h4><span class="header-section-number">12.5.2.2</span> 通过其他变量设置颜色和形状</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 根据cond设置颜色</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">color=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)

<span class="co"># 同上，但这里带了回归线</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">color=</span>cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">l=</span><span class="dv">50</span>) <span class="op">+</span><span class="st"> </span><span class="co"># 使用稍暗的调色板</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm,   
                <span class="dt">se=</span><span class="ot">FALSE</span>)    

<span class="co"># 拓展回归线到数据区域之外（带预测效果）</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">color=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_colour_hue</span>(<span class="dt">l=</span><span class="dv">50</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span>lm,   
                <span class="dt">se=</span><span class="ot">FALSE</span>,    
                <span class="dt">fullrange=</span><span class="ot">TRUE</span>) 


<span class="co"># 根据cond设置形状</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">shape=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()

<span class="co"># 同上，但形状不同</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xvar, <span class="dt">y=</span>yvar, <span class="dt">shape=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))  <span class="co"># 使用圆和三角形</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-4-5.png" alt="plot of chunk unnamed-chunk-4" /></p>
<p>阅读 <a href="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)">Colors (ggplot2)</a> 和Shapes and line types](<a href="http://www.cookbook-r.com/Graphs/Shapes_and_line_types" class="uri">http://www.cookbook-r.com/Graphs/Shapes_and_line_types</a>) 获取更多信息</p>
</div>
<div id="section-12.5.2.3" class="section level4">
<h4><span class="header-section-number">12.5.2.3</span> 处理图像元素叠加</h4>
<p>如果你有很多数据点，或者你的数据是离散的，那么数据可能会覆盖到一起，这样就看不清楚同一个位置有多少数据了。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 取近似值</span>
dat<span class="op">$</span>xrnd &lt;-<span class="st"> </span><span class="kw">round</span>(dat<span class="op">$</span>xvar<span class="op">/</span><span class="dv">5</span>)<span class="op">*</span><span class="dv">5</span>
dat<span class="op">$</span>yrnd &lt;-<span class="st"> </span><span class="kw">round</span>(dat<span class="op">$</span>yvar<span class="op">/</span><span class="dv">5</span>)<span class="op">*</span><span class="dv">5</span>

<span class="co"># 让每个点都部分透明</span>
<span class="co"># 如果情况严重，可以使用更小的值</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xrnd, <span class="dt">y=</span>yrnd)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">19</span>,      
               <span class="dt">alpha=</span><span class="dv">1</span><span class="op">/</span><span class="dv">4</span>)     


<span class="co"># 抖动点</span>
<span class="co"># 抖动范围在x轴上是1，y轴上是0.5</span>
<span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>xrnd, <span class="dt">y=</span>yrnd)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>,      
               <span class="dt">position=</span><span class="kw">position_jitter</span>(<span class="dt">width=</span><span class="dv">1</span>,<span class="dt">height=</span>.<span class="dv">5</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /><img src="http://www.cookbook-r.com/Graphs/Scatterplots_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" /></p>
</div>
</div>
</div>
<div id="ggplot-" class="section level2">
<h2><span class="header-section-number">12.6</span> ggplot | 标题</h2>
<div id="-53" class="section level3">
<h3><span class="header-section-number">12.6.1</span> 问题</h3>
<p>你想给图形设定一个标题。</p>
</div>
<div id="-49" class="section level3">
<h3><span class="header-section-number">12.6.2</span> 方案</h3>
<p>一个不带标题的图形例子：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(PlantGrowth, <span class="kw">aes</span>(<span class="dt">x=</span>group, <span class="dt">y=</span>weight)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()
bp</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" />
<p class="caption">plot of chunk unnamed-chunk-2</p>
</div>
<p>添加标题</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Plant growth&quot;</span>)
## 等同于
<span class="co"># bp + labs(title=&quot;Plant growth&quot;)</span>
<span class="co"># 如果标题比较长，可以用 \n 将它分成多行来显示</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Plant growth with</span><span class="ch">\n</span><span class="st">different treatments&quot;</span>)
<span class="co"># 缩少行距并使用粗体</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Plant growth with</span><span class="ch">\n</span><span class="st">different treatments&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">     </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">lineheight=</span>.<span class="dv">8</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /> <img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /> <img src="http://www.cookbook-r.com/Graphs/Titles_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /></p>
</div>
</div>
<div id="ggplot" class="section level2">
<h2><span class="header-section-number">12.7</span> ggplot|坐标轴</h2>
<div id="-54" class="section level3">
<h3><span class="header-section-number">12.7.1</span> 问题</h3>
<p>你想要改变轴的顺序或方向。</p>
</div>
<div id="-50" class="section level3">
<h3><span class="header-section-number">12.7.2</span> 方案</h3>
<blockquote>
<p>注意：下面的例子中提到的<code>scale_y_continuous</code>、<code>ylim</code>等，<code>y</code>都可以替换为<code>x</code>。</p>
</blockquote>
<p>下面使用内置的<code>PlantGrowth</code>数据集绘制一个基本的箱线图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(PlantGrowth, <span class="kw">aes</span>(<span class="dt">x=</span>group, <span class="dt">y=</span>weight)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>()
bp</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" />
<p class="caption">plot of chunk unnamed-chunk-2</p>
</div>
<div id="xy" class="section level4">
<h4><span class="header-section-number">12.7.2.1</span> 交换x和y轴</h4>
<p>交换x和y轴（让x垂直、y水平）</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>()</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" />
<p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
</div>
<div id="section-12.7.2.2" class="section level4">
<h4><span class="header-section-number">12.7.2.2</span> 离散轴</h4>
<div id="section-12.7.2.2.1" class="section level5">
<h5><span class="header-section-number">12.7.2.2.1</span> 改变条目的顺序</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 手动设定离散轴条目的顺序</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="st">&quot;trt1&quot;</span>,<span class="st">&quot;trt2&quot;</span>,<span class="st">&quot;ctrl&quot;</span>))

## 逆转轴条目顺序
<span class="co"># 获取因子水平</span>
flevels &lt;-<span class="st"> </span><span class="kw">levels</span>(PlantGrowth<span class="op">$</span>group)
flevels
<span class="co">#&gt; [1] &quot;ctrl&quot; &quot;trt1&quot; &quot;trt2&quot;</span>

<span class="co"># 逆转顺序</span>
flevels &lt;-<span class="st"> </span><span class="kw">rev</span>(flevels)
flevels
<span class="co">#&gt; [1] &quot;trt2&quot; &quot;trt1&quot; &quot;ctrl&quot;</span>

bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits=</span>flevels)

<span class="co"># 或者一行搞定</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">limits =</span> <span class="kw">rev</span>(<span class="kw">levels</span>(PlantGrowth<span class="op">$</span>group)))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4" /></p>
</div>
<div id="section-12.7.2.2.2" class="section level5">
<h5><span class="header-section-number">12.7.2.2.2</span> 设定标签</h5>
<p>对于离散变量，标签来自于因子水平。然而，有时候短的因子水平名字并不适合展示。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>),
                      <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treat 1&quot;</span>, <span class="st">&quot;Treat 2&quot;</span>))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" />
<p class="caption">plot of chunk unnamed-chunk-5</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏x刻度、标签和网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">breaks=</span><span class="ot">NULL</span>)

<span class="co"># 隐藏所有的刻度和标签（X轴），保留网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6" /></p>
</div>
</div>
<div id="section-12.7.2.3" class="section level4">
<h4><span class="header-section-number">12.7.2.3</span> 连续轴</h4>
<div id="section-12.7.2.3.1" class="section level5">
<h5><span class="header-section-number">12.7.2.3.1</span> 设定范围和反转轴方向</h5>
<p>如果你仅想简单地让轴包含某个值，可以使用<code>expand_limits()</code>，它会进行拓展而不是拉伸。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 确保y轴包含0</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="dv">0</span>)

<span class="co"># 确保y轴包含0和8</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">8</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7" /></p>
<p>当然你也可以通过y刻度显式地指定。注意如果使用<strong>任何</strong><code>scale_y_continuous</code> 命令，它会覆盖任何<code>ylim</code>命令，而且<code>ylim</code>会被忽略。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 设定连续值轴的范围
<span class="co"># 下面是相等的操作</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">0</span>, <span class="dv">8</span>)
<span class="co"># bp + scale_y_continuous(limits=c(0, 8))</span></code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" />
<p class="caption">plot of chunk unnamed-chunk-8</p>
</div>
<p>如果使用上述方法让y轴的范围变小，任何超出范围的数据都会被忽略。有时候这会产生一些问题，读者需要注意。</p>
<p>为了避免产生问题，你可以使用 <code>coord_cartesian</code> ，相比于设定轴的范围，它设定数据可视化的区域。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## 这两个操作一致，超出范围的数据被删除了，导致产生一个误导的箱线图 
bp <span class="op">+</span><span class="st"> </span><span class="kw">ylim</span>(<span class="dv">5</span>, <span class="fl">7.5</span>)
<span class="co">#&gt; Warning: Removed 13 rows containing non-finite values (stat_boxplot).</span>
<span class="co"># bp + scale_y_continuous(limits=c(5, 7.5))</span>

<span class="co"># 使用coord_cartesian &quot;zooms&quot;区域</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">7.5</span>))

<span class="co"># 直接指定刻度</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">5</span>, <span class="fl">7.5</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.25</span>))  <span class="co"># Ticks from 0-10, every .25</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-9-2.png" alt="plot of chunk unnamed-chunk-9" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-9-3.png" alt="plot of chunk unnamed-chunk-9" /></p>
</div>
<div id="section-12.7.2.3.2" class="section level5">
<h5><span class="header-section-number">12.7.2.3.2</span> 反转轴方向</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 反转一个连续值轴的方向</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_reverse</span>()</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" />
<p class="caption">plot of chunk unnamed-chunk-10</p>
</div>
</div>
<div id="section-12.7.2.3.3" class="section level5">
<h5><span class="header-section-number">12.7.2.3.3</span> 设置和隐藏刻度标记</h5>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Setting the tick marks on an axis</span>
<span class="co"># This will show tick marks on every 0.25 from 1 to 10</span>
<span class="co"># The scale will show only the ones that are within range (3.50-6.25 in this case)</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span><span class="op">/</span><span class="dv">4</span>))

<span class="co"># 刻度不平等变化</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">4</span>, <span class="fl">4.25</span>, <span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">6</span>,<span class="dv">8</span>))

<span class="co"># 抑制标签和网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks=</span><span class="ot">NULL</span>)

<span class="co"># Hide tick marks and labels (on Y axis), but keep the gridlines</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(), <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>())</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-3.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-11-4.png" alt="plot of chunk unnamed-chunk-11" /></p>
</div>
<div id="logsqrt" class="section level5">
<h5><span class="header-section-number">12.7.2.3.4</span> 轴转log、sqrt等</h5>
<p>默认轴是线性坐标，我们也可以将它转换为log、幂、根等等。</p>
<p>有两种办法可以转换一个轴，一是使用<em>scale</em>进行转换，另外是使用<em>coordinate</em>进行转换。使用前者需要在先弄好刻度和轴的范围之前转换，而使用后者则相反，需要在弄好刻度和轴范围之后转换。这将产生不太一样的显示效果，如下所示。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 创建指数分布数据</span>
<span class="kw">set.seed</span>(<span class="dv">201</span>)
n &lt;-<span class="st"> </span><span class="dv">100</span>
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">xval =</span> (<span class="dv">1</span><span class="op">:</span>n<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dt">sd=</span><span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>,
    <span class="dt">yval =</span> <span class="dv">2</span><span class="op">*</span><span class="dv">2</span><span class="op">^</span>((<span class="dv">1</span><span class="op">:</span>n<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dt">sd=</span><span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>)
)

<span class="co"># 创建常规的散点图</span>
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(xval, yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
sp

<span class="co"># log2比例化（间隔相等）</span>
<span class="kw">library</span>(scales)     <span class="co"># 需要scales包</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">trans=</span><span class="kw">log2_trans</span>())

<span class="co"># log2坐标转换，空间间隔不同</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">y=</span><span class="st">&quot;log2&quot;</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-12-3.png" alt="plot of chunk unnamed-chunk-12" /></p>
<p>在标度转换中，我们还可以指定刻度值，让它们显示指数。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">trans =</span> <span class="kw">log2_trans</span>(),
                        <span class="dt">breaks =</span> <span class="kw">trans_breaks</span>(<span class="st">&quot;log2&quot;</span>, <span class="cf">function</span>(x) <span class="dv">2</span><span class="op">^</span>x),
                        <span class="dt">labels =</span> <span class="kw">trans_format</span>(<span class="st">&quot;log2&quot;</span>, <span class="kw">math_format</span>(<span class="dv">2</span><span class="op">^</span>.x)))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" />
<p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
<p>可以使用非常多的转换，参见 <code>?trans_new</code> 查看所有可用转换的列表。如果你所需要的转换不在该列表上，可以自己写一个转换函数。</p>
<p>有一些非常便捷的函数：<code>scale_y_log10</code>和<code>scale_y_sqrt</code> （有对应的x版本）。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">205</span>)
n &lt;-<span class="st"> </span><span class="dv">100</span>
dat10 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">xval =</span> (<span class="dv">1</span><span class="op">:</span>n<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dt">sd=</span><span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>,
    <span class="dt">yval =</span> <span class="dv">10</span><span class="op">*</span><span class="dv">10</span><span class="op">^</span>((<span class="dv">1</span><span class="op">:</span>n<span class="op">+</span><span class="kw">rnorm</span>(n,<span class="dt">sd=</span><span class="dv">5</span>))<span class="op">/</span><span class="dv">20</span>)
)

sp10 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat10, <span class="kw">aes</span>(xval, yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()

<span class="co"># log10</span>
sp10 <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()

<span class="co"># log10 with exponents on tick labels</span>
sp10 <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>(<span class="dt">breaks =</span> <span class="kw">trans_breaks</span>(<span class="st">&quot;log10&quot;</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="op">^</span>x),
                     <span class="dt">labels =</span> <span class="kw">trans_format</span>(<span class="st">&quot;log10&quot;</span>, <span class="kw">math_format</span>(<span class="dv">10</span><span class="op">^</span>.x)))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14" /></p>
</div>
<div id="xy" class="section level5">
<h5><span class="header-section-number">12.7.2.3.5</span> x与y轴固定的比例</h5>
<p>设置x与y轴比例宽度也是可以的。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># x范围0-10, y范围0-30</span>
<span class="kw">set.seed</span>(<span class="dv">202</span>)
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">xval =</span> <span class="kw">runif</span>(<span class="dv">40</span>,<span class="dv">0</span>,<span class="dv">10</span>),
    <span class="dt">yval =</span> <span class="kw">runif</span>(<span class="dv">40</span>,<span class="dv">0</span>,<span class="dv">30</span>)
)
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(xval, yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()

<span class="co"># 强制比例相等</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>()

<span class="co"># 相等的标度变化，让x的1个单位等同y的3个单位</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">coord_fixed</span>(<span class="dt">ratio=</span><span class="dv">1</span><span class="op">/</span><span class="dv">3</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-15-2.png" alt="plot of chunk unnamed-chunk-15" /></p>
</div>
</div>
<div id="section-12.7.2.4" class="section level4">
<h4><span class="header-section-number">12.7.2.4</span> 轴标签和文字格式化</h4>
<p>设置和隐藏轴标签：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>()) <span class="op">+</span><span class="st">   </span><span class="co"># 移除x轴标签</span>
<span class="st">     </span><span class="kw">ylab</span>(<span class="st">&quot;Weight (Kg)&quot;</span>)                       <span class="co"># 设置y轴标签</span>

<span class="co"># 也可以通过标度设置</span>
<span class="co"># 注意这里x轴标签的空间仍然保留</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_discrete</span>(<span class="dt">name=</span><span class="st">&quot;&quot;</span>) <span class="op">+</span>
<span class="st">     </span><span class="kw">scale_y_continuous</span>(<span class="dt">name=</span><span class="st">&quot;Weight (Kg)&quot;</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-16-2.png" alt="plot of chunk unnamed-chunk-16" /></p>
<p>改变字体、颜色、旋转刻度标签：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Change font options:</span>
<span class="co"># X-axis label: bold, red, and 20 points</span>
<span class="co"># X-axis tick marks: rotate 90 degrees CCW, move to the left a bit (using vjust,</span>
<span class="co">#   since the labels are rotated), and 16 points</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.title.x =</span> <span class="kw">element_text</span>(<span class="dt">face=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">size=</span><span class="dv">20</span>),
           <span class="dt">axis.text.x  =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">90</span>, <span class="dt">vjust=</span><span class="fl">0.5</span>, <span class="dt">size=</span><span class="dv">16</span>))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" />
<p class="caption">plot of chunk unnamed-chunk-17</p>
</div>
</div>
<div id="section-12.7.2.5" class="section level4">
<h4><span class="header-section-number">12.7.2.5</span> 刻度标签</h4>
<p>你可能想将值显示为百分比、或美元、或科学计数法。这里可以使用<strong>格式器</strong>，它是一个可以改变文本的函数。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 标签格式器</span>
<span class="kw">library</span>(scales)   <span class="co"># 需要scales包</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels=</span>percent) <span class="op">+</span>
<span class="st">     </span><span class="kw">scale_x_discrete</span>(<span class="dt">labels=</span>abbreviate)  <span class="co"># 在这个例子中它没作用</span></code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" />
<p class="caption">plot of chunk unnamed-chunk-18</p>
</div>
<p>连续标度格式器有<code>comma</code>、<code>percent</code>、<code>dollar</code>以及<code>scientific</code>。离散标度格式器有<code>abbreviate</code>、<code>date_format</code>等。</p>
<p>有时你需要自己创建格式化函数。下面的函数可以显示时间格式为HH:MM:SS。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 自定义时间格式化函数</span>
timeHMS_formatter &lt;-<span class="st"> </span><span class="cf">function</span>(x) {
    h &lt;-<span class="st"> </span><span class="kw">floor</span>(x<span class="op">/</span><span class="dv">60</span>)
    m &lt;-<span class="st"> </span><span class="kw">floor</span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">60</span>)
    s &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="dv">60</span><span class="op">*</span>(x <span class="op">%%</span><span class="st"> </span><span class="dv">1</span>))                   <span class="co"># Round to nearest second</span>
    lab &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&#39;%02d:%02d:%02d&#39;</span>, h, m, s) <span class="co"># Format the strings as HH:MM:SS</span>
    lab &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;^00:&#39;</span>, <span class="st">&#39;&#39;</span>, lab)              <span class="co"># Remove leading 00: if present</span>
    lab &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;^0&#39;</span>, <span class="st">&#39;&#39;</span>, lab)                <span class="co"># Remove leading 0 if present</span>
}

bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_continuous</span>(<span class="dt">label=</span>timeHMS_formatter)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" />
<p class="caption">plot of chunk unnamed-chunk-19</p>
</div>
</div>
<div id="section-12.7.2.6" class="section level4">
<h4><span class="header-section-number">12.7.2.6</span> 隐藏网格线</h4>
<p>隐藏网格线：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏所有网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>(),
           <span class="dt">panel.grid.major=</span><span class="kw">element_blank</span>())

<span class="co"># 仅隐藏次级网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor=</span><span class="kw">element_blank</span>())</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-20-1.png" alt="plot of chunk unnamed-chunk-20" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-20-2.png" alt="plot of chunk unnamed-chunk-20" /></p>
<p>也可以仅隐藏水平或垂直网格线：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 隐藏所有垂直网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.x=</span><span class="kw">element_blank</span>(),
           <span class="dt">panel.grid.major.x=</span><span class="kw">element_blank</span>())

<span class="co"># 隐藏所有水平网格线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor.y=</span><span class="kw">element_blank</span>(),
           <span class="dt">panel.grid.major.y=</span><span class="kw">element_blank</span>())</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-21-1.png" alt="plot of chunk unnamed-chunk-21" /><img src="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)/figure/unnamed-chunk-21-2.png" alt="plot of chunk unnamed-chunk-21" /></p>
</div>
</div>
</div>
<div id="-ggplot2" class="section level2">
<h2><span class="header-section-number">12.8</span> 图例 (ggplot2)</h2>
<div id="-55" class="section level3">
<h3><span class="header-section-number">12.8.1</span> 问题</h3>
<p>你想用ggplot2修改图表中的图例。</p>
</div>
<div id="-1" class="section level3">
<h3><span class="header-section-number">12.8.2</span> 解决方案</h3>
<p>从带有默认选项的示例图开始：</p>
<pre><code>library(ggplot2)
bp &lt;- ggplot(data=PlantGrowth, aes(x=group, y=weight, fill=group)) + geom_boxplot()
bp</code></pre>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" />
<p class="caption">plot of chunk unnamed-chunk-2</p>
</div>
<div id="section-12.8.2.1" class="section level4">
<h4><span class="header-section-number">12.8.2.1</span> 去除图例</h4>
<p>使用 <code>guides(fill=FALSE)</code>, 用想要的颜色替代填充色.</p>
<p>你也可以用<code>theme</code> 移除图表中所有的图例。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 删除特定美学的图例（填充）</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="ot">FALSE</span>)

<span class="co"># 在指定比例时也可以这样做</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">guide=</span><span class="ot">FALSE</span>)

<span class="co"># 这将移除所有的图例</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" />
<p class="caption">plot of chunk unnamed-chunk-4</p>
</div>
</div>
<div id="section-12.8.2.2" class="section level4">
<h4><span class="header-section-number">12.8.2.2</span> 在图例中改变变量的顺序</h4>
<p>这会将变量的顺序更改为trt1，ctrl，trt2:</p>
<pre><code>bp + scale_fill_discrete(breaks=c(&quot;trt1&quot;,&quot;ctrl&quot;,&quot;trt2&quot;))</code></pre>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" />
<p class="caption">plot of chunk unnamed-chunk-5</p>
</div>
<p>根据指定颜色的方式，你可能必须使用不同的比例，例如 <code>scale_fill_manual</code>, <code>scale_colour_hue</code>, <code>scale_colour_manual</code>, <code>scale_shape_discrete</code>, <code>scale_linetype_discrete</code> 等等</p>
</div>
<div id="section-12.8.2.3" class="section level4">
<h4><span class="header-section-number">12.8.2.3</span> 反转图例中的条目顺序</h4>
<p>反转图例顺序:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 这两种方式等同:</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse=</span><span class="ot">TRUE</span>))
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">reverse=</span><span class="ot">TRUE</span>))

<span class="co"># 你也可以直接修改比例尺：</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">scale_fill_discrete</span>(<span class="dt">breaks =</span> <span class="kw">rev</span>(<span class="kw">levels</span>(PlantGrowth<span class="op">$</span>group)))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" />
<p class="caption">plot of chunk unnamed-chunk-7</p>
</div>
<p>你可以使用不同的比例尺，例如 <code>scale_fill_manual</code>, <code>scale_colour_hue</code>, <code>scale_colour_manual</code>, <code>scale_shape_discrete</code>, <code>scale_linetype_discrete</code>等等，而不是<code>scale_fill_discrete</code></p>
</div>
<div id="section-12.8.2.4" class="section level4">
<h4><span class="header-section-number">12.8.2.4</span> 隐藏图例标题</h4>
<p>这将隐藏图例标题:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 为了填充的图例移除标题</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">guides</span>(<span class="dt">fill=</span><span class="kw">guide_legend</span>(<span class="dt">title=</span><span class="ot">NULL</span>))

<span class="co"># 为了所有的图例移除标题</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.title=</span><span class="kw">element_blank</span>())</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" />
<p class="caption">plot of chunk unnamed-chunk-9</p>
</div>
</div>
<div id="section-12.8.2.5" class="section level4">
<h4><span class="header-section-number">12.8.2.5</span> 修改图例标题和标签的文字</h4>
<p>有两种方法可以更改图例标题和标签。 第一种方法是告诉* scale *使用具有不同的标题和标签。 第二种方法是更改数据框，使因子具有所需的形式。</p>
<div id="section-12.8.2.5.1" class="section level5">
<h5><span class="header-section-number">12.8.2.5.1</span> 使用比例尺</h5>
<p>图例可能由 <code>fill</code>, <code>colour</code>, <code>linetype</code>, <code>shape</code>, 或其他因素所介导.</p>
</div>
<div id="section-12.8.2.5.2" class="section level5">
<h5><span class="header-section-number">12.8.2.5.2</span> 使用填充和颜色</h5>
<p>因为图例中的变量<code>group</code>被映射到颜色<code>fill</code>，所以必须使用<code>scale_fill_xxx</code>，其中<code>xxx</code>是将<code>group</code>的每个因子级别映射到不同颜色的方法。 默认设置是在每个因子级别的色轮上使用不同的色调，但也可以手动指定每个级别的颜色。</p>
<pre><code>bp + scale_fill_discrete(name=&quot;Experimental\nCondition&quot;)

bp + scale_fill_discrete(name=&quot;Experimental\nCondition&quot;,
                         breaks=c(&quot;ctrl&quot;, &quot;trt1&quot;, &quot;trt2&quot;),
                         labels=c(&quot;Control&quot;, &quot;Treatment 1&quot;, &quot;Treatment 2&quot;))

# 使用手动刻度而不是色调
bp + scale_fill_manual(values=c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;), 
                       name=&quot;Experimental\nCondition&quot;,
                       breaks=c(&quot;ctrl&quot;, &quot;trt1&quot;, &quot;trt2&quot;),
                       labels=c(&quot;Control&quot;, &quot;Treatment 1&quot;, &quot;Treatment 2&quot;))</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-10-2.png" alt="plot of chunk unnamed-chunk-10" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-10-3.png" alt="plot of chunk unnamed-chunk-10" /></p>
<p>请注意，这并未更改x轴标签。 有关如何修改轴标签的信息，请参见<a href="http://www.cookbook-r.com/Graphs/Axes_(ggplot2)">Axes (ggplot2)</a>。</p>
<p>如果使用折线图，则可能需要使用<code>scale_colour_xxx</code>和/或<code>scale_shape_xxx</code>而不是<code>scale_fill_xxx</code>。 <strong>颜色</strong>映射到线条和点的颜色，而<strong>填充</strong>映射到区域填充的颜色。 <strong>形状</strong>映射到点的形状。</p>
<p>我们将在这里为线图使用不同的数据集，因为PlantGrowth数据集不适用于折线图。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一个不同的数据集</span>
df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">sex =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Male&quot;</span>)),
    <span class="dt">time =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>,<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>), <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;Lunch&quot;</span>,<span class="st">&quot;Dinner&quot;</span>)),
    <span class="dt">total_bill =</span> <span class="kw">c</span>(<span class="fl">13.53</span>, <span class="fl">16.81</span>, <span class="fl">16.24</span>, <span class="fl">17.42</span>)
)

<span class="co"># 基本的图表</span>
lp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>df1, <span class="kw">aes</span>(<span class="dt">x=</span>time, <span class="dt">y=</span>total_bill, <span class="dt">group=</span>sex, <span class="dt">shape=</span>sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()
lp

<span class="co"># 更改图例</span>
lp <span class="op">+</span><span class="st"> </span><span class="kw">scale_shape_discrete</span>(<span class="dt">name  =</span><span class="st">&quot;Payer&quot;</span>,
                          <span class="dt">breaks=</span><span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>),
                          <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11" /></p>
<p>如果你同时使用<code>colour</code>和<code>shape</code>，它们都需要给出比例规格。 否则会有两个独立的图例。</p>
<pre><code># 指定颜色和形状
lp1 &lt;- ggplot(data=df1, aes(x=time, y=total_bill, group=sex, shape=sex, colour=sex)) + geom_line() + geom_point()
lp1

# 如果你仅仅指定颜色，将会发生
lp1 + scale_colour_discrete(name  =&quot;Payer&quot;,
                            breaks=c(&quot;Female&quot;, &quot;Male&quot;),
                            labels=c(&quot;Woman&quot;, &quot;Man&quot;))

# 指定的颜色和形状
lp1 + scale_colour_discrete(name  =&quot;Payer&quot;,
                            breaks=c(&quot;Female&quot;, &quot;Male&quot;),
                            labels=c(&quot;Woman&quot;, &quot;Man&quot;)) +
      scale_shape_discrete(name  =&quot;Payer&quot;,
                           breaks=c(&quot;Female&quot;, &quot;Male&quot;),
                           labels=c(&quot;Woman&quot;, &quot;Man&quot;))</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-12-3.png" alt="plot of chunk unnamed-chunk-12" /></p>
</div>
<div id="section-12.8.2.5.3" class="section level5">
<h5><span class="header-section-number">12.8.2.5.3</span> 比例尺的种类</h5>
<p>比例尺有很多种。 它们采用“scale_xxx_yyy”的形式。 以下是一些常用的<code>xxx</code>和<code>yyy</code>值：</p>
<table>
<thead>
<tr class="header">
<th><strong>xxx</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>colour</td>
<td>Color of lines and points</td>
</tr>
<tr class="even">
<td>fill</td>
<td>填充区域的颜色 (比如：柱状图)</td>
</tr>
<tr class="odd">
<td>线条类型</td>
<td>Solid/dashed/dotted lines</td>
</tr>
<tr class="even">
<td>形状</td>
<td>Shape of points</td>
</tr>
<tr class="odd">
<td>大小</td>
<td>Size of points</td>
</tr>
<tr class="even">
<td>alpha</td>
<td>不透明度/透明度</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th><strong>yyy</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>hue</td>
<td>色轮的颜色相同</td>
</tr>
<tr class="even">
<td>manual</td>
<td>手动指定的值（例如，颜色，点形状，线型）</td>
</tr>
<tr class="odd">
<td>gradient</td>
<td>颜色渐变</td>
</tr>
<tr class="even">
<td>grey</td>
<td>Shades of grey</td>
</tr>
<tr class="odd">
<td>discrete</td>
<td>不连续的值 (比如颜色，点的形状，线条类型，点的大小</td>
</tr>
<tr class="even">
<td>continuous</td>
<td>连续的值（透明度，颜色，点的大小）</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="section-12.8.2.6" class="section level4">
<h4><span class="header-section-number">12.8.2.6</span> 更改数据框中的因子</h4>
<p>更改图例标题和标签的另一种方法是直接修改数据框。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pg &lt;-<span class="st"> </span>PlantGrowth    <span class="co"># 把数据复制到新的数据框</span>
<span class="co"># 重命名列中的列和值</span>
<span class="kw">levels</span>(pg<span class="op">$</span>group)[<span class="kw">levels</span>(pg<span class="op">$</span>group)<span class="op">==</span><span class="st">&quot;ctrl&quot;</span>] &lt;-<span class="st"> &quot;Control&quot;</span>
<span class="kw">levels</span>(pg<span class="op">$</span>group)[<span class="kw">levels</span>(pg<span class="op">$</span>group)<span class="op">==</span><span class="st">&quot;trt1&quot;</span>] &lt;-<span class="st"> &quot;Treatment 1&quot;</span>
<span class="kw">levels</span>(pg<span class="op">$</span>group)[<span class="kw">levels</span>(pg<span class="op">$</span>group)<span class="op">==</span><span class="st">&quot;trt2&quot;</span>] &lt;-<span class="st"> &quot;Treatment 2&quot;</span>
<span class="kw">names</span>(pg)[<span class="kw">names</span>(pg)<span class="op">==</span><span class="st">&quot;group&quot;</span>]  &lt;-<span class="st"> &quot;Experimental Condition&quot;</span>

<span class="co"># 查看最终结果的几行</span>
<span class="kw">head</span>(pg)
<span class="co">#&gt;   衡量实验调节</span>
<span class="co">#&gt; 1   4.17                Control</span>
<span class="co">#&gt; 2   5.58                Control</span>
<span class="co">#&gt; 3   5.18                Control</span>
<span class="co">#&gt; 4   6.11                Control</span>
<span class="co">#&gt; 5   4.50                Control</span>
<span class="co">#&gt; 6   4.61                Control</span>

<span class="co"># 画图 </span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>pg, <span class="kw">aes</span>(<span class="dt">x=</span><span class="st">`</span><span class="dt">Experimental Condition</span><span class="st">`</span>, <span class="dt">y=</span>weight, <span class="dt">fill=</span><span class="st">`</span><span class="dt">Experimental Condition</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" />
<p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
<p>图例标题“实验条件”很长，如果它被分成两行可能看起来更好，但是这种方法效果不好，因为你必须在列的名称中加上一个换行符。 另一种方法，有尺度，通常是更好的方法。</p>
<p>另请注意使用反引号而不是引号。 由于变量名中的空格，它们是必需的。</p>
</div>
</div>
<div id="section-12.8.3" class="section level3">
<h3><span class="header-section-number">12.8.3</span> 修改图例标题和标签的外观</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 题目外观</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size=</span><span class="dv">16</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>))

<span class="co"># 标签外观</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>, <span class="dt">size =</span> <span class="dv">16</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14" /></p>
</div>
<div id="section-12.8.4" class="section level3">
<h3><span class="header-section-number">12.8.4</span> 修改图例框</h3>
<p>默认情况下，图例周围没有框。 添加框并修改其属性:</p>
<pre><code>bp + theme(legend.background = element_rect())
bp + theme(legend.background = element_rect(fill=&quot;gray90&quot;, size=.5, linetype=&quot;dotted&quot;))</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-15-2.png" alt="plot of chunk unnamed-chunk-15" /></p>
</div>
<div id="section-12.8.5" class="section level3">
<h3><span class="header-section-number">12.8.5</span> 改变图例位置</h3>
<p>将图例位置放在绘图区域外（左/右/上/下）:</p>
<pre><code>bp + theme(legend.position=&quot;top&quot;)</code></pre>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" />
<p class="caption">plot of chunk unnamed-chunk-16</p>
</div>
<p>也可以将图例定位在绘图区域内。 请注意，下面的数字位置是相对于整个区域的，包括标题和标签，而不仅仅是绘图区域。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 将图例放在图表中，其中x，y为0,0（左下角）到1,1（右上角）</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="kw">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>))

<span class="co"># 设置图例的“锚点”（左下角为0,0;右上角为1,1）</span>
<span class="co"># 将图例框的左下角放在图的左下角</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.justification=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="dt">legend.position=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>))

<span class="co"># 将图例框的右下角放在图表的右下角</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">legend.justification=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>), <span class="dt">legend.position=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-17-2.png" alt="plot of chunk unnamed-chunk-17" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-17-3.png" alt="plot of chunk unnamed-chunk-17" /></p>
</div>
<div id="section-12.8.6" class="section level3">
<h3><span class="header-section-number">12.8.6</span> 隐藏在图例中的斜线</h3>
<p>如果使用轮廓制作条形图（通过设置color =“black”），它将通过图例中的颜色绘制斜线。 没有内置的方法来删除斜杠，但可以覆盖它们。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 没有边缘线</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>PlantGrowth, <span class="kw">aes</span>(<span class="dt">x=</span>group, <span class="dt">fill=</span>group)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>()

<span class="co"># 添加轮廓，但图例中会出现斜线</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>PlantGrowth, <span class="kw">aes</span>(<span class="dt">x=</span>group, <span class="dt">fill=</span>group)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)

<span class="co"># 隐藏斜线：首先绘制没有轮廓的条形图并添加图例,</span>
<span class="co"># 然后用轮廓再次绘制条形图，但带有空白图例.</span>
<span class="kw">ggplot</span>(<span class="dt">data=</span>PlantGrowth, <span class="kw">aes</span>(<span class="dt">x=</span>group, <span class="dt">fill=</span>group)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">show.legend=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-18-2.png" alt="plot of chunk unnamed-chunk-18" /><img src="http://www.cookbook-r.com/Graphs/Legends_(ggplot2)/figure/unnamed-chunk-18-3.png" alt="plot of chunk unnamed-chunk-18" /></p>
</div>
<div id="-9" class="section level3">
<h3><span class="header-section-number">12.8.7</span> 注意</h3>
<p>更多信息，请看: <a href="https://github.com/hadley/ggplot2/wiki/Legend-Attributes" class="uri">https://github.com/hadley/ggplot2/wiki/Legend-Attributes</a></p>
</div>
</div>
<div id="-ggplot2" class="section level2">
<h2><span class="header-section-number">12.9</span> 线条 (ggplot2)</h2>
<div id="-56" class="section level3">
<h3><span class="header-section-number">12.9.1</span> 问题</h3>
<p>你想要把线条加到图上</p>
</div>
<div id="-2" class="section level3">
<h3><span class="header-section-number">12.9.2</span> 解决方案</h3>
<div id="section-12.9.2.1" class="section level4">
<h4><span class="header-section-number">12.9.2.1</span> 使用一个连续轴和一个分类轴</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 一些样本数据</span>
dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">     cond result</span>
<span class="st">  control     10</span>
<span class="st">treatment   11.5</span>
<span class="st">&#39;</span>)

<span class="kw">library</span>(ggplot2)</code></pre></div>
<div id="section-12.9.2.1.1" class="section level5">
<h5><span class="header-section-number">12.9.2.1.1</span> 一条线段</h5>
<p>这些使用<code>geom_hline</code>，因为y轴是连续的，但如果x轴是连续的，也可以使用<code>geom_vline</code>（带有’xintercept`）。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 基本柱状条</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>result)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)
bp

<span class="co"># 添加水平线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="dv">12</span>))

<span class="co"># 使线条变红并变为虚线</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="dv">12</span>), <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /></p>
</div>
<div id="section-12.9.2.1.2" class="section level5">
<h5><span class="header-section-number">12.9.2.1.2</span> 每个分类值的单独行</h5>
<p>要为每个条形成单独的行，请使用<code>geom_errorbar</code>。 误差条没有高度 - “ymin”=“ymax”。 由于某种原因，似乎有必要指定<code>y</code>，即使它没有任何功能。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 为每个条形绘制单独的线条。 首先添加另一列到目前为止</span>
dat<span class="op">$</span>hline &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">12</span>)
dat
<span class="co">#&gt;        cond result hline</span>
<span class="co">#&gt; 1   control   10.0     9</span>
<span class="co">#&gt; 2 treatment   11.5    12</span>

<span class="co"># 需要重新指定bp，因为数据已经改变</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>result)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)

<span class="co"># 为每个柱状图画分开的线条</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax=</span>hline, <span class="dt">ymin=</span>hline), <span class="dt">colour=</span><span class="st">&quot;#AA0000&quot;</span>)

<span class="co"># 让线条更细一点 </span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">width=</span><span class="fl">0.5</span>, <span class="kw">aes</span>(<span class="dt">ymax=</span>hline, <span class="dt">ymin=</span>hline), <span class="dt">colour=</span><span class="st">&quot;#AA0000&quot;</span>)


<span class="co"># 即使我们从第二个数据框获得hline值，也可以得到相同的结果</span>
<span class="co"># 使用hline定义数据框</span>
dat_hlines &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond=</span><span class="kw">c</span>(<span class="st">&quot;control&quot;</span>,<span class="st">&quot;treatment&quot;</span>), <span class="dt">hline=</span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">12</span>))
dat_hlines
<span class="co">#&gt;        cond hline</span>
<span class="co">#&gt; 1   control     9</span>
<span class="co">#&gt; 2 treatment    12</span>

<span class="co"># 柱状图形来自dat，但是线条来自dat_hlines </span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="dt">data=</span>dat_hlines, <span class="kw">aes</span>(<span class="dt">y=</span><span class="ot">NULL</span>, <span class="dt">ymax=</span>hline, <span class="dt">ymin=</span>hline), <span class="dt">colour=</span><span class="st">&quot;#AA0000&quot;</span>)
<span class="co">#&gt; 警告：忽略未知的美学 : y</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4" /></p>
</div>
<div id="section-12.9.2.1.3" class="section level5">
<h5><span class="header-section-number">12.9.2.1.3</span> 分组栏上的线条</h5>
<p>可以在分组条上添加线条。 在这个例子中，实际上有四行（<code>hline</code>的每个条目一行），但它看起来像两个，因为它们是相互重叠的。 我不认为可以避免这种情况，但它不会导致任何问题。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">     cond group result hline</span>
<span class="st">  control     A     10     9</span>
<span class="st">treatment     A   11.5    12</span>
<span class="st">  control     B     12     9</span>
<span class="st">treatment     B     14    12</span>
<span class="st">&#39;</span>)
dat
<span class="co">#&gt;        cond group result hline</span>
<span class="co">#&gt; 1   control     A   10.0     9</span>
<span class="co">#&gt; 2 treatment     A   11.5    12</span>
<span class="co">#&gt; 3   control     B   12.0     9</span>
<span class="co">#&gt; 4 treatment     B   14.0    12</span>

<span class="co"># 定义基本柱状图</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>result, <span class="dt">fill=</span>group)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)
bp

<span class="co"># 误差线相互绘制 - 有四个但看起来像两个</span>
bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax=</span>hline, <span class="dt">ymin=</span>hline), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" /></p>
</div>
</div>
<div id="section-12.9.2.2" class="section level4">
<h4><span class="header-section-number">12.9.2.2</span> 各个组合柱状图上的线条</h4>
<p>即使在分组时，也可以在每个单独的条上划线。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">     cond group result hline</span>
<span class="st">  control     A     10    11</span>
<span class="st">treatment     A   11.5    12</span>
<span class="st">  control     B     12  12.5</span>
<span class="st">treatment     B     14    15</span>
<span class="st">&#39;</span>)

<span class="co"># 定义基本条形图</span>
bp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>result, <span class="dt">fill=</span>group)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(), <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)
bp

bp <span class="op">+</span><span class="st"> </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymax=</span>hline, <span class="dt">ymin=</span>hline), <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,
                   <span class="dt">position=</span><span class="kw">position_dodge</span>())</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-6-2.png" alt="plot of chunk unnamed-chunk-6" /></p>
</div>
<div id="section-12.9.2.3" class="section level4">
<h4><span class="header-section-number">12.9.2.3</span> 有两个连续轴</h4>
<p>样本数据如下</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">      cond xval yval</span>
<span class="st">   control 11.5 10.8</span>
<span class="st">   control  9.3 12.9</span>
<span class="st">   control  8.0  9.9</span>
<span class="st">   control 11.5 10.1</span>
<span class="st">   control  8.6  8.3</span>
<span class="st">   control  9.9  9.5</span>
<span class="st">   control  8.8  8.7</span>
<span class="st">   control 11.7 10.1</span>
<span class="st">   control  9.7  9.3</span>
<span class="st">   control  9.8 12.0</span>
<span class="st"> treatment 10.4 10.6</span>
<span class="st"> treatment 12.1  8.6</span>
<span class="st"> treatment 11.2 11.0</span>
<span class="st"> treatment 10.0  8.8</span>
<span class="st"> treatment 12.9  9.5</span>
<span class="st"> treatment  9.1 10.0</span>
<span class="st"> treatment 13.4  9.6</span>
<span class="st"> treatment 11.6  9.8</span>
<span class="st"> treatment 11.5  9.8</span>
<span class="st"> treatment 12.0 10.6</span>
<span class="st">&#39;</span>)

<span class="kw">library</span>(ggplot2)</code></pre></div>
<div id="section-12.9.2.3.1" class="section level5">
<h5><span class="header-section-number">12.9.2.3.1</span> 基础线条</h5>
<pre><code># 基本的散点图
sp &lt;- ggplot(dat, aes(x=xval, y=yval, colour=cond)) + geom_point()

# 添加一个水平线条
sp + geom_hline(aes(yintercept=10))

# 添加红色虚线垂直线
sp + geom_hline(aes(yintercept=10)) +
    geom_vline(aes(xintercept=11.5), colour=&quot;#BB0000&quot;, linetype=&quot;dashed&quot;)</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-9-2.png" alt="plot of chunk unnamed-chunk-9" /></p>
</div>
<div id="section-12.9.2.3.2" class="section level5">
<h5><span class="header-section-number">12.9.2.3.2</span> 画线为平均值</h5>
<p>还可以计算每个数据子集的平均值，按一些变量分组。 组意味着必须计算并存储在单独的数据框中，最简单的方法是使用dplyr包。 请注意，该行的y范围由数据确定。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
lines &lt;-<span class="st"> </span>dat <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(cond) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">x =</span> <span class="kw">mean</span>(xval),
    <span class="dt">ymin =</span> <span class="kw">min</span>(yval),
    <span class="dt">ymax =</span> <span class="kw">max</span>(yval)
  )

<span class="co"># 为每组的平均xval添加彩色线条</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="dv">10</span>)) <span class="op">+</span>
<span class="st">     </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span><span class="ot">NULL</span>, <span class="dt">ymin=</span>ymin, <span class="dt">ymax=</span>ymax), <span class="dt">data=</span>lines)
<span class="co">#&gt; 警告：忽略未知的美学 : y</span></code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" />
<p class="caption">plot of chunk unnamed-chunk-10</p>
</div>
</div>
<div id="section-12.9.2.3.3" class="section level5">
<h5><span class="header-section-number">12.9.2.3.3</span> 在分面使用线条</h5>
<p>一般来说，如果你加一条线，它将出现在所有的分面上.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 分面，基于cond</span>
spf &lt;-<span class="st"> </span>sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cond)
spf

<span class="co"># 用相同的值在所有的分面上画水平线</span>
spf <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="dv">10</span>))</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11" /></p>
<p>如果您希望不同的线条出现在不同的方面，有两个选项。 一种是创建具有所需线条值的新数据框。 另一种选择（控制更有限）是在<code>geom_line（）</code>中使用<code>stat</code>和<code>xintercept</code>。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat_vlines &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cond=</span><span class="kw">levels</span>(dat<span class="op">$</span>cond), <span class="dt">xval=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="fl">11.5</span>))
dat_vlines
<span class="co">#&gt;        cond xval</span>
<span class="co">#&gt; 1   control 10.0</span>
<span class="co">#&gt; 2 treatment 11.5</span>

spf <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="dv">10</span>)) <span class="op">+</span>
<span class="st">      </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span>xval), <span class="dt">data=</span>dat_vlines,
                    <span class="dt">colour=</span><span class="st">&quot;#990000&quot;</span>, <span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>)

spf <span class="op">+</span><span class="st"> </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept=</span><span class="dv">10</span>)) <span class="op">+</span>
<span class="st">     </span><span class="kw">geom_linerange</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span><span class="ot">NULL</span>, <span class="dt">ymin=</span>ymin, <span class="dt">ymax=</span>ymax), <span class="dt">data=</span>lines)
<span class="co">#&gt; 警告：忽略未知的美学 : y</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Lines_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12" /></p>
</div>
</div>
</div>
</div>
<div id="ggplot-" class="section level2">
<h2><span class="header-section-number">12.10</span> ggplot | 分面</h2>
<div id="-57" class="section level3">
<h3><span class="header-section-number">12.10.1</span> 问题</h3>
<p>你想要根据一个或多个变量对数据进行分割并且绘制出该数据所有的子图。</p>
</div>
<div id="-51" class="section level3">
<h3><span class="header-section-number">12.10.2</span> 方案</h3>
<div id="-1" class="section level4">
<h4><span class="header-section-number">12.10.2.1</span> 样本数据</h4>
<p>以下例子将使用 <code>reshape2</code> 包中的 <code>tips</code>数据集</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(reshape2)
<span class="co"># 查看头几行数据</span>
<span class="kw">head</span>(tips)
<span class="co">#&gt;   total_bill  tip    sex smoker day   time size</span>
<span class="co">#&gt; 1      16.99 1.01 Female     No Sun Dinner    2</span>
<span class="co">#&gt; 2      10.34 1.66   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 3      21.01 3.50   Male     No Sun Dinner    3</span>
<span class="co">#&gt; 4      23.68 3.31   Male     No Sun Dinner    2</span>
<span class="co">#&gt; 5      24.59 3.61 Female     No Sun Dinner    4</span>
<span class="co">#&gt; 6      25.29 4.71   Male     No Sun Dinner    4</span></code></pre></div>
<p>根据小费 (tip) 占总账单 (total_bill) 的百分比绘制散点图</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
sp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(<span class="dt">x=</span>total_bill, <span class="dt">y=</span>tip<span class="op">/</span>total_bill)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)
sp</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" />
<p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
</div>
<div id="facet_grid" class="section level4">
<h4><span class="header-section-number">12.10.2.2</span> facet_grid</h4>
<p>根据一个或多个变量对数据进行分割，生成的子图按照水平或垂直的方向进行排列。这一功能是通过赋予 <code>facet_grid()</code> 函数一个 <code>vertical ~ horizontal</code> 公式来实现的（这里所说的“公式”是R中的一种数据结构，而不是数学意义上的公式）。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 根据 &quot;sex&quot; 按垂直方向分割</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" />
<p class="caption">plot of chunk unnamed-chunk-4</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 根据 &quot;sex&quot; 按水平方向分割。</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" />
<p class="caption">plot of chunk unnamed-chunk-5</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 垂直方向以 &quot;sex&quot; 分割，水平方向以 &quot;day&quot; 分割。</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>day)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" />
<p class="caption">plot of chunk unnamed-chunk-6</p>
</div>
</div>
<div id="facet_wrap" class="section level4">
<h4><span class="header-section-number">12.10.2.3</span> facet_wrap</h4>
<p>除了能够根据<strong>单个变量</strong>在水平或垂直方向上对图进行分面，<code>facet_wrap()</code>函数可以通过设置特定的行数或列数，让子图排列到一起。此时每个图像的上方都会有标签。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 以变量 `day`进行水平分面，分面的行数为2。</span>
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>( <span class="op">~</span><span class="st"> </span>day, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" />
<p class="caption">plot of chunk unnamed-chunk-7</p>
</div>
</div>
<div id="section-12.10.2.4" class="section level4">
<h4><span class="header-section-number">12.10.2.4</span> 修改分面标签的外观</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>day) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">8</span>, <span class="dt">angle=</span><span class="dv">75</span>),
          <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">12</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>),
          <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;#CCCCFF&quot;</span>))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" />
<p class="caption">plot of chunk unnamed-chunk-8</p>
</div>
</div>
<div id="section-12.10.2.5" class="section level4">
<h4><span class="header-section-number">12.10.2.5</span> 修改分面标签的文本</h4>
<p>修改分面标签内容有两种方法。最简单的方法是为原来的名字匹配一个新的名字向量。比方说对数据中 <code>sex</code> 的类别进行重新定义 Female==&gt;Women, and Male==&gt;Men:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">labels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">Female =</span> <span class="st">&quot;Women&quot;</span>, <span class="dt">Male =</span> <span class="st">&quot;Men&quot;</span>)
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex, <span class="dt">labeller=</span><span class="kw">labeller</span>(<span class="dt">sex =</span> labels))</code></pre></div>
<p>另一个方法就是直接在数据框中修改，将你想要显示的标签赋值给相应的数据:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tips2 &lt;-<span class="st"> </span>tips
<span class="kw">levels</span>(tips2<span class="op">$</span>sex)[<span class="kw">levels</span>(tips2<span class="op">$</span>sex)<span class="op">==</span><span class="st">&quot;Female&quot;</span>] &lt;-<span class="st"> &quot;Women&quot;</span>
<span class="kw">levels</span>(tips2<span class="op">$</span>sex)[<span class="kw">levels</span>(tips2<span class="op">$</span>sex)<span class="op">==</span><span class="st">&quot;Male&quot;</span>]   &lt;-<span class="st"> &quot;Men&quot;</span>
<span class="kw">head</span>(tips2, <span class="dv">3</span>)
<span class="co">#&gt;   total_bill  tip   sex smoker day   time size</span>
<span class="co">#&gt; 1      16.99 1.01 Women     No Sun Dinner    2</span>
<span class="co">#&gt; 2      10.34 1.66   Men     No Sun Dinner    3</span>
<span class="co">#&gt; 3      21.01 3.50   Men     No Sun Dinner    3</span>
<span class="co"># Both of these will give the same output:</span>
sp2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips2, <span class="kw">aes</span>(<span class="dt">x=</span>total_bill, <span class="dt">y=</span>tip<span class="op">/</span>total_bill)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">1</span>)
sp2 <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex)</code></pre></div>
<p>两种方法都能得到相同的结果：</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" />
<p class="caption">plot of chunk unnamed-chunk-11</p>
</div>
<p><code>labeller()</code> 可以通过设定不同的 <code>函数</code> 来处理输入的字符向量。比方说 <code>Hmisc</code> 包里的 <code>capitalize</code> 函数可以将字符串的首字母变成大写。我们也可以这样来自定义函数，如下所示，将字符串中的字母倒序：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 对每个字符向量进行倒序：</span>
reverse &lt;-<span class="st"> </span><span class="cf">function</span>(strings) {
    strings &lt;-<span class="st"> </span><span class="kw">strsplit</span>(strings, <span class="st">&quot;&quot;</span>)
    <span class="kw">vapply</span>(strings, <span class="cf">function</span>(x) {
        <span class="kw">paste</span>(<span class="kw">rev</span>(x), <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)
    }, <span class="dt">FUN.VALUE =</span> <span class="kw">character</span>(<span class="dv">1</span>))
}
sp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>sex, <span class="dt">labeller=</span><span class="kw">labeller</span>(<span class="dt">sex =</span> reverse))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" />
<p class="caption">plot of chunk unnamed-chunk-12</p>
</div>
</div>
<div id="section-12.10.2.6" class="section level4">
<h4><span class="header-section-number">12.10.2.6</span> 设置标度</h4>
<p>一般而言，每幅图的坐标轴范围都是<strong>固定不变</strong>的，也就是说每幅图都拥有相同的尺寸和范围。你可以通过将 <code>scales</code> 设置为 <code>free</code>，<code>free_x</code> 或 <code>free_y</code> 来改变坐标轴范围。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 描绘一个 total_bill的柱状图</span>
hp &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tips, <span class="kw">aes</span>(<span class="dt">x=</span>total_bill)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth=</span><span class="dv">2</span>,<span class="dt">colour=</span><span class="st">&quot;white&quot;</span>)
<span class="co"># 根据性别和是否吸烟进行分面</span>
hp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>smoker)
<span class="co"># 在同样的情况下设定 scales=&quot;free_y&quot; (y轴自由标度）</span>
hp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>smoker, <span class="dt">scales=</span><span class="st">&quot;free_y&quot;</span>)
<span class="co"># 画布的缩放比例不变，但各分面的范围有所改变，因此每个分面的物理大小都不一致</span>
hp <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(sex <span class="op">~</span><span class="st"> </span>smoker, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>, <span class="dt">space=</span><span class="st">&quot;free&quot;</span>)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" />
<p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13" />
<p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Facets_(ggplot2)/figure/unnamed-chunk-13-3.png" alt="plot of chunk unnamed-chunk-13" />
<p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
</div>
</div>
</div>
<div id="ggplot-" class="section level2">
<h2><span class="header-section-number">12.11</span> ggplot |多图</h2>
<div id="-58" class="section level3">
<h3><span class="header-section-number">12.11.1</span> 问题</h3>
<p>你想把多个图形放到同一个页面中。</p>
</div>
<div id="-52" class="section level3">
<h3><span class="header-section-number">12.11.2</span> 方案</h3>
<p>最简单的方法就是使用 <code>multiplot</code> 函数，本页末尾处附有该函数的具体定义。如果它不能满足你的需求，你可以将其复制下来然后作出适当的修改。 首先，构建并保存图像但不需要对它们进行渲染，这些图像的细节并不重要。你只需要将这些图像对象储存为变量。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 以下例子使用的是 ggplot2 包中自带的 Chickweight 数据集</span>
<span class="co">#第一幅图像</span>
p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ChickWeight, <span class="kw">aes</span>(<span class="dt">x=</span>Time, <span class="dt">y=</span>weight, <span class="dt">colour=</span>Diet, <span class="dt">group=</span>Chick)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Growth curve for individual chicks&quot;</span>)

<span class="co">#第二幅图像</span>
p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(ChickWeight, <span class="kw">aes</span>(<span class="dt">x=</span>Time, <span class="dt">y=</span>weight, <span class="dt">colour=</span>Diet)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span>.<span class="dv">3</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">alpha=</span>.<span class="dv">2</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Fitted growth curve per diet&quot;</span>)

<span class="co">#第三幅图像</span>
p3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(ChickWeight, Time<span class="op">==</span><span class="dv">21</span>), <span class="kw">aes</span>(<span class="dt">x=</span>weight, <span class="dt">colour=</span>Diet)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Final weight, by diet&quot;</span>)

<span class="co">#第四幅图像</span>
p4 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">subset</span>(ChickWeight, Time<span class="op">==</span><span class="dv">21</span>), <span class="kw">aes</span>(<span class="dt">x=</span>weight, <span class="dt">fill=</span>Diet)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_histogram</span>(<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>, <span class="dt">binwidth=</span><span class="dv">50</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(Diet <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Final weight, by diet&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>)    <span class="co">#为了避免冗余，这里不添加图例</span></code></pre></div>
<p>这些图像都构建好了后，我们可以用 <code>multiplot</code> 对它们进行渲染。下面将这些图形分成两列进行展示：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">multiplot</span>(p1, p2, p3, p4, <span class="dt">cols=</span><span class="dv">2</span>)
<span class="co">#&gt; `geom_smooth()`  函数设置成 method = &#39;loess&#39;</span></code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" />
<p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
</div>
<div id="multiplot-" class="section level3">
<h3><span class="header-section-number">12.11.3</span> multiplot 函数</h3>
<p>定义：<code>multiplot</code> 函数可以将任意数量的图像对象作为参数，或者可以构建一个图像对象列表传递到该函数的 <code>plotlist</code> 参数中。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 多图功能</span>
<span class="co">#</span>
<span class="co"># ggplot 对象可以直接放入 `…` 中，也可以传递到 `plotlist` 里（这里的 ggplot 对象以列表形式存在）</span>
<span class="co"># - cols: 图像的列数</span>
<span class="co"># - layout: 用来指定布局的一组矩阵。当其存在时，可以忽略 `cols` 参数。</span>
<span class="co">#</span>
<span class="co"># 假设 layout 参数是 matrix(c(1,2,3,3), nrow=2, byrow = TRUE),</span>
<span class="co"># 那么第一幅图像会位于左上方，第二幅图会在右上方，而</span>
<span class="co"># 第三幅图会占据整个下方。</span>
<span class="co">#</span>
multiplot &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">plotlist=</span><span class="ot">NULL</span>, file, <span class="dt">cols=</span><span class="dv">1</span>, <span class="dt">layout=</span><span class="ot">NULL</span>) {
  <span class="kw">library</span>(grid)

<span class="co"># 从参数 `…`中建立一个列表然后 plotlist</span>
plots &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">list</span>(...), plotlist)

numPlots =<span class="st"> </span><span class="kw">length</span>(plots)
<span class="co"># 假如 layout 是 NULL, 那么可以用 `cols` 来定义布局</span>
  <span class="cf">if</span> (<span class="kw">is.null</span>(layout)) {
    <span class="co"># 创建面板</span>
    <span class="co"># ncol: 图像的列数</span>
    <span class="co"># nrow: 根据上述给定的列数，计算所需要的行数   </span>
   layout &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">seq</span>(<span class="dv">1</span>, cols <span class="op">*</span><span class="st"> </span><span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols)),
                    <span class="dt">ncol =</span> cols, <span class="dt">nrow =</span> <span class="kw">ceiling</span>(numPlots<span class="op">/</span>cols))
  }
<span class="cf">if</span> (numPlots<span class="op">==</span><span class="dv">1</span>) {
    <span class="kw">print</span>(plots[[<span class="dv">1</span>]])
} <span class="cf">else</span> {
    <span class="co"># 创建页面</span>
    <span class="kw">grid.newpage</span>()
    <span class="kw">pushViewport</span>(<span class="kw">viewport</span>(<span class="dt">layout =</span> <span class="kw">grid.layout</span>(<span class="kw">nrow</span>(layout), <span class="kw">ncol</span>(layout))))
<span class="co"># 让每一幅图像排列在正确的位置</span>
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numPlots) {
      <span class="co"># 获取包含这一子图所在区域的坐标 matrix i,j</span>
      matchidx &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">which</span>(layout <span class="op">==</span><span class="st"> </span>i, <span class="dt">arr.ind =</span> <span class="ot">TRUE</span>))
<span class="kw">print</span>(plots[[i]], <span class="dt">vp =</span> <span class="kw">viewport</span>(<span class="dt">layout.pos.row =</span> matchidx<span class="op">$</span>row,
                                      <span class="dt">layout.pos.col =</span> matchidx<span class="op">$</span>col))
    }
  }
}</code></pre></div>
</div>
</div>
<div id="ggplot2" class="section level2">
<h2><span class="header-section-number">12.12</span> 颜色（ggplot2)</h2>
<div id="-59" class="section level3">
<h3><span class="header-section-number">12.12.1</span> 问题</h3>
<p>你想在图表中用ggplot2添加颜色</p>
</div>
<div id="-3" class="section level3">
<h3><span class="header-section-number">12.12.2</span> 解决方案</h3>
<p>在ggplot2中设置颜色，对相互区分不同变量会有些困难，因为这些颜色有一样的亮度，且对色盲者不太友好。一个比较好的通用解决方案是使用对色盲友好的调色。</p>
<div id="-2" class="section level4">
<h4><span class="header-section-number">12.12.2.1</span> 样本数据</h4>
<p>这两个数据集将用来产生下面的图表</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co"># 两个变量</span>
df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st"> cond yval</span>
<span class="st">    A 2</span>
<span class="st">    B 2.5</span>
<span class="st">    C 1.6</span>
<span class="st">&#39;</span>)

<span class="co"># 三个变量</span>
df2 &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st"> cond1 cond2 yval</span>
<span class="st">    A      I 2</span>
<span class="st">    A      J 2.5</span>
<span class="st">    A      K 1.6</span>
<span class="st">    B      I 2.2</span>
<span class="st">    B      J 2.4</span>
<span class="st">    B      K 1.2</span>
<span class="st">    C      I 1.7</span>
<span class="st">    C      J 2.3</span>
<span class="st">    C      K 1.9</span>
<span class="st">&#39;</span>)</code></pre></div>
</div>
<div id="section-12.12.2.2" class="section level4">
<h4><span class="header-section-number">12.12.2.2</span> 简单的颜色设置</h4>
<p>有颜色的线条和点可以直接用’colour = “red” ’, 用颜色名称代替”red“。填充的对象的颜色，例如柱状条，可以用 ’fill=”red&quot; 来进行设置。</p>
<p>如果你想用任何其他非常规颜色，用十六进位码来设置颜色更容易，比如“#FF6699”。（看下面的十六进位码颜色图）</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="co"># 设置：黑色柱状条</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)
<span class="co"># 柱状条外用红色边线</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;#FF9999&quot;</span>) 
<span class="co"># 红色填充，黑色边线</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;#FF9999&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)


<span class="co"># 标准黑色线条和点</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>)) <span class="op">+</span><span class="st">     </span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>)
<span class="co"># 蓝黑色线条，红色点</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>), <span class="dt">colour=</span><span class="st">&quot;#000099&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="co"># 蓝线</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size=</span><span class="dv">3</span>, <span class="dt">colour=</span><span class="st">&quot;#CC0000&quot;</span>)         <span class="co"># 红点</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-4.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-3-5.png" alt="plot of chunk unnamed-chunk-3" /></p>
</div>
<div id="section-12.12.2.3" class="section level4">
<h4><span class="header-section-number">12.12.2.3</span> 将变量值映射到颜色</h4>
<p>不用全局改变颜色，你可以将变量映射到颜色——换言之，通过把颜色放到aes()说明中，可以设置条件性变量。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 柱状条: x 和填充都依赖于cond2</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>)

<span class="co"># 其他数据集的柱状条；填充依赖于cond2</span>
<span class="kw">ggplot</span>(df2, <span class="kw">aes</span>(<span class="dt">x=</span>cond1, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>cond2),   <span class="co"># 填充依赖于cond2</span>
             <span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,
             <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,    <span class="co"># 所有都是黑色轮廓线</span>
             <span class="dt">position=</span><span class="kw">position_dodge</span>()) <span class="co"># 把线条并排放置而非堆叠</span>

<span class="co"># 线和点；颜色依赖于cond2</span>
<span class="kw">ggplot</span>(df2, <span class="kw">aes</span>(<span class="dt">x=</span>cond1, <span class="dt">y=</span>yval)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>cond2, <span class="dt">group=</span>cond2)) <span class="op">+</span><span class="st"> </span><span class="co"># 颜色分组都依赖于cond2</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour=</span>cond2),               <span class="co"># 颜色依赖于cond2</span>
               <span class="dt">size=</span><span class="dv">3</span>)                          <span class="co"># 更大的点，不同的形状</span>
## 以上操作等价; 但把 &quot;colour=cond2&quot; 移到全局的映射用aes() 
<span class="co"># ggplot(df2, aes(x=cond1, y=yval, colour=cond2)) + </span>
<span class="co">#    geom_line(aes(group=cond2)) +</span>
<span class="co">#    geom_point(size=3)</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4" /></p>
</div>
<div id="section-12.12.2.4" class="section level4">
<h4><span class="header-section-number">12.12.2.4</span> 对色盲友好的颜色</h4>
<p>这些是对色盲友好的颜色色板，一个用灰色，一个用黑色</p>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" /></p>
<p>为了用ggplot2, 我们在一个变量里储存颜色色板，然后之后调用。</p>
<pre><code># 灰色的颜色色板:
cbPalette &lt;- c(&quot;#999999&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;, &quot;#009E73&quot;, &quot;#F0E442&quot;, &quot;#0072B2&quot;, &quot;#D55E00&quot;, &quot;#CC79A7&quot;)

# 黑色的颜色色板k:
cbbPalette &lt;- c(&quot;#000000&quot;, &quot;#E69F00&quot;, &quot;#56B4E9&quot;, &quot;#009E73&quot;, &quot;#F0E442&quot;, &quot;#0072B2&quot;, &quot;#D55E00&quot;, &quot;#CC79A7&quot;)

# 为了填充颜色，加
  scale_fill_manual(values=cbPalette)

# 为了在点线中使用颜色，加
  scale_colour_manual(values=cbPalette)</code></pre>
<p>这个颜色集来源于网站： <a href="http://jfly.iam.u-tokyo.ac.jp/color/" class="uri">http://jfly.iam.u-tokyo.ac.jp/color/</a>:</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/colorblind_palette.jpg" alt="Colorblind palette" />
<p class="caption">Colorblind palette</p>
</div>
</div>
<div id="section-12.12.2.5" class="section level4">
<h4><span class="header-section-number">12.12.2.5</span> 颜色选择</h4>
<p>默认情况下，离散比例的颜色围绕HSL色环均匀分布。 例如，如果有两种颜色，那么它们将从圆圈上的相对点中选择; 如果有三种颜色，它们在色环上将相隔120°; 等等。 用于不同级别的颜色如下所示：</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" />
<p class="caption">plot of chunk unnamed-chunk-7</p>
</div>
<p>默认颜色选择使用<code>scale_fill_hue（）</code>和<code>scale_colour_hue（）</code>。 例如，在这些情况下添加这些命令是多余的：</p>
<pre><code># 这两个是等价的; 默认使用scale_fill_hue（）
ggplot(df, aes(x=cond, y=yval, fill=cond)) + geom_bar(stat=&quot;identity&quot;)
# ggplot(df, aes(x=cond, y=yval, fill=cond)) + geom_bar(stat=&quot;identity&quot;) + scale_fill_hue()

#  这两个是等价的; 默认使用scale_colour_hue（）
ggplot(df, aes(x=cond, y=yval, colour=cond)) + geom_point(size=2)
# ggplot(df, aes(x=cond, y=yval, colour=cond)) + geom_point(size=2) + scale_colour_hue()</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-8-2.png" alt="plot of chunk unnamed-chunk-8" /></p>
</div>
<div id="section-12.12.2.6" class="section level4">
<h4><span class="header-section-number">12.12.2.6</span> 设置亮度和饱和度（色度）</h4>
<p>虽然<code>scale_fill_hue（）</code>和<code>scale_colour_hue（）</code>在上面是多余的，但是当你想要改变默认值时，可以使用它们，比如改变亮度或色度。</p>
<pre><code># 使用 luminance=45, 而不是默认 65
ggplot(df, aes(x=cond, y=yval, fill=cond)) + geom_bar(stat=&quot;identity&quot;) +
    scale_fill_hue(l=40)

# 从100到50减少饱和度（亮度）, 增加亮度
ggplot(df, aes(x=cond, y=yval, fill=cond)) + geom_bar(stat=&quot;identity&quot;) +
    scale_fill_hue(c=45, l=80)

# 注意：使用scale_colour_hue() 设置线和点</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-9-2.png" alt="plot of chunk unnamed-chunk-9" /></p>
<p>This is a chart of colors with luminance=45:</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" />
<p class="caption">plot of chunk unnamed-chunk-10</p>
</div>
</div>
<div id="color-brewer" class="section level4">
<h4><span class="header-section-number">12.12.2.7</span> 调色板：Color Brewer</h4>
<p>您还可以使用其他色标，例如从RColorBrewer包中获取的色标。 请参阅下面的RColorBrewer调色板图表。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_brewer</span>()

<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Set1&quot;</span>)

<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette=</span><span class="st">&quot;Spectral&quot;</span>)

<span class="co"># 注意: 使用 scale_colour_brewer() 设置点和线条</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-11-2.png" alt="plot of chunk unnamed-chunk-11" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-11-3.png" alt="plot of chunk unnamed-chunk-11" /></p>
</div>
<div id="section-12.12.2.8" class="section level4">
<h4><span class="header-section-number">12.12.2.8</span> 调色板：手动定义</h4>
<p>最后，您可以使用<code>scale_fill_manual（）</code>定义自己的颜色集。 有关选择特定颜色的帮助，请参阅下面的十六进制代码表。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>))

<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>cond, <span class="dt">y=</span>yval, <span class="dt">fill=</span>cond)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;#CC6666&quot;</span>, <span class="st">&quot;#9999CC&quot;</span>, <span class="st">&quot;#66CC99&quot;</span>))

<span class="co"># 注意：使用 scale_colour_manual() 设置线条和点</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-12-2.png" alt="plot of chunk unnamed-chunk-12" /></p>
</div>
<div id="section-12.12.2.9" class="section level4">
<h4><span class="header-section-number">12.12.2.9</span> 连续的颜色</h4>
<pre><code># 产生一些数据
set.seed(133)
df &lt;- data.frame(xval=rnorm(50), yval=rnorm(50))

# 依赖 yval设置颜色
ggplot(df, aes(x=xval, y=yval, colour=yval)) + geom_point()

# 使用不同的渐变
ggplot(df, aes(x=xval, y=yval, colour=yval)) + geom_point() + 
    scale_colour_gradientn(colours=rainbow(4))</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13" /></p>
</div>
<div id="section-12.12.2.10" class="section level4">
<h4><span class="header-section-number">12.12.2.10</span> 比色图表</h4>
</div>
<div id="section-12.12.2.11" class="section level4">
<h4><span class="header-section-number">12.12.2.11</span> 十六进制色码图</h4>
<p>颜色可以指定为十六进制RGB三元组合，例如“＃0066CC”。 前两位数字是红色，接下来的两位是绿色，最后两位是蓝色。 每个值的范围从00到FF，以十六进制（base-16）表示，在base-10中等于0和255。 例如，在下表中，“＃FFFFFF”为白色，“＃990000”为深红色。</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/hextable.png" alt="img" />
<p class="caption">img</p>
</div>
<p>(色码图来源于 <a href="http://www.visibone.com/">http://www.visibone.com</a>)</p>
</div>
<div id="rcolorbrewer" class="section level4">
<h4><span class="header-section-number">12.12.2.12</span> RColorBrewer调色板图表</h4>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" />
<p class="caption">plot of chunk unnamed-chunk-14</p>
</div>
</div>
</div>
</div>
<div id="--pdf-png-tiff-svg" class="section level2">
<h2><span class="header-section-number">12.13</span> 图形混杂-输出到文件-PDF-PNG-TIFF-SVG</h2>
<div id="-60" class="section level3">
<h3><span class="header-section-number">12.13.1</span> 问题</h3>
<p>你想将图形保存到文件。</p>
</div>
<div id="-53" class="section level3">
<h3><span class="header-section-number">12.13.2</span> 方案</h3>
<p>R 中有好几种命令可以直接将图形导出为文件而不是打印到屏幕上。另外，你必须通过 <code>dev.off()</code> 命令告诉 R 你已经完成作图了，否则你的图形是不会显示出来的。</p>
<div id="pdf" class="section level4">
<h4><span class="header-section-number">12.13.2.1</span> PDF格式</h4>
<p>PDF 是一种矢量文件格式。一般我们都更倾向于将图形输出为矢量图文件，因为这样的图无论怎样缩放都不会出现像素点。矢量图文件的大小通常要比位图文件要小，除非该文件里包含了过多的内容。（比如说一张散点图内包含了上千个点，这时候就会造成矢量图大而位图小。）</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="st">&quot;plots.pdf&quot;</span>)
<span class="kw">plot</span>(...)
<span class="kw">plot</span>(...)
<span class="kw">dev.off</span>()</code></pre></div>
<p>PDF 默认是 7x7 英寸，并且每个图形都单独占一页。这个尺寸是可以更改的：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 6x3 inches</span>
<span class="kw">pdf</span>(<span class="st">&quot;plots.pdf&quot;</span>, <span class="dt">width=</span><span class="dv">6</span>, <span class="dt">height=</span><span class="dv">3</span>)
<span class="co"># 10x6 cm</span>
<span class="kw">pdf</span>(<span class="st">&quot;plots.pdf&quot;</span>, <span class="dt">width=</span><span class="dv">10</span><span class="op">/</span><span class="fl">2.54</span>, <span class="dt">height=</span><span class="dv">6</span><span class="op">/</span><span class="fl">2.54</span>)</code></pre></div>
<p>如果你想在 Inkscape 或者 Illustrator 这样的矢量图编辑器中修改你的文件，图形中的一些绘制点有可能看上去更像是字母而并非原来的圆形或方形等。为了防止这种情况的发生可以输入：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="st">&quot;plots.pdf&quot;</span>, <span class="dt">useDingbats=</span><span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="svg" class="section level4">
<h4><span class="header-section-number">12.13.2.2</span> SVG格式</h4>
<p>SVG是另一种矢量图。默认的 <code>svg()</code> 命令无法将多页图形输出到一个文件中，因为大部分的 SVG 浏览软件无法处理多页的 SVG 文件。后面的 PNG 内容中将涉及如何输出到多个文件。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svg</span>(<span class="st">&quot;plots.svg&quot;</span>)
<span class="kw">plot</span>(...)
<span class="kw">dev.off</span>()</code></pre></div>
<p>SVG 文件比 PDF 文件更适合矢量图编辑器。</p>
</div>
<div id="pngtiff" class="section level4">
<h4><span class="header-section-number">12.13.2.3</span> PNG/TIFF格式</h4>
<p>PNG 和 TIFF 是位图（栅格图像），对它们进行缩放时可能会出现像素点。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">png</span>(<span class="st">&quot;plot.png&quot;</span>)
<span class="co"># 或者 tiff(&quot;plot.tiff&quot;)</span>
<span class="kw">plot</span>(...)
<span class="kw">dev.off</span>()</code></pre></div>
<p>输出的图像默认尺寸为 480X480 像素，分辨率为 72dpi （即 6.66x6.66 英寸）</p>
<p>当分辨率增加时文本与图像元素的大小也会（以像素为单位）增加。这是因为这些元素的大小只与图像的物理大小有关（比如 4x4英寸），而与图像的像素大小无关。例如，一个 12 磅的字符高度为 12/72 = 1/6 英寸，在分辨率为 72dpi 的情况下，它共包含 12 个像素点；而在分辨率放大到 120dpi 时，它就含有 20 个像素点了。</p>
<p>以下创建一个大小为 480x240 像素，分辨率为 120dpi 的图像,其实际大小相当于 4x2 英寸。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">png</span>(<span class="st">&quot;plot.png&quot;</span>, <span class="dt">width=</span><span class="dv">480</span>, <span class="dt">height=</span><span class="dv">240</span>, <span class="dt">res=</span><span class="dv">120</span>)
<span class="kw">plot</span>(...)
<span class="kw">dev.off</span>()</code></pre></div>
<p>如果你要创建不止一张图像，必须对每张图像执行一个新的 <code>png()</code> 命令，或者将 <code>%d</code> 放置到文件名中:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">png</span>(<span class="st">&quot;plot-%d.png&quot;</span>)
<span class="kw">plot</span>(...)
<span class="kw">dev.off</span>()</code></pre></div>
<p>上述代码会生成 plot-1.png, plot-2.png 等系列文件。</p>
</div>
<div id="pdf-ms-office" class="section level4">
<h4><span class="header-section-number">12.13.2.4</span> 对于不支持PDF格式的程序 （MS Office）</h4>
<p>有些不支持 PDF文件导入的程序一般都需要高分辨率的PNG或TIFF文件。比如说微软 Office 无法导入 PDF 格式文件。而对于印刷出版物，则需要使用 300dpi 的图像。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 绘制一幅 6x6英寸，300dpi 的图像</span>
ppi &lt;-<span class="st"> </span><span class="dv">300</span>
<span class="kw">png</span>(<span class="st">&quot;plot.png&quot;</span>, <span class="dt">width=</span><span class="dv">6</span><span class="op">*</span>ppi, <span class="dt">height=</span><span class="dv">6</span><span class="op">*</span>ppi, <span class="dt">res=</span>ppi)
<span class="kw">plot</span>(...)
<span class="kw">dev.off</span>()</code></pre></div>
</div>
<div id="ggplot2-1" class="section level4">
<h4><span class="header-section-number">12.13.2.5</span> ggplot2</h4>
<p>如果你在脚本或函数中使用 <code>ggplot2</code> 进行绘图，必须使用 <code>print()</code> 命令确保图像得到渲染。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 无效命令</span>
<span class="kw">pdf</span>(<span class="st">&quot;plots.pdf&quot;</span>)
<span class="kw">qplot</span>(...)
<span class="kw">dev.off</span>()
<span class="co"># 正确的做法</span>
<span class="kw">pdf</span>(<span class="st">&quot;plots.pdf&quot;</span>)
<span class="kw">print</span>(<span class="kw">qplot</span>(...))
<span class="kw">dev.off</span>()</code></pre></div>
<p>从屏幕中保存一个 ggplot2 图像为文件，你可以使用 <code>ggsave()</code>。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="st">&quot;plot.pdf&quot;</span>)
<span class="kw">ggsave</span>(<span class="st">&quot;plot.pdf&quot;</span>, <span class="dt">width=</span><span class="dv">4</span>, <span class="dt">height=</span><span class="dv">4</span>)
<span class="co"># 将图形保存为 400x400，100 ppi的文件</span>
<span class="kw">ggsave</span>(<span class="st">&quot;plot.png&quot;</span>, <span class="dt">width=</span><span class="dv">4</span>, <span class="dt">height=</span><span class="dv">4</span>, <span class="dt">dpi=</span><span class="dv">100</span>)</code></pre></div>
</div>
<div id="section-12.13.2.6" class="section level4">
<h4><span class="header-section-number">12.13.2.6</span> 保存屏幕中的图像</h4>
<p>如果你的屏幕中已经有一张图像了，可以将其保存为位图。</p>
<p>这是一种将屏幕中的对象作出从像素到像素的拷贝，不过这种操作很大概率只能在 Linux 和 Mac 的 X11 系统下得以实现：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 在屏幕中绘制一张图形</span>
<span class="kw">plot</span>(...)
<span class="kw">savePlot</span>(<span class="st">&quot;myplot.png&quot;</span>)</code></pre></div>
<p>这一步是保存屏幕当前图像，并且根据不同的设备对图像进行重新渲染，图像大小可能会因此发生变化。如果你需要图形大小固定，则需要以像素为单位对尺寸进行指定。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 在屏幕中绘制图像</span>
<span class="kw">plot</span>(...)
<span class="kw">dev.copy</span>(pdf,<span class="st">&quot;myplot.pdf&quot;</span>, <span class="dt">width=</span><span class="dv">4</span>, <span class="dt">height=</span><span class="dv">4</span>)
<span class="kw">dev.off</span>()
<span class="co"># 等同于：</span>
<span class="co"># pdf(&quot;myplot.pdf&quot;, width=4, height=4)</span>
<span class="co"># plot(...)</span>
<span class="co"># dev.off()</span>
<span class="kw">dev.copy</span>(png,<span class="st">&quot;myplot.png&quot;</span>, <span class="dt">width=</span><span class="dv">400</span>, <span class="dt">height=</span><span class="dv">400</span>)
<span class="kw">dev.off</span>()</code></pre></div>
</div>
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">12.14</span> 图形混杂-形状和线形</h2>
<div id="-61" class="section level3">
<h3><span class="header-section-number">12.14.1</span> 问题</h3>
<p>你想在图形中使用不同的形状和线条。</p>
</div>
<div id="-54" class="section level3">
<h3><span class="header-section-number">12.14.2</span> 方案</h3>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-2-1.png" alt="unnamed-chunk-2" />
<p class="caption">unnamed-chunk-2</p>
</div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/line_types-1.png" alt="plot of chunk line_types" />
<p class="caption">plot of chunk line_types</p>
</div>
<p>在输出位图时，对符号15-18的渲染可能不具抗锯齿性，即无论这些图形的绘制是否来自同一个平台，这些符号都有可能会被拉伸变形，出现像素点，或者无法居中。符号19和21-25在填充部分外周会有边框线，在大部分情况下这种边线在渲染时其边缘都是平滑的。另外，要使符号21-25显示实心填充，需要指定与边线颜色(<code>col</code>)一致的填充(<code>bg</code>)颜色，否则这些符号将会是空心的。</p>
<div id="section-12.14.2.1" class="section level4">
<h4><span class="header-section-number">12.14.2.1</span> 标准图形</h4>
<p>通过 <code>pch</code> 选项来设置符号形状, 并且通过 <code>lty</code> 和 <code>lwd</code> 来设定线条的类型和粗细。线条的类型可以通过名字或数字来指定。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">331</span>)

<span class="co"># 绘制一些点线</span>
<span class="co"># 设定绘画范围</span>
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))

<span class="co"># 绘制实心圆和实线</span>
<span class="kw">points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">runif</span>(<span class="dv">4</span>), <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">pch=</span><span class="dv">19</span>)
<span class="co"># 添加空心方框和粗虚线</span>
<span class="kw">points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">runif</span>(<span class="dv">4</span>), <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">pch=</span><span class="dv">0</span>,  <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">lwd=</span><span class="dv">3</span>)

<span class="kw">points</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">runif</span>(<span class="dv">4</span>), <span class="dt">type=</span><span class="st">&quot;b&quot;</span>, <span class="dt">pch=</span><span class="dv">23</span>,   <span class="co"># 菱形符号</span>
       <span class="dt">lty=</span><span class="st">&quot;dotted&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>,               <span class="co"># 点状线, 符号形状放大一倍</span>
       <span class="dt">col=</span><span class="st">&quot;#000099&quot;</span>, <span class="dt">bg=</span><span class="st">&quot;#FF6666&quot;</span>)       <span class="co"># 线条蓝色，符号形状红色填充</span></code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" />
<p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
</div>
<div id="ggplot2-2" class="section level4">
<h4><span class="header-section-number">12.14.2.2</span> ggplot2</h4>
<p>在调用 ggplot2 的情况下，可以对图中的符号形状和线条类型进行全局的部署（比方说你想让所有数据点都是方形，所有的线条都为虚线），或者通过一个变量来调整它们。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 示例数据</span>
df &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span>T, <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">  cond xval yval</span>
<span class="st">     A    1  2.0</span>
<span class="st">     A    2  2.5</span>
<span class="st">     B    1  3.0</span>
<span class="st">     B    2  2.0</span>
<span class="st">&#39;</span>)


<span class="kw">library</span>(ggplot2)

<span class="co"># 使用标准的线条和符号形状作图</span>
<span class="co"># 用 group = cond 表示点线之间的对应关系</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>xval, <span class="dt">y=</span>yval, <span class="dt">group =</span> cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>()

<span class="co"># 设置全局的符号形状和线条类型</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>xval, <span class="dt">y=</span>yval, <span class="dt">group =</span> cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">linetype=</span><span class="st">&quot;dashed&quot;</span>,  <span class="co"># 虚线</span>
              <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st">       </span><span class="co"># 加粗</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">0</span>,         <span class="co"># 空心方块</span>
               <span class="dt">size =</span> <span class="dv">4</span>)          <span class="co"># 放大形状</span>

<span class="co"># 通过变量 cond 调整符号图形和线类型</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>xval, <span class="dt">y=</span>yval, <span class="dt">group =</span> cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype=</span>cond), <span class="co"># cond 决定线条类型</span>
              <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st">       </span><span class="co"># 线条加粗</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape=</span>cond),   <span class="co"># cond 决定形状</span>
               <span class="dt">size =</span> <span class="dv">4</span>)          <span class="co"># 放大形状</span>


<span class="co"># 在上述的基础上同时改变所使用的线条和形状</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>xval, <span class="dt">y=</span>yval, <span class="dt">group =</span> cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype=</span>cond), <span class="co"># cond 决定线条类型</span>
              <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st">       </span><span class="co"># 线条加粗</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape=</span>cond),   <span class="co"># cond 决定形状</span>
               <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st">        </span><span class="co"># 放大形状</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">5</span>)) <span class="op">+</span><span class="st">                  </span><span class="co"># 更改形状</span>
<span class="st">    </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;dotdash&quot;</span>, <span class="st">&quot;dotted&quot;</span>)) <span class="co"># 更改线条类型</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /> <img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /> <img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-3.png" alt="plot of chunk unnamed-chunk-4" /> <img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-4-4.png" alt="plot of chunk unnamed-chunk-4" /></p>
<p>一般来说 ggplot2 使用的是实心形状。如果你想要空心的形状又不想手动地对每个形状进行定义，可以使用<code>scale_shape(solid=FALSE)</code>。注意，这个时候形状空心部分中的线条是可见的。为了避免这种情况，你可以使用符号形状21-25并且指定白色填充。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 空心形状</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>xval, <span class="dt">y=</span>yval, <span class="dt">group =</span> cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype=</span>cond), <span class="co"># cond 决定线条类型</span>
              <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st">       </span><span class="co"># 线条加粗</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape=</span>cond),   <span class="co"># cond 决定符号形状</span>
               <span class="dt">size =</span> <span class="dv">4</span>)  <span class="op">+</span><span class="st">       </span><span class="co"># 放大形状</span>
<span class="st">    </span><span class="kw">scale_shape</span>(<span class="dt">solid=</span><span class="ot">FALSE</span>)

<span class="co"># 白色填充形状</span>
<span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x=</span>xval, <span class="dt">y=</span>yval, <span class="dt">group =</span> cond)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype=</span>cond), <span class="co"># cond 决定线条类型</span>
              <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span><span class="st">       </span><span class="co"># 线条加粗</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">shape=</span>cond),   <span class="co"># cond 决定符号形状</span>
               <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>,    <span class="co"># 白色填充</span>
               <span class="dt">size =</span> <span class="dv">4</span>)  <span class="op">+</span><span class="st">       </span><span class="co"># 放大形状</span>
<span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="dv">21</span>,<span class="dv">24</span>))  <span class="co"># 形状：实心圆和三角形</span></code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" /> <img src="http://www.cookbook-r.com/Graphs/Shapes_and_line_types/figure/unnamed-chunk-5-2.png" alt="plot of chunk unnamed-chunk-5" /></p>
</div>
<div id="section-12.14.2.3" class="section level4">
<h4><span class="header-section-number">12.14.2.3</span> 附录</h4>
<p>以下代码会生成本章节开头所示的图表。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))

<span class="co"># 设定绘图区域</span>
<span class="kw">plot</span>(<span class="ot">NA</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">ylim=</span><span class="kw">c</span>(<span class="fl">6.5</span>, <span class="op">-</span><span class="fl">0.5</span>),
    <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>, <span class="dt">yaxt=</span><span class="st">&quot;n&quot;</span>,
    <span class="dt">xlab=</span><span class="ot">NA</span>, <span class="dt">ylab=</span><span class="ot">NA</span> )

<span class="co"># 画线条</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span><span class="dv">6</span>) {
    <span class="kw">points</span>(<span class="kw">c</span>(<span class="fl">0.25</span>,<span class="dv">1</span>), <span class="kw">c</span>(i,i), <span class="dt">lty=</span>i, <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;l&quot;</span>)
}
<span class="co"># 添加标签</span>
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="st">&quot;0. &#39;blank&#39;&quot;</span>   ,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="st">&quot;1. &#39;solid&#39;&quot;</span>   ,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="st">&quot;2. &#39;dashed&#39;&quot;</span>  ,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="st">&quot;3. &#39;dotted&#39;&quot;</span>  ,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">4</span>, <span class="st">&quot;4. &#39;dotdash&#39;&quot;</span> ,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="st">&quot;5. &#39;longdash&#39;&quot;</span>,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))
<span class="kw">text</span>(<span class="dv">0</span>, <span class="dv">6</span>, <span class="st">&quot;6. &#39;twodash&#39;&quot;</span> ,  <span class="dt">adj=</span><span class="kw">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>))</code></pre></div>
</div>
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">12.15</span> 图形混杂-字体</h2>
<div id="-62" class="section level3">
<h3><span class="header-section-number">12.15.1</span> 问题</h3>
<p>你想在图像中使用不同的字体。</p>
</div>
<div id="-55" class="section level3">
<h3><span class="header-section-number">12.15.2</span> 方案</h3>
<p>更新: 查看 <a href="https://github.com/wch/extrafont">extrafont</a> 包相关内容，该包能更好地支持 PDF 和 Windows 位图中的字体设定。</p>
<p>R 在一般情况下都不能很好地支持字体的显示。在不同的操作系统和不同的输出格式中都会出现不一样的结果。</p>
<div id="geom_text" class="section level4">
<h4><span class="header-section-number">12.15.2.1</span> geom_text</h4>
<p>通过 ggplot2 中的 <code>geom_text</code> or <code>annotate</code> , 你可以对图形文本中的一系列属性进行设置。 <code>geom_text</code> 用于将数据框中的文本加入到图表中，而 <code>annotate</code> 则用于往图表中添加单个文本元素。</p>
<table>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Default value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>size</code></td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left"><code>family</code></td>
<td align="left"><code>&quot;&quot;</code> (sans)</td>
</tr>
<tr class="odd">
<td align="left"><code>fontface</code></td>
<td align="left"><code>plain</code></td>
</tr>
<tr class="even">
<td align="left"><code>lineheight</code></td>
<td align="left">1.2</td>
</tr>
<tr class="odd">
<td align="left"><code>angle</code></td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left"><code>hjust</code></td>
<td align="left">0.5</td>
</tr>
<tr class="odd">
<td align="left"><code>vjust</code></td>
<td align="left">0.5</td>
</tr>
</tbody>
</table>
<p>注意这里 <code>size</code> 的单位是毫米, 而非磅。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">y =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,
    <span class="dt">text =</span> <span class="kw">c</span>(<span class="st">&quot;This is text&quot;</span>, <span class="st">&quot;Text with</span><span class="ch">\n</span><span class="st">multiple lines&quot;</span>, <span class="st">&quot;Some more text&quot;</span>)
)

<span class="kw">library</span>(ggplot2)
p &lt;-<span class="st"> </span><span class="kw">ggplot</span>(dat, <span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span>y)) <span class="op">+</span><span class="st"> </span>
<span class="st">       </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits=</span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">3.5</span>), <span class="dt">breaks=</span><span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">       </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="ot">NULL</span>)

p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>text))

p <span class="op">+</span><span class="st"> </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>text), <span class="dt">family=</span><span class="st">&quot;Times&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;italic&quot;</span>, <span class="dt">lineheight=</span>.<span class="dv">8</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">annotate</span>(<span class="dt">geom=</span><span class="st">&quot;text&quot;</span>, <span class="dt">x=</span><span class="dv">1</span>, <span class="dt">y=</span><span class="fl">1.5</span>, <span class="dt">label=</span><span class="st">&quot;Annotation text&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;red&quot;</span>,
             <span class="dt">size=</span><span class="dv">7</span>, <span class="dt">family=</span><span class="st">&quot;Courier&quot;</span>, <span class="dt">fontface=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">angle=</span><span class="dv">30</span>)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /> <img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-2-2.png" alt="plot of chunk unnamed-chunk-2" /></p>
</div>
<div id="themes-and-element_text" class="section level4">
<h4><span class="header-section-number">12.15.2.2</span> themes and element_text</h4>
<p>在管理类似标题，图注，坐标轴标签等元素时，可以使用 <code>element_text</code>, 其参数设置跟<code>geom_text</code>基本一致, 除了 <code>size</code> 的单位是 <strong>points</strong> (而非 mm), 还有就是它用的是 <code>face</code> 而不是 <code>fontface</code> 。默认情况下，<code>size</code> 取决于元素，比如图形标题的字体总是比刻度标签的大。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;This is a Title&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">plot.title=</span><span class="kw">element_text</span>(<span class="dt">family=</span><span class="st">&quot;Times&quot;</span>, <span class="dt">face=</span><span class="st">&quot;bold&quot;</span>, <span class="dt">size=</span><span class="dv">20</span>))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" />
<p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
</div>
<div id="section-12.15.2.3" class="section level4">
<h4><span class="header-section-number">12.15.2.3</span> 字体表格</h4>
<p>你可以运行下列代码来生成一张不同字体的图形表。 每种字体都有<strong>简称</strong>和<strong>字体标准家族名称</strong>，定义字体时使用其中一种即可。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fonttable &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>,
                        <span class="dt">text=</span><span class="st">&#39;</span>
<span class="st">Short,Canonical</span>
<span class="st">mono,Courier</span>
<span class="st">sans,Helvetica</span>
<span class="st">serif,Times</span>
<span class="st">,AvantGarde</span>
<span class="st">,Bookman</span>
<span class="st">,Helvetica-Narrow</span>
<span class="st">,NewCenturySchoolbook</span>
<span class="st">,Palatino</span>
<span class="st">,URWGothic</span>
<span class="st">,URWBookman</span>
<span class="st">,NimbusMon</span>
<span class="st">URWHelvetica,NimbusSan</span>
<span class="st">,NimbusSanCond</span>
<span class="st">,CenturySch</span>
<span class="st">,URWPalladio</span>
<span class="st">URWTimes,NimbusRom</span>
<span class="st">&#39;</span>)

fonttable<span class="op">$</span>pos &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(fonttable)

<span class="kw">library</span>(reshape2)
fonttable &lt;-<span class="st"> </span><span class="kw">melt</span>(fonttable, <span class="dt">id.vars=</span><span class="st">&quot;pos&quot;</span>, <span class="dt">measure.vars=</span><span class="kw">c</span>(<span class="st">&quot;Short&quot;</span>,<span class="st">&quot;Canonical&quot;</span>),
                  <span class="dt">variable.name=</span><span class="st">&quot;NameType&quot;</span>, <span class="dt">value.name=</span><span class="st">&quot;Font&quot;</span>)

<span class="co"># 创建一个分面形式的图表。确保因子的顺序是正确的</span>
facetable &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Face =</span> <span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;plain&quot;</span>,<span class="st">&quot;bold&quot;</span>,<span class="st">&quot;italic&quot;</span>,<span class="st">&quot;bold.italic&quot;</span>),
                                      <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;plain&quot;</span>,<span class="st">&quot;bold&quot;</span>,<span class="st">&quot;italic&quot;</span>,<span class="st">&quot;bold.italic&quot;</span>)))

fullfonts &lt;-<span class="st"> </span><span class="kw">merge</span>(fonttable, facetable)


<span class="kw">library</span>(ggplot2)
pf &lt;-<span class="st"> </span><span class="kw">ggplot</span>(fullfonts, <span class="kw">aes</span>(<span class="dt">x=</span>NameType, <span class="dt">y=</span>pos)) <span class="op">+</span><span class="st"> </span>
<span class="st">             </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label=</span>Font, <span class="dt">family=</span>Font, <span class="dt">fontface=</span>Face)) <span class="op">+</span>
<span class="st">             </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>Face, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p>在屏幕中查看:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pf</code></pre></div>
<p>你在屏幕中所看见的不一定跟你输出为 PNG 或 PDF 格式后的结果完全一样。查看 PNG 格式的输出结果：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">png</span>(<span class="st">&#39;fonttable.png&#39;</span>, <span class="dt">width=</span><span class="dv">720</span>, <span class="dt">height=</span><span class="dv">720</span>, <span class="dt">res=</span><span class="dv">72</span>)
<span class="kw">print</span>(pf)
<span class="kw">dev.off</span>()</code></pre></div>
<p>需要注意的是，对于生成这张图片的操作系统来说，大部分的字体（位于顶部）是不兼容的，只有一些基础字体（位于底部）是可以使用的。</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Fonts/figure/unnamed-chunk-7-1.png" alt="unnamed-chunk-7" />
<p class="caption">unnamed-chunk-7</p>
</div>
<hr />
<p>PDF 格式输出结果(以下示例图已从 PDF 格式转化为 PNG 格式）:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pdf</span>(<span class="st">&#39;fonttable.pdf&#39;</span>, <span class="dt">width=</span><span class="dv">10</span>, <span class="dt">height=</span><span class="dv">10</span>)
<span class="kw">print</span>(pf)
<span class="kw">dev.off</span>()


<span class="co">#  用 GraphicsMagick 将 PDF 转化为PNG格式:</span>
<span class="co"># system(&quot;gm convert -resize 720x720 -background white fonttable.pdf fonttable-pdf.png&quot;)</span></code></pre></div>
<p>PDF 设备对于不同字体的支持比 PNG 设备更好。基本所有的字体都能兼容。(虽然这些字体并不一定很好看):</p>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Fonts/fonttable-pdf.png" alt="PDF font table, converted to PNG" />
<p class="caption">PDF font table, converted to PNG</p>
</div>
</div>
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">12.16</span> 图形混杂-抗混淆位图输出</h2>
<div id="-63" class="section level3">
<h3><span class="header-section-number">12.16.1</span> 问题</h3>
<p>你想要在<strong>windows</strong>操作环境下保存抗锯齿的位图结果（<a href="https://www.computerhope.com/jargon/a/antialias.htm"><strong>anti-aliasing bitmap</strong></a>）。</p>
</div>
<div id="-56" class="section level3">
<h3><span class="header-section-number">12.16.2</span> 方案</h3>
<p>类似于<strong>png</strong>和<strong>jpeg</strong>的标准图形设备可以将图形保存成<strong>cairo、Xlib、 quartz</strong>三种不同的文件格式。当使用<strong>cairo</strong>，我们便可以获得抗锯齿化的图形结果。在<strong>MacOS</strong>和<strong>linux</strong>系统下，自动将图片保存为<strong>cairo</strong>格式，但是在<strong>windows</strong>系统下的相应参数是<strong>NULL</strong>。</p>
<p>绘图示例（如下）：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设置伪随机数种子</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
<span class="co">#生成符合正态分布的100个随机数</span>
x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)
<span class="kw">png</span>(<span class="st">&quot;antialiasing_1.png&quot;</span>, <span class="dt">type=</span><span class="st">&quot;cairo&quot;</span>)
<span class="kw">plot</span>(x)
<span class="kw">dev.off</span>()</code></pre></div>
<p>在<strong>windows</strong>系统环境下不可强行使用<strong>type=“cairo”</strong>，需要借助<strong>Cairo工具包</strong>获取抗锯齿化结果。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 安装Cairo包</span>
<span class="co"># install.packages(&quot;Cairo&quot;)</span>
<span class="kw">library</span>(<span class="st">&quot;Cairo&quot;</span>)
<span class="co"># 设置伪随机数种子</span>
<span class="kw">set.seed</span>(<span class="dv">1</span>)
<span class="co">#生成符合正态分布的100个随机数</span>
x =<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>)
<span class="kw">Cairo</span>(<span class="dt">width =</span> <span class="dv">540</span>, <span class="dt">height =</span> <span class="dv">380</span>, <span class="dt">file=</span><span class="st">&quot;antialiasing_2.png&quot;</span>, <span class="dt">type=</span><span class="st">&quot;png&quot;</span>, <span class="dt">bg=</span><span class="st">&quot;white&quot;</span>)
<span class="kw">plot</span>(x)
<span class="kw">dev.off</span>() </code></pre></div>
<div id="section-12.16.2.1" class="section level4">
<h4><span class="header-section-number">12.16.2.1</span> 提示</h4>
<p>有关该部分的更多相关信息，参看<a href="https://csgillespie.github.io/efficientR/cairo-type.html">Efficient R programming</a>。</p>
</div>
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">12.17</span> 标准绘图 | 散点图</h2>
<div id="-64" class="section level3">
<h3><span class="header-section-number">12.17.1</span> 问题</h3>
<p>你想要创建一个散点图</p>
</div>
<div id="-57" class="section level3">
<h3><span class="header-section-number">12.17.2</span> 方案</h3>
<p>假设下面是你的数据：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">955</span>)
<span class="co"># 给数据添加一些随机噪声</span>
dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">xvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>),
                  <span class="dt">yvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>),
                  <span class="dt">zvar =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>))

<span class="kw">head</span>(dat)
<span class="co">#&gt;        xvar         yvar        zvar</span>
<span class="co">#&gt; 1 -4.252354  3.473157275 -2.97806724</span>
<span class="co">#&gt; 2  1.702318  0.005939612 -1.16183118</span>
<span class="co">#&gt; 3  4.323054 -0.094252427  4.85516658</span>
<span class="co">#&gt; 4  1.780628  2.072808278  4.65078709</span>
<span class="co">#&gt; 5 11.537348  1.215440358 -0.06613962</span>
<span class="co">#&gt; 6  6.672130  3.608111411  6.24349897</span></code></pre></div>
<div id="section-12.17.2.1" class="section level4">
<h4><span class="header-section-number">12.17.2.1</span> 基本的散点图</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 使用向量xvar和yvar绘制点图</span>
<span class="kw">plot</span>(dat<span class="op">$</span>xvar, dat<span class="op">$</span>yvar)

<span class="co"># 跟上一句代码一致，但这里是用公式实现</span>
<span class="kw">plot</span>(yvar <span class="op">~</span><span class="st"> </span>xvar, dat)

<span class="co"># 添加一条回归线</span>
fitline &lt;-<span class="st"> </span><span class="kw">lm</span>(dat<span class="op">$</span>yvar <span class="op">~</span><span class="st"> </span>dat<span class="op">$</span>xvar)
<span class="kw">abline</span>(fitline)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /></p>
</div>
<div id="section-12.17.2.2" class="section level4">
<h4><span class="header-section-number">12.17.2.2</span> 散点图矩阵</h4>
<p>如果你想要比较多个变量，可以创建一个散点图矩阵</p>
<pre><code># 一个散点图矩阵
plot(dat[,1:3])

# 添加回归线
# 在对角添加histogram/boxplot/density/qqplot
library(car)
scatterplotMatrix(dat[,1:3],
                   diagonal=&quot;histogram&quot;,
                   smooth=FALSE)</code></pre>
<p><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /><img src="http://www.cookbook-r.com/Graphs/Scatterplot/figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /></p>
<p>想要查看对应的相关矩阵，查看 <a href="https://github.com/ShixiangWang/Cookbook-for-R-Chinese/blob/master/cookbook/Statistical_analysis/%E5%9B%9E%E5%BD%92%E5%92%8C%E7%9B%B8%E5%85%B3.md">../../Statistical analysis/Regression and correlation</a>。</p>
<p>想要可视化相关矩阵，查看 <a href="http://www.cookbook-r.com/Graphs/Correlation_matrix">../Correlation matrix</a>。</p>
</div>
</div>
</div>
<div id="section-12.18" class="section level2">
<h2><span class="header-section-number">12.18</span> 标准绘图|箱线图</h2>
<div id="-65" class="section level3">
<h3><span class="header-section-number">12.18.1</span> 问题</h3>
<p>你想要绘制一个箱线图。</p>
</div>
<div id="-58" class="section level3">
<h3><span class="header-section-number">12.18.2</span> 方案</h3>
<p>该方案教你如何快速地使用标准绘图方法绘制简单的箱线图。</p>
<div id="-2" class="section level4">
<h4><span class="header-section-number">12.18.2.1</span> 样例数据</h4>
<p>这里的例子使用<code>ToothGrowth</code>数据集，它有两个独立变量以及一个依赖变量。</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ToothGrowth)
<span class="co">#&gt;    len supp dose</span>
<span class="co">#&gt; 1  4.2   VC  0.5</span>
<span class="co">#&gt; 2 11.5   VC  0.5</span>
<span class="co">#&gt; 3  7.3   VC  0.5</span>
<span class="co">#&gt; 4  5.8   VC  0.5</span>
<span class="co">#&gt; 5  6.4   VC  0.5</span>
<span class="co">#&gt; 6 10.0   VC  0.5</span></code></pre></div>
<p>在不同 <code>supp</code> 和<code>dose</code>条件下，变量<code>len</code>的箱线图:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span>supp, <span class="dt">data=</span>ToothGrowth)

<span class="co"># 即使`dose`是一个数值型变量，`boxplot`也会将其转换为因子 </span>
<span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span>dose, <span class="dt">data=</span>ToothGrowth)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /></p>
<p>组合 <code>supp</code> 和 <code>dose</code> 不同水平（即交互项）下<code>len</code>的箱线图（）</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">boxplot</span>(len <span class="op">~</span><span class="st"> </span><span class="kw">interaction</span>(dose,supp), <span class="dt">data=</span>ToothGrowth)</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" />
<p class="caption">plot of chunk unnamed-chunk-4</p>
</div>
<p>注意<code>plot</code>除了添加了横轴标签和不会自动将数值变量转换为因子变量，它与<code>boxplot</code>有非常相似的输出。</p>
<pre><code>plot(len ~ interaction(dose,supp), data=ToothGrowth)</code></pre>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Box_plot/figure/unnamed-chunk-5-1.png" alt="plot of chunk unnamed-chunk-5" />
<p class="caption">plot of chunk unnamed-chunk-5</p>
</div>
</div>
</div>
</div>
<div id="qq" class="section level2">
<h2><span class="header-section-number">12.19</span> 标准绘图|QQ图</h2>
<div id="-66" class="section level3">
<h3><span class="header-section-number">12.19.1</span> 问题</h3>
<p>你想要对你自己的数据分布与其他的分布进行比较。这常用语检查是否一个样本是否服从正态分布，以及两个样本是抽取自同一分布。</p>
</div>
<div id="-59" class="section level3">
<h3><span class="header-section-number">12.19.2</span> 方案</h3>
<p>假设这是你的数据：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">183</span>)
<span class="co"># 正态分布的数值</span>
x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">80</span>, <span class="dt">mean=</span><span class="dv">50</span>, <span class="dt">sd=</span><span class="dv">5</span>)

<span class="co"># 均匀分布的数值</span>
z &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">80</span>)
<span class="co"># 比较用rnorm()抽样的数据分布与正态分布的差异</span>
<span class="kw">qqnorm</span>(x)
<span class="kw">qqline</span>(x)

<span class="co"># 比较数据的4次幂分布与正态分布的差异</span>
<span class="kw">qqnorm</span>(x<span class="op">^</span><span class="dv">4</span>)
<span class="kw">qqline</span>(x<span class="op">^</span><span class="dv">4</span>)


<span class="co"># 比较均匀分布抽取的数据与正态分布的差异</span>
<span class="kw">qqnorm</span>(z)
<span class="kw">qqline</span>(z)</code></pre></div>
<p><img src="http://www.cookbook-r.com/Graphs/Q-Q_plot/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Q-Q_plot/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /><img src="http://www.cookbook-r.com/Graphs/Q-Q_plot/figure/unnamed-chunk-3-3.png" alt="plot of chunk unnamed-chunk-3" /></p>
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">12.20</span> 其他有趣图形-相关矩阵</h2>
<div id="-67" class="section level3">
<h3><span class="header-section-number">12.20.1</span> 问题</h3>
<p>你想要可视化多元变量间的相关性强度。</p>
</div>
<div id="-60" class="section level3">
<h3><span class="header-section-number">12.20.2</span> 方案</h3>
<p>假设所要分析的数据（如下）：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 设置伪随机数种子</span>
<span class="kw">set.seed</span>(<span class="dv">955</span>)
<span class="co">#生成符合正态分布的20个随机数</span>
vvar &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>)
wvar &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">5</span>)
xvar &lt;-<span class="st"> </span><span class="dv">20</span><span class="op">:</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>,<span class="dt">sd=</span><span class="dv">3</span>)
yvar &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>)<span class="op">/</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd=</span><span class="dv">10</span>)
zvar &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20</span>, <span class="dt">sd=</span><span class="dv">6</span>)

<span class="co"># 使用向量生成数据框（向量名为列名）</span>
data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(vvar, wvar, xvar, yvar, zvar)
<span class="kw">head</span>(data)
<span class="co">#&gt;        vvar       wvar     xvar       yvar      zvar</span>
<span class="co">#&gt; 1 -4.252354  5.1219288 16.02193 -15.156368 -4.086904</span>
<span class="co">#&gt; 2  1.702318 -1.3234340 15.83817 -24.063902  3.468423</span>
<span class="co">#&gt; 3  4.323054 -2.1570874 19.85517   2.306770 -3.044931</span>
<span class="co">#&gt; 4  1.780628  0.7880138 17.65079   2.564663  1.449081</span>
<span class="co">#&gt; 5 11.537348 -1.3075994 10.93386   9.600835  2.761963</span>
<span class="co">#&gt; 6  6.672130  2.0135190 15.24350  -3.465695  5.749642</span></code></pre></div>
<p>可视化上述数据：</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 导入以椭圆表征相关性强度的分析包</span>
<span class="kw">library</span>(ellipse)

<span class="co"># 生成相关矩阵表</span>
ctab &lt;-<span class="st"> </span><span class="kw">cor</span>(data)
<span class="co"># 表中数据保留两位小数</span>
<span class="kw">round</span>(ctab, <span class="dv">2</span>)
<span class="co">#&gt;       vvar  wvar  xvar  yvar  zvar</span>
<span class="co">#&gt; vvar  1.00  0.61 -0.85  0.75 -0.21</span>
<span class="co">#&gt; wvar  0.61  1.00 -0.81  0.54 -0.31</span>
<span class="co">#&gt; xvar -0.85 -0.81  1.00 -0.63  0.24</span>
<span class="co">#&gt; yvar  0.75  0.54 -0.63  1.00 -0.30</span>
<span class="co">#&gt; zvar -0.21 -0.31  0.24 -0.30  1.00</span>

<span class="co"># 设置简化边幅并绘制相关性图</span>
<span class="kw">plotcorr</span>(ctab, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))

<span class="co"># 使用颜色表征相关性强度</span>
colorfun &lt;-<span class="st"> </span><span class="kw">colorRamp</span>(<span class="kw">c</span>(<span class="st">&quot;#CC0000&quot;</span>,<span class="st">&quot;white&quot;</span>,<span class="st">&quot;#3366CC&quot;</span>), <span class="dt">space=</span><span class="st">&quot;Lab&quot;</span>)
<span class="kw">plotcorr</span>(ctab, <span class="dt">col=</span><span class="kw">rgb</span>(<span class="kw">colorfun</span>((ctab<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>), <span class="dt">maxColorValue=</span><span class="dv">255</span>),
         <span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span>))</code></pre></div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Correlation_matrix/figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3-1" />
<p class="caption">plot of chunk unnamed-chunk-3-1</p>
</div>
<div class="figure">
<img src="http://www.cookbook-r.com/Graphs/Correlation_matrix/figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3-2" />
<p class="caption">plot of chunk unnamed-chunk-3-2</p>
</div>
</div>
<div id="-1" class="section level3">
<h3><span class="header-section-number">12.20.3</span> 提示</h3>
<p>有关生成关联表（数字）的更多信息，参看<a href="http://www.cookbook-r.com/Statistical_analysis/Regression_and_correlation">../../Statistical analysis/Regression and correlation</a>。</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-11.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-13.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/openbiox/Cookbook-for-R-Chinese/edit/master/book/08-graphs.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown.pdf", "bookdown.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
